!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/g-lite")):"function"==typeof define&&define.amd?define(["exports","@antv/g-lite"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).G=t.G||{},t.G.SVGRenderer={}),t.window.G)}(this,(function(t,e){"use strict";var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)};var r=function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},r.apply(this,arguments)};function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,a,i=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(t){a={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o}var i="undefined"!=typeof Float32Array?Float32Array:Array;function o(){var t=new i(16);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function c(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],c=e[5],l=e[6],s=e[7],u=e[8],d=e[9],p=e[10],f=e[11],h=e[12],m=e[13],v=e[14],b=e[15],g=n*c-r*o,y=n*l-a*o,A=n*s-i*o,E=r*l-a*c,S=r*s-i*c,x=a*s-i*l,C=u*m-d*h,O=u*v-p*h,T=u*b-f*h,M=d*v-p*m,G=d*b-f*m,w=p*b-f*v,k=g*w-y*G+A*M+E*T-S*O+x*C;return k?(t[0]=(c*w-l*G+s*M)*(k=1/k),t[1]=(a*G-r*w-i*M)*k,t[2]=(m*x-v*S+b*E)*k,t[3]=(p*S-d*x-f*E)*k,t[4]=(l*T-o*w-s*O)*k,t[5]=(n*w-a*T+i*O)*k,t[6]=(v*A-h*x-b*y)*k,t[7]=(u*x-p*A+f*y)*k,t[8]=(o*G-c*T+s*C)*k,t[9]=(r*T-n*G-i*C)*k,t[10]=(h*S-m*A+b*g)*k,t[11]=(d*A-u*S-f*g)*k,t[12]=(c*O-o*M-l*C)*k,t[13]=(n*M-r*O+a*C)*k,t[14]=(m*y-h*E-v*g)*k,t[15]=(u*E-d*y+p*g)*k,t):null}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var l=function(t){return null==t},s={}.toString,u=function(t,e){return s.call(t)==="[object "+e+"]"},d=function(t){return u(t,"String")},p=function(t,e,n){return e>t?e:t>n?n:t},f=function(){function t(){}return t.tag="c-svg-element",t}();function h(t,e){var n=e.img,r=void 0===n?"":n,a=e.width,i=e.height;if(t.setAttribute("x","0"),t.setAttribute("y","0"),d(r))t.setAttribute("href",r);else if(r instanceof Image)a||t.setAttribute("width","".concat(r.width)),i||t.setAttribute("height","".concat(r.height)),t.setAttribute("href",r.src);else if(r instanceof HTMLElement&&d(r.nodeName)&&"CANVAS"===r.nodeName.toUpperCase())t.setAttribute("href",r.toDataURL());else if(r instanceof ImageData){var o=document.createElement("canvas");o.setAttribute("width","".concat(r.width)),o.setAttribute("height","".concat(r.height));var c=o.getContext("2d");c&&(c.putImageData(r,0,0),a||t.setAttribute("width","".concat(r.width)),i||t.setAttribute("height","".concat(r.height)),t.setAttribute("href",o.toDataURL()))}}function m(t,n){var r=n.x1,a=n.y1,i=n.x2,o=n.y2,c=n.defX,l=void 0===c?0:c,s=n.defY,u=void 0===s?0:s,d=n.markerStart,p=n.markerEnd,f=n.markerStartOffset,h=n.markerEndOffset,m=0,v=0,b=0,g=0,y=0;d&&e.isDisplayObject(d)&&f&&(m=Math.cos(y=Math.atan2(o-a,i-r))*(f||0),v=Math.sin(y)*(f||0)),p&&e.isDisplayObject(p)&&h&&(b=Math.cos(y=Math.atan2(a-o,r-i))*(h||0),g=Math.sin(y)*(h||0)),t.setAttribute("x1","".concat(r-l+m)),t.setAttribute("y1","".concat(a-u+v)),t.setAttribute("x2","".concat(i-l+b)),t.setAttribute("y2","".concat(o-u+g))}function v(t,n){var r=n.path,i=n.defX,o=void 0===i?0:i,c=n.defY,l=void 0===c?0:c,s=n.markerStart,u=n.markerEnd,d=n.markerStartOffset,p=n.markerEndOffset,f=0,h=0,m=0,v=0,b=0;if(s&&e.isDisplayObject(s)&&d){var g=a(s.parentNode.getStartTangent(),2);f=Math.cos(b=Math.atan2((y=g[0])[1]-(A=g[1])[1],y[0]-A[0]))*(d||0),h=Math.sin(b)*(d||0)}if(u&&e.isDisplayObject(u)&&p){var y,A,E=a(u.parentNode.getEndTangent(),2);m=Math.cos(b=Math.atan2((y=E[0])[1]-(A=E[1])[1],y[0]-A[0]))*(p||0),v=Math.sin(b)*(p||0)}t.setAttribute("d",e.translatePathToString(r.absolutePath,o,l,f,h,m,v))}function b(t,n){var r=n.points.points,a=n.defX,i=void 0===a?0:a,o=n.defY,c=void 0===o?0:o,l=n.markerStart,s=n.markerStartOffset,u=n.markerEnd,d=n.markerEndOffset,p=r.length;if(r&&p>=2){var f=0,h=0,m=0,v=0,b=0;l&&e.isDisplayObject(l)&&s&&(f=Math.cos(b=Math.atan2(r[1][1]-r[0][1],r[1][0]-r[0][0]))*(s||0),h=Math.sin(b)*(s||0)),u&&e.isDisplayObject(u)&&d&&(m=Math.cos(b=Math.atan2(r[p-2][1]-r[p-1][1],r[p-2][0]-r[p-1][0]))*(d||0),v=Math.sin(b)*(d||0)),t.setAttribute("points",r.map((function(t,e){var n=0,r=0;return 0===e?(n=f,r=h):e===p-1&&(n=m,r=v),"".concat(t[0]-i+n,",").concat(t[1]-c+r)})).join(" "))}}function g(t,e){var n=e.radius,r=e.width,i=e.height;if(isFinite(r)&&isFinite(i)){var o="";if(n&&n.some((function(t){return 0!==t}))){var c=a(n.map((function(t){return p(t,0,Math.min(Math.abs(r)/2,Math.abs(i)/2))})),4),l=c[0],s=c[1],u=c[2],d=c[3],f=r>0?1:-1,h=i>0?1:-1,m=f+h!==0?1:0;o=[["M ".concat(f*l,",0")],["l ".concat(r-f*(l+s),",0")],["a ".concat(s,",").concat(s,",0,0,").concat(m,",").concat(f*s,",").concat(h*s)],["l 0,".concat(i-h*(s+u))],["a ".concat(u,",").concat(u,",0,0,").concat(m,",").concat(-f*u,",").concat(h*u)],["l ".concat(f*(u+d)-r,",0")],["a ".concat(d,",").concat(d,",0,0,").concat(m,",").concat(-f*d,",").concat(-h*d)],["l 0,".concat(h*(d+l)-i)],["a ".concat(l,",").concat(l,",0,0,").concat(m,",").concat(f*l,",").concat(-h*l)],["z"]].join(" ")}else o="M 0,0 l ".concat(r,",0 l 0,").concat(i," l").concat(-r," 0 z");t.setAttribute("d",o)}}function y(t,e){return(e||document).createElementNS("http://www.w3.org/2000/svg",t)}function A(t){return t.toFixed(6).replace(".000000","")}function E(t){return t.replace(/[&|<|>|"|']/g,(function(t){return"&"===t?"&amp;":"<"===t?"&lt;":">"===t?"&gt;":'"'===t?"&quot;":"&apos;"}))}var S,x,C={opacity:"opacity",fillStyle:"fill",fill:"fill",fillRule:"fill-rule",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",clipPath:"clip-path",textPath:"text-path",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",letterSpacing:"letter-spacing",startArrow:"marker-start",endArrow:"marker-end",class:"class",id:"id",preserveAspectRatio:"preserveAspectRatio",visibility:"visibility",anchor:"anchor",shadowColor:"flood-color",shadowBlur:"stdDeviation",shadowOffsetX:"dx",shadowOffsetY:"dy",filter:"filter",innerHTML:"innerHTML",textAlign:"text-anchor",pointerEvents:"pointer-events"},O={textAlign:{inherit:"inherit",left:"left",start:"left",center:"middle",right:"end",end:"end"}},T={textAlign:"inherit",lineCap:"butt",lineJoin:"miter",lineWidth:"1px",opacity:"1",fillOpacity:"1",fillRule:"nonzero",strokeOpacity:"1",strokeWidth:"0",strokeMiterLimit:"4",letterSpacing:"0",fontSize:"inherit",fontFamily:"inherit",pointerEvents:"auto"},M="g-svg",G="clip-path-",w="text-path-",k=function(){function t(t,e,n){this.pluginOptions=t,this.defElementManager=e,this.context=n,this.svgElementMap=new WeakMap,this.renderQueue=[],this.dirtyAttributes=new WeakMap,this.pendingReorderQueue=new Set,this.clipPathUseMap=new WeakMap}return t.prototype.apply=function(n){var r=this,a=n.renderingService,i=n.renderingContext;this.context=n,this.context.svgElementMap=this.svgElementMap;var l=i.root.ownerDocument.defaultView,s=this.context.config.document,u=function(t){var e=t.target;if(r.clipPathUseMap.get(e)){var n=r.defElementManager.getDefElement().querySelector("#".concat(r.getId(e)));n&&n.remove()}r.createSVGDom(s,e,r.$camera)},d=function(t){var e=t.target;r.defElementManager.clear(e.entity),r.clipPathUseMap.delete(e),r.removeSVGDom(e)},p=function(t){var e,n,a=t.parentNode,i=null===(n=null===(e=t.parentNode)||void 0===e?void 0:e.elementSVG)||void 0===n?void 0:n.$groupEl,o=((null==a?void 0:a.children)||[]).slice();i&&r.reorderChildren(s,i,o)},f=function(t){p(t.target)},h=function(t){var e=t.target;if(e.elementSVG){var n=t.attrName,a=r.dirtyAttributes.get(e);a||(r.dirtyAttributes.set(e,[]),a=r.dirtyAttributes.get(e)),a.push(n)}},m=function(t){var n,a=t.target,i=null===(n=a.elementSVG)||void 0===n?void 0:n.$el,l=a.parsedStyle,s=l.fill,u=l.stroke,d=l.clipPath;if(s&&!e.isCSSRGB(s)&&r.defElementManager.createOrUpdateGradientAndPattern(a,i,s,"fill",r),u&&!e.isCSSRGB(u)&&r.defElementManager.createOrUpdateGradientAndPattern(a,i,u,"stroke",r),d){var p=c(o(),a.getWorldTransform()),f=G+d.entity+"-"+a.entity,h=r.defElementManager.getDefElement().querySelector("#".concat(f));h&&r.applyTransform(h,p)}};a.hooks.init.tap(t.tag,(function(){var t,n=(t=r.context.config).background,a=t.document;r.defElementManager.init();var i=r.context.contextService.getContext();n&&(i.style.background=n),i.setAttribute("color-interpolation-filters","sRGB"),r.$camera=y("g",a),r.$camera.id="".concat(M,"-camera"),r.applyTransform(r.$camera,r.context.camera.getOrthoMatrix()),i.appendChild(r.$camera),l.addEventListener(e.ElementEvent.MOUNTED,u),l.addEventListener(e.ElementEvent.UNMOUNTED,d),l.addEventListener(e.ElementEvent.REPARENT,f),l.addEventListener(e.ElementEvent.ATTR_MODIFIED,h),l.addEventListener(e.ElementEvent.BOUNDS_CHANGED,m)})),a.hooks.destroy.tap(t.tag,(function(){l.removeEventListener(e.ElementEvent.MOUNTED,u),l.removeEventListener(e.ElementEvent.UNMOUNTED,d),l.removeEventListener(e.ElementEvent.REPARENT,f),l.removeEventListener(e.ElementEvent.ATTR_MODIFIED,h),l.removeEventListener(e.ElementEvent.BOUNDS_CHANGED,m)})),a.hooks.render.tap(t.tag,(function(t){r.renderQueue.push(t)})),a.hooks.beginFrame.tap(t.tag,(function(){var t=r.context.config.document;r.pendingReorderQueue.size&&(r.pendingReorderQueue.forEach((function(e){var n,a=((null==e?void 0:e.children)||[]).slice(),i=null===(n=null==e?void 0:e.elementSVG)||void 0===n?void 0:n.$groupEl;i&&r.reorderChildren(t||s,i,a||[])})),r.pendingReorderQueue.clear())})),a.hooks.endFrame.tap(t.tag,(function(){i.renderReasons.has(e.RenderReason.CAMERA_CHANGED)&&r.applyTransform(r.$camera,r.context.camera.getOrthoMatrix()),r.renderQueue.forEach((function(t){var e,n,a=null===(e=t.elementSVG)||void 0===e?void 0:e.$el,i=null===(n=t.elementSVG)||void 0===n?void 0:n.$groupEl;if(a&&i){var o=t.getLocalTransform();r.applyTransform(i,o);var c=r.clipPathUseMap.get(t);c&&c.length&&c.forEach((function(e){r.applyTransform(e,t.getWorldTransform())})),t.renderable.dirty=!1}var l=r.dirtyAttributes.get(t);l&&(l.forEach((function(e){"zIndex"===e?p(t):"increasedLineWidthForHitTesting"===e&&r.createOrUpdateHitArea(t,a,i),r.updateAttribute(t,[e])})),r.dirtyAttributes.delete(t))})),r.renderQueue=[]}))},t.prototype.getId=function(t){return"".concat(M,"-").concat(t.entity)},t.prototype.reorderChildren=function(t,e,n){if(n.sort((function(t,e){return t.sortable.renderOrder-e.sortable.renderOrder})),n.length){var r=(t||document).createDocumentFragment();n.forEach((function(t){if(t.isConnected){var e=t.elementSVG.$groupEl;e&&r.appendChild(e)}})),e.appendChild(r)}},t.prototype.applyTransform=function(t,e){t.setAttribute("transform","matrix(".concat(A(e[0]),",").concat(A(e[1]),",").concat(A(e[4]),",").concat(A(e[5]),",").concat(A(e[12]),",").concat(A(e[13]),")"))},t.prototype.applyAttributes=function(t){var n=t.elementSVG,r=null==n?void 0:n.$el;if(r&&(null==n?void 0:n.$groupEl)){var a=t.nodeName,i=t.attributes;r.setAttribute("fill","none"),a===e.Shape.IMAGE&&r.setAttribute("preserveAspectRatio","none"),this.updateAttribute(t,Object.keys(i))}},t.prototype.updateAttribute=function(t,n){var r,a=this,i=this.context.config.document,o=(r=t.elementSVG).$el,c=r.$groupEl,s=r.$hitTestingEl,u=t.parsedStyle,d=t.computedStyle,p=t.nodeName;n.some((function(e){return a.context.SVGElementLifeCycleContribution.shouldUpdateElementAttribute(t,e)}))&&o&&[o,s].forEach((function(n){n&&(a.context.SVGElementLifeCycleContribution.updateElementAttribute(t,n,a.svgElementMap),t.nodeName!==e.Shape.TEXT&&a.updateAnchorWithTransform(t))})),n.forEach((function(n){var r,f,h=C[n],m=e.runtime.enableCSSParsing?d[n]:u[n],v=!l(m)&&""+m,b=(null===(r=O[n])||void 0===r?void 0:r[v])||v,g=u[n],y=h&&!!(null===(f=e.propertyMetadataCache[n])||void 0===f?void 0:f.inh);h&&(p!==e.Shape.GROUP&&!t.isCustomElement||e.runtime.enableCSSParsing||!y&&"fill"!==h&&"stroke"!==h)&&(p===e.Shape.HTML&&("lineWidth"===n?o.style["border-width"]="".concat(g||0,"px"):"lineDash"===n&&(o.style["border-style"]="dashed")),"fill"===n?p===e.Shape.HTML?o.style.background=""+g:a.defElementManager.createOrUpdateGradientAndPattern(t,o,g,h,a):"stroke"===n?p===e.Shape.HTML?(o.style["border-color"]=""+g,o.style["border-style"]="solid"):a.defElementManager.createOrUpdateGradientAndPattern(t,o,g,h,a):e.runtime.enableCSSParsing&&y?"unset"!==v&&v!==T[n]?null==c||c.setAttribute(h,b):null==c||c.removeAttribute(h):"clipPath"===n?a.createOrUpdateClipOrTextPath(i,g,t):"textPath"===n?a.createOrUpdateClipOrTextPath(i,g,t,!0):"shadowType"===n||"shadowColor"===n||"shadowBlur"===n||"shadowOffsetX"===n||"shadowOffsetY"===n?a.defElementManager.createOrUpdateShadow(t,o,n):"filter"===n?a.defElementManager.createOrUpdateFilter(t,o,g):"innerHTML"===n?a.createOrUpdateInnerHTML(i,o,g):"anchor"===n?p!==e.Shape.TEXT&&a.updateAnchorWithTransform(t):l(m)||[o,s].forEach((function(t){t&&h&&("unset"!==v&&v!==T[n]?t.setAttribute(h,b):t.removeAttribute(h))})))}))},t.prototype.createSVGDom=function(t,n,r,a){var i;void 0===a&&(a=!1),n.elementSVG=new f;var o=n.elementSVG,c=this.context.SVGElementLifeCycleContribution.createElement(n,this.svgElementMap);if(c){var l=void 0;n.nodeName===e.Shape.HTML&&(n.parsedStyle.$el=c),this.pluginOptions.outputSVGElementId&&(c.id=this.getId(n)),this.pluginOptions.outputSVGElementName&&n.name&&c.setAttribute("name",n.name),!c.hasAttribute("data-wrapgroup")&&"g"===c.nodeName||a?l=c:((l=y("g",t)).id=c.id+"-g",l.appendChild(c)),o.$el=c,o.$groupEl=l,this.applyAttributes(n),this.createOrUpdateHitArea(n,c,l);var s=r||n.parentNode&&(null===(i=n.parentNode.elementSVG)||void 0===i?void 0:i.$groupEl);s&&(s.appendChild(l),this.pendingReorderQueue.add(n.parentNode))}},t.prototype.removeSVGDom=function(t){var e,n=null===(e=t.elementSVG)||void 0===e?void 0:e.$groupEl;n&&n.parentNode&&(n.parentNode.removeChild(n),this.context.SVGElementLifeCycleContribution.destroyElement(t,n))},t.prototype.createOrUpdateHitArea=function(t,e,n){var r=t.elementSVG,a=r.$hitTestingEl,i=t.parsedStyle.increasedLineWidthForHitTesting;if(i){if(!a){a=e.cloneNode(),this.pluginOptions.outputSVGElementId&&(a.id="".concat(M,"-").concat(t.nodeName,"-hittesting-").concat(t.entity)),["filter"].forEach((function(t){a.removeAttribute(t)}));var o="none"!==e.getAttribute("fill");a.setAttribute("fill",o?"transparent":"none"),a.setAttribute("stroke","transparent"),n.appendChild(a),r.$hitTestingEl=a}a.setAttribute("stroke-width","".concat(i+t.parsedStyle.lineWidth))}else a&&(n.removeChild(a),r.$hitTestingEl=null)},t.prototype.createOrUpdateInnerHTML=function(t,e,n){var r=(t||document).createElement("div");"string"==typeof n?r.innerHTML=n:r.appendChild(n),e.innerHTML="",e.appendChild(r)},t.prototype.createOrUpdateClipOrTextPath=function(t,e,n,r){void 0===r&&(r=!1);var a=n.elementSVG.$groupEl,i=r?"g":"clipPath",l=r?"text-path":"clip-path";if(e){var s=(r?w:G)+e.entity+"-"+n.entity,u=this.defElementManager.getDefElement();if(!u.querySelector("#".concat(s))){var d=void 0;if(r)this.createSVGDom(t,e,null,!0),d=e.elementSVG.$el;else{if(!e.isConnected)u.querySelector("#".concat(this.getId(e)))||this.createSVGDom(t,e,u,!0);d=y(i,t);var p=y("use",t);p.setAttribute("href","#".concat(e.elementSVG.$el.id)),d.appendChild(p);var f=this.clipPathUseMap.get(e);f||(this.clipPathUseMap.set(e,[]),f=this.clipPathUseMap.get(e)),f.push(p),this.applyTransform(p,e.getWorldTransform());var h=c(o(),n.getWorldTransform());this.applyTransform(d,h)}d.id=s,u.appendChild(d)}this.applyAttributes(e),r||a.setAttribute(l,"url(#".concat(s,")"))}else r||a.removeAttribute(l)},t.prototype.updateAnchorWithTransform=function(t){var n,r,a=t.getGeometryBounds(),i=a&&2*a.halfExtents[0]||0,o=a&&2*a.halfExtents[1]||0,c=(t.parsedStyle||{}).anchor;[null===(n=t.elementSVG)||void 0===n?void 0:n.$el,null===(r=t.elementSVG)||void 0===r?void 0:r.$hitTestingEl].forEach((function(n){if(n){var r=-c[0]*i,a=-c[1]*o;0===r&&0===a||n.setAttribute("transform","translate(".concat(r,",").concat(a,")")),t.nodeName!==e.Shape.CIRCLE&&t.nodeName!==e.Shape.ELLIPSE||(n.setAttribute("cx","".concat(i/2)),n.setAttribute("cy","".concat(o/2)))}}))},t.tag="SVGRenderer",t}(),L={top:"hanging",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",ideographic:"ideographic",hanging:"hanging"};function P(t,n,r){var a=n.lineWidth,i=n.dx,o=n.dy,c=n.textPath,l=n.textPathSide,s=void 0===l?"left":l,u=n.textPathStartOffset,d=void 0===u?0:u,p=n.textDecorationLine,f=void 0===p?"":p,h=n.textDecorationColor,m=void 0===h?"":h,v=n.textDecorationStyle,b=void 0===v?"":v,g=n.metrics,A=n.textBaseline;e.runtime.enableCSSParsing||"alphabetic"!==A||(A="bottom"),t.setAttribute("dominant-baseline",L[A]),t.setAttribute("paint-order","stroke");var S=g.lines,x=g.lineHeight,C=g.height,O=S.length,T="";if(0===i&&0===o||(T+="transform:translate(".concat(i,"px, ").concat(o,"px);")),f&&"none"!==f&&(T+="text-decoration:".concat(f," ").concat(b," ").concat(m,";")),T&&t.setAttribute("style",T),1===O){var M=E(S[0]);if(t.setAttribute("dx","".concat(a/2)),"bottom"!==A&&"top"!==A||(t.setAttribute("dominant-baseline",L.middle),t.setAttribute("dy","bottom"===A?"-".concat(C/2,"px"):"".concat(C/2,"px"))),c){t.innerHTML="";var G=y("textPath",t.ownerDocument);G.setAttribute("href","#".concat(w+c.entity)),"left"!==s&&G.setAttribute("side",s),0!==d&&G.setAttribute("startOffset","".concat(d)),G.innerHTML=M,t.appendChild(G)}else t.innerHTML=M}else t.innerHTML=S.map((function(t,e){var n=0;return 0===e?"middle"===A?n=x/2-C/2:"top"===A||"hanging"===A?n=0:"bottom"!==A&&"alphabetic"!==A&&"ideographic"!==A||(n=-x*(O-1)):n=x,'<tspan x="0" dx="'.concat(a/2,'" dy="').concat(n,'">').concat(E(t),"</tspan>")})).join("")}var D=((S={})[e.Shape.RECT]="path",S[e.Shape.CIRCLE]="circle",S[e.Shape.ELLIPSE]="ellipse",S[e.Shape.IMAGE]="image",S[e.Shape.GROUP]="g",S[e.Shape.LINE]="line",S[e.Shape.POLYLINE]="polyline",S[e.Shape.POLYGON]="polygon",S[e.Shape.TEXT]="text",S[e.Shape.PATH]="path",S[e.Shape.HTML]="foreignObject",S),V=((x={})[e.Shape.CIRCLE]=["r"],x[e.Shape.ELLIPSE]=["rx","ry"],x[e.Shape.RECT]=["width","height","radius"],x[e.Shape.IMAGE]=["img","width","height"],x[e.Shape.LINE]=["x1","y1","x2","y2","markerStart","markerEnd","markerStartOffset","markerEndOffset"],x[e.Shape.POLYLINE]=["points","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],x[e.Shape.POLYGON]=["points","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],x[e.Shape.PATH]=["path","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],x[e.Shape.TEXT]=["text","font","fontSize","fontFamily","fontStyle","fontWeight","fontVariant","lineHeight","letterSpacing","wordWrap","wordWrapWidth","maxLines","leading","textBaseline","textAlign","textTransform","textOverflow","textPath","textPathSide","textPathStartOffset","textDecorationLine","textDecorationColor","textDecorationStyle","dx","dy"],x),N=function(){function t(t){this.context=t}return t.prototype.createElement=function(t,e){var n=y(D[t.nodeName]||"g",this.context.config.document||document);return e.set(n,t),n},t.prototype.destroyElement=function(t,e){},t.prototype.shouldUpdateElementAttribute=function(t,e){return(V[t.nodeName]||[]).indexOf(e)>-1},t.prototype.updateElementAttribute=function(t){var n=t.elementSVG.$el,r=t.parsedStyle;switch(t.nodeName){case e.Shape.IMAGE:h(n,r);break;case e.Shape.RECT:g(n,r);break;case e.Shape.LINE:m(n,r);break;case e.Shape.POLYGON:case e.Shape.POLYLINE:b(n,r);break;case e.Shape.PATH:v(n,r);break;case e.Shape.TEXT:P(n,r)}},t}(),U="g-filter-";function R(t,e,n,r,a){var i=U+n.entity,o=e.querySelectorAll("[name=".concat(i,"]"));if(o.length&&o.forEach((function(t){e.removeChild(t)})),0===a.length)null==r||r.removeAttribute("filter");else{var c=a.map((function(n,r){var a=n.name,o=n.params,c=y("filter",t);return c.setAttribute("filterUnits","userSpaceOnUse"),"blur"===a?function(t,e,n){var r=y("feGaussianBlur",t);r.setAttribute("in","SourceGraphic"),r.setAttribute("stdDeviation","".concat(n[0].value)),e.appendChild(r)}(t,c,o):"brightness"===a?function(t,e,n){var r=I(n[0]);$(t,e,{type:"linear",slope:r,intercept:0})}(t,c,o):"drop-shadow"===a?function(t,e,n){var r=n[0].value,a=n[1].value,i=n[2].value,o=n[3].formatted,c=y("feGaussianBlur",t);c.setAttribute("in","SourceAlpha"),c.setAttribute("stdDeviation","".concat(i)),e.appendChild(c);var l=y("feOffset",t);l.setAttribute("dx","".concat(r)),l.setAttribute("dy","".concat(a)),l.setAttribute("result","offsetblur"),e.appendChild(l);var s=y("feFlood",t);s.setAttribute("flood-color",o),e.appendChild(s);var u=y("feComposite",t);u.setAttribute("in2","offsetblur"),u.setAttribute("operator","in"),e.appendChild(u);var d=y("feMerge",t);e.appendChild(d);var p=y("feMergeNode",t),f=y("feMergeNode",t);f.setAttribute("in","SourceGraphic"),d.appendChild(p),d.appendChild(f)}(t,c,o):"contrast"===a?function(t,e,n){var r=I(n[0]);$(t,e,{type:"linear",slope:r,intercept:-.5*r+.5})}(t,c,o):"grayscale"===a?function(t,e,n){var r=I(n[0]);H(t,e,[.2126+.7874*(1-r),.7152-.7152*(1-r),.0722-.0722*(1-r),0,0,.2126-.2126*(1-r),.7152+.2848*(1-r),.0722-.0722*(1-r),0,0,.2126-.2126*(1-r),.7152-.7152*(1-r),.0722+.9278*(1-r),0,0,0,0,0,1,0])}(t,c,o):"sepia"===a?function(t,e,n){var r=I(n[0]);H(t,e,[.393+.607*(1-r),.769-.769*(1-r),.189-.189*(1-r),0,0,.349-.349*(1-r),.686+.314*(1-r),.168-.168*(1-r),0,0,.272-.272*(1-r),.534-.534*(1-r),.131+.869*(1-r),0,0,0,0,0,1,0])}(t,c,o):"saturate"===a?function(t,e,n){var r=I(n[0]),a=y("feColorMatrix",t);a.setAttribute("type","saturate"),a.setAttribute("values","".concat(r)),e.appendChild(a)}(t,c,o):"hue-rotate"===a?function(t,e,n){var r=y("feColorMatrix",t);r.setAttribute("type","hueRotate"),r.setAttribute("values","".concat(n[0].value)),e.appendChild(r)}(t,c,o):"invert"===a&&function(t,e,n){var r=I(n[0]);$(t,e,{type:"table",tableValues:"".concat(r," ").concat(1-r)})}(t,c,o),c.id="".concat(i,"-").concat(r),c.setAttribute("name",i),e.appendChild(c),c.id}));setTimeout((function(){null==r||r.setAttribute("filter",c.map((function(t){return"url(#".concat(t,")")})).join(" "))}))}}function I(t){return t.unit===e.UnitType.kPercentage?t.value/100:t.value}function $(t,e,n){var r=n.type,a=n.slope,i=n.intercept,o=n.tableValues,c=y("feComponentTransfer",t);[y("feFuncR",t),y("feFuncG",t),y("feFuncB",t)].forEach((function(t){t.setAttribute("type",r),"table"===r?t.setAttribute("tableValues","".concat(o)):(t.setAttribute("slope","".concat(a)),t.setAttribute("intercept","".concat(i))),c.appendChild(t)})),e.appendChild(c)}function H(t,e,n){var r=y("feColorMatrix",t);r.setAttribute("type","matrix"),r.setAttribute("values",n.join(" ")),e.appendChild(r)}var F="g-pattern-",_={},j=0;function B(t,n,r,a,i,o,c,l){if(!i)return"";if(!e.isCSSRGB(i)){if(e.isPattern(i)){var s=function(t,n,r,a,i,o){var c=W(a),l=n.querySelector("#".concat(c));if(!l){var s=a.image,u="";if(d(s)?u=s:e.isBrowser&&(s instanceof HTMLImageElement?u=s.src:s instanceof HTMLCanvasElement&&(u=s.toDataURL())),u){var p,f=y("image",t);f.setAttribute("href",u),i?p=i(u):e.isBrowser&&(p=new window.Image),u.match(/^data:/i)||(p.crossOrigin="Anonymous",f.setAttribute("crossorigin","anonymous")),p.src=u;var h=function(){var e=X(t,n,r,a,c,p.width,p.height);n.appendChild(e),e.appendChild(f),f.setAttribute("x","0"),f.setAttribute("y","0"),f.setAttribute("width","".concat(p.width)),f.setAttribute("height","".concat(p.height))};p.complete?h():p.onload=h}if("rect"===s.nodeName){var m=s.parsedStyle,v=X(t,n,s,a,c,m.width,m.height);s.forEach((function(e){o.createSVGDom(t,e,null);var n=e.elementSVG,r=e.getLocalTransform();o.applyTransform(n.$groupEl,r)})),v.appendChild(s.elementSVG.$groupEl)}}return c}(t,n,r,i,c,l);return a.style[o]="url(#".concat(s,")"),s}if(1===i.length){var u=Y(t,r,n,a,i[0]);return null==a||a.setAttribute(o,"url(#".concat(u,")")),u}var p=function(t,e,n,r,a){var i=U+e.entity+"-gradient",o=n.querySelector("#".concat(i));o||((o=y("filter",t)).setAttribute("filterUnits","userSpaceOnUse"),o.setAttribute("x","0%"),o.setAttribute("y","0%"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.id=i,n.appendChild(o));var c=0;a.forEach((function(a,l){var s=Y(t,e,n,r,a),u=s+"_rect",d=y("rect",t);d.setAttribute("x","0"),d.setAttribute("y","0"),d.setAttribute("width","100%"),d.setAttribute("height","100%"),d.setAttribute("fill","url(#".concat(s,")")),d.id=u,n.appendChild(d);var p=y("feImage",t);if(p.setAttribute("href","#".concat(u)),p.setAttribute("result","".concat(i,"-").concat(l)),o.appendChild(p),l>0){var f=y("feBlend",t);f.setAttribute("in",1===l?"".concat(i,"-").concat(l-1):"".concat(i,"-blended-").concat(c-1)),f.setAttribute("in2","".concat(i,"-").concat(l)),f.setAttribute("result","".concat(i,"-blended-").concat(c++)),f.setAttribute("mode","multiply"),o.appendChild(f)}}));var l=y("feComposite",t);return l.setAttribute("in","".concat(i,"-blended-").concat(c)),l.setAttribute("in2","SourceGraphic"),l.setAttribute("operator","in"),o.appendChild(l),i}(t,r,n,a,i);return null==a||a.setAttribute("filter","url(#".concat(p,")")),null==a||a.setAttribute("fill","black"),p}return"currentColor"===r.style[o]?null==a||a.setAttribute(o,"currentColor"):null==a||a.setAttribute(o,i.isNone?"none":""+i),""}function W(t,n){void 0===n&&(n={});var a="";if(e.isCSSGradientValue(t)){var i=t.type;if(i===e.GradientType.LinearGradient||i===e.GradientType.RadialGradient){var o=r(r({},t.value),n),c=o.width,l=o.height,s=o.steps,u=o.angle,p=o.cx,f=o.cy,h=o.size;a="gradient-".concat(o.type,"-").concat((null==u?void 0:""+u)||0,"-").concat((null==p?void 0:""+p)||0,"-").concat((null==f?void 0:""+f)||0,"-").concat((null==h?void 0:""+h)||0,"-").concat(c,"-").concat(l,"-").concat(s.map((function(t){var e=t.color;return"".concat(t.offset).concat(e)})).join("-"))}}else e.isPattern(t)&&(a=d(t.image)?"pattern-".concat(t.image,"-").concat(t.repetition):"rect"===t.image.nodeName?"pattern-rect-".concat(t.image.entity):"pattern-".concat(j));return a&&(_[a]||(_[a]=F+"".concat(j++))),_[a]}function X(t,n,r,i,o,c,l){var s=i.repetition,u=i.transform,d=y("pattern",t);u&&d.setAttribute("patternTransform",function(t){return e.parseTransform(t).map((function(t){var e=t.t,n=t.d;if("translate"===e)return"translate(".concat(n[0].value," ").concat(n[1].value,")");if("translatex"===e)return"translate(".concat(n[0].value," 0)");if("translatey"===e)return"translate(0 ".concat(n[0].value,")");if("rotate"===e)return"rotate(".concat(n[0].value,")");if("scale"===e){var r=(null==n?void 0:n.map((function(t){return t.value})))||[1,1];return"scale(".concat(r[0],", ").concat(r[1],")")}if("scalex"===e)return r=(null==n?void 0:n.map((function(t){return t.value})))||[1],"scale(".concat(r[0],", 1)");if("scaley"===e)return r=(null==n?void 0:n.map((function(t){return t.value})))||[1],"scale(1, ".concat(r[0],")");if("skew"===e){var i=(null==n?void 0:n.map((function(t){return t.value})))||[0,0];return"skewX(".concat(i[0],") skewY(").concat(i[1],")")}if("skewx"===e)return i=(null==n?void 0:n.map((function(t){return t.value})))||[0],"skewX(".concat(i[0],")");if("skewy"===e)return i=(null==n?void 0:n.map((function(t){return t.value})))||[0],"skewY(".concat(i[0],")");if("matrix"===e){var o=a(n.map((function(t){return t.value})),6),c=o[1],l=o[2],s=o[3],u=o[4],d=o[5];return"matrix(".concat(o[0]," ").concat(c," ").concat(l," ").concat(s," ").concat(u," ").concat(d,")")}})).join(" ")}(u)),d.setAttribute("patternUnits","userSpaceOnUse"),d.id=o,n.appendChild(d),d.setAttribute("x","0"),d.setAttribute("y","0");var p=r.getGeometryBounds().halfExtents,f=c,h=l;return"repeat-x"===s?h=2*p[1]:"repeat-y"===s?f=2*p[0]:"no-repeat"===s&&(f=2*p[0],h=2*p[1]),d.setAttribute("width","".concat(f)),d.setAttribute("height","".concat(h)),d}function Y(t,n,r,a,i){var o=n.getGeometryBounds(),c=o&&2*o.halfExtents[0]||0,l=o&&2*o.halfExtents[1]||0,s=W(i,{width:c,height:l}),u=r.querySelector("#".concat(s));if(!u){(u=y(i.type===e.GradientType.LinearGradient?"linearGradient":"radialGradient",t)).setAttribute("gradientUnits","userSpaceOnUse");var d="";i.value.steps.sort((function(t,e){return t.offset.value-e.offset.value})).forEach((function(t){var e=t.color;d+='<stop offset="'.concat(t.offset.value/100,'" stop-color="').concat(e,'"></stop>')})),u.innerHTML=d,u.id=s,r.appendChild(u)}if(i.type===e.GradientType.LinearGradient){var p=e.computeLinearGradient(c,l,i.value.angle),f=p.y1,h=p.x2,m=p.y2;u.setAttribute("x1","".concat(p.x1)),u.setAttribute("y1","".concat(f)),u.setAttribute("x2","".concat(h)),u.setAttribute("y2","".concat(m))}else{var v=i.value,b=e.computeRadialGradient(c,l,v.cx,v.cy,v.size),g=b.y,A=b.r;u.setAttribute("cx","".concat(b.x)),u.setAttribute("cy","".concat(g)),u.setAttribute("r","".concat(A))}return s}var q=/url\("?#(.*)\)/,z=function(){function t(t){this.context=t,this.gradientCache={}}return t.prototype.getDefElement=function(){return this.$def},t.prototype.init=function(){var t=this.context.config.document,e=this.context.contextService.getContext();this.$def=y("defs",t),e.appendChild(this.$def)},t.prototype.clear=function(t){var e=this;Object.keys(this.gradientCache).forEach((function(n){e.clearUnusedDefElement(e.gradientCache,n,t)}))},t.prototype.clearUnusedDefElement=function(t,e,n){if(t[e]&&1===t[e].size&&t[e].has(n)){var r=this.$def.querySelector("#".concat(e));r&&this.$def.removeChild(r)}},t.prototype.createOrUpdateGradientAndPattern=function(t,n,r,a,i){var o=this.context.config,c=o.document,l=o.createImage;if(n){var s=(e.isPattern(r)?n.style[a]:n.getAttribute(a)||"").match(q);s&&s.length>1&&this.clearUnusedDefElement(this.gradientCache,s[1].replace('"',""),t.entity);var u=B(c||document,this.$def,t,n,r,a,l,i);u&&(this.gradientCache[u]||(this.gradientCache[u]=new Set),this.gradientCache[u].add(t.entity))}},t.prototype.createOrUpdateShadow=function(t,e,n){!function(t,e,n,r,a){var i=n.parsedStyle,o=i.shadowType,c=i.shadowBlur,s=i.shadowColor,u=i.shadowOffsetX,d=i.shadowOffsetY,p=!l(s)&&c>0,f="g-filter-dropshadow-"+n.entity,h=e.querySelector("#".concat(f));if(h&&(h.getAttribute("data-type")===o&&p||(h.remove(),h=null)),p){if(null==r||r.setAttribute("filter","url(#".concat(f,")")),!h){if((h=y("filter",t)).setAttribute("data-type",o),"outer"===o)(T=y("feDropShadow",t)).setAttribute("dx","".concat((u||0)/2)),T.setAttribute("dy","".concat((d||0)/2)),T.setAttribute("stdDeviation","".concat((c||0)/4)),T.setAttribute("flood-color",""+s),h.appendChild(T);else if("inner"===o){var m=y("feComponentTransfer",t);m.setAttribute("in","SourceAlpha");var v=y("feFuncA",t);v.setAttribute("type","table"),v.setAttribute("tableValues","1 0"),m.appendChild(v),h.appendChild(m),(x=y("feGaussianBlur",t)).setAttribute("stdDeviation","".concat((c||0)/4)),h.appendChild(x),(C=y("feOffset",t)).setAttribute("dx","".concat((u||0)/2)),C.setAttribute("dy","".concat((d||0)/2)),C.setAttribute("result","offsetblur"),h.appendChild(C),(O=y("feFlood",t)).setAttribute("flood-color",""+s),O.setAttribute("result","color"),h.appendChild(O);var b=y("feComposite",t);b.setAttribute("in2","offsetblur"),b.setAttribute("operator","in"),h.appendChild(b);var g=y("feComposite",t);g.setAttribute("in2","SourceAlpha"),g.setAttribute("operator","in"),h.appendChild(g);var A=y("feMerge",t);h.appendChild(A);var E=y("feMergeNode",t);E.setAttribute("in","SourceGraphic");var S=y("feMergeNode",t);A.appendChild(E),A.appendChild(S)}return h.id=f,h.setAttribute("filterUnits","userSpaceOnUse"),void e.appendChild(h)}if("inner"===o){var x=h.children[1],C=h.children[2],O=h.children[3];"shadowColor"===a?O.setAttribute("flood-color",""+s):"shadowBlur"===a?x.setAttribute("stdDeviation","".concat((c||0)/4)):"shadowOffsetX"===a?C.setAttribute("dx","".concat((u||0)/2)):"shadowOffsetY"===a&&C.setAttribute("dy","".concat((d||0)/2))}else if("outer"===o){var T=h.children[0];"shadowColor"===a?T.setAttribute("flood-color",""+s):"shadowBlur"===a?T.setAttribute("stdDeviation","".concat((c||0)/4)):"shadowOffsetX"===a?T.setAttribute("dx","".concat((u||0)/2)):"shadowOffsetY"===a&&T.setAttribute("dy","".concat((d||0)/2))}}else null==r||r.removeAttribute("filter")}(this.context.config.document||document,this.$def,t,e,n)},t.prototype.createOrUpdateFilter=function(t,e,n){R(this.context.config.document||document,this.$def,t,e,n)},t}(),Q=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="svg-renderer",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.init=function(){var t=this.options,e=t.outputSVGElementId,n=t.outputSVGElementName,r=new z(this.context),a=new N(this.context);this.context.defaultElementLifeCycleContribution=a,this.context.SVGElementLifeCycleContribution=a;var i={outputSVGElementId:!!l(e)||!!e,outputSVGElementName:!!l(n)||!!n};this.addRenderingPlugin(new k(i,r,this.context))},e.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultElementLifeCycleContribution,delete this.context.SVGElementLifeCycleContribution},e}(e.AbstractRendererPlugin);t.CLIP_PATH_PREFIX=G,t.DEFAULT_VALUE_MAP=T,t.DefaultElementLifeCycleContribution=N,t.ElementSVG=f,t.G_SVG_PREFIX=M,t.Plugin=Q,t.SHAPE2TAGS=D,t.SHAPE_UPDATE_DEPS=V,t.SVGRendererPlugin=k,t.SVG_ATTR_MAP=C,t.TEXT_PATH_PREFIX=w,t.createSVGElement=y,t.updateImageElementAttribute=h,t.updateLineElementAttribute=m,t.updatePathElementAttribute=v,t.updatePolylineElementAttribute=b,t.updateRectElementAttribute=g,t.updateTextElementAttribute=P}));
//# sourceMappingURL=index.umd.min.js.map
