!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@antv/g-lite")):"function"==typeof define&&define.amd?define(["exports","@antv/g-lite"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).G=e.G||{},e.G.DeviceRenderer={}),e.window.G)}(this,(function(e,t){"use strict";var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+t+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;n>r;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)};function o(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);n.length>i;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function a(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&i[3]>s[1])){a.label=s[1];break}if(6===s[0]&&i[1]>a.label){a.label=i[1],i=s;break}if(i&&i[2]>a.label){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function c(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;o>i;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var f=function(){function e(){this.meshes=[]}return e.tag="c-renderable-3d",e}(),_=function(){function e(){this.lights=[]}return e.prototype.addLight=function(e){this.lights.push(e),this.sortLights()},e.prototype.removeLight=function(e){var t=this.lights.indexOf(e);this.lights.splice(t,1),this.sortLights()},e.prototype.addFog=function(e){this.fog=e},e.prototype.removeFog=function(e){this.fog=null},e.prototype.getFog=function(){return this.fog},e.prototype.getAllLights=function(){return this.lights},e.prototype.getDefines=function(){var e={USE_LIGHT:!!this.lights.length};return this.lights.forEach((function(t){e[t.define]||(e[t.define]=0),e[t.define]++})),e},e.prototype.sortLights=function(){this.lights.sort((function(e,t){return e.order-t.order}))},e}(),d=function(e){function r(r){var n=this,a=r.style,s=o(r,["style"]);return(n=e.call(this,i({type:t.Shape.MESH,style:i({x:"",y:"",z:"",lineWidth:0,anchor:[.5,.5,.5]},a)},s))||this).cullable.enable=!1,n.style.geometry.meshes.push(n),n.style.material.meshes.push(n),n}return n(r,e),r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.style.geometry.meshes,r=t.indexOf(this);t.splice(r,1),r=(t=this.style.material.meshes).indexOf(this),t.splice(r,1)},r}(t.DisplayObject),p=function(){function e(){}return e.prototype.update=function(e){var t=e.geometry.computeBoundingBox(),r=t.getMax(),n=t.getMin();return{width:r[0]-n[0],height:r[1]-n[1],depth:r[2]-n[2]}},e}(),h=function(){function e(){this.counter=0,this.id2DisplayObjectMap={}}return e.prototype.getId=function(e){var t=this.counter++;return this.id2DisplayObjectMap[t]=e,t},e.prototype.getById=function(e){return this.id2DisplayObjectMap[e]},e.prototype.reset=function(){this.counter=0,this.id2DisplayObjectMap={}},e.prototype.decodePickingColor=function(e){var t=u(e,3);return t[0]+256*t[1]+65536*t[2]-1},e.prototype.encodePickingColor=function(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]},e}(),E="undefined"!=typeof Float32Array?Float32Array:Array;function R(){var e=new E(16);return E!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function T(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function m(e,t,r,n,i,o,a,s,l,u,c,f,_,d,p,h){var R=new E(16);return R[0]=e,R[1]=t,R[2]=r,R[3]=n,R[4]=i,R[5]=o,R[6]=a,R[7]=s,R[8]=l,R[9]=u,R[10]=c,R[11]=f,R[12]=_,R[13]=d,R[14]=p,R[15]=h,R}function A(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var S,y=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=t[8],_=t[9],d=t[10],p=t[11],h=t[12],E=t[13],R=t[14],T=t[15],m=r[0],A=r[1],S=r[2],y=r[3];return e[0]=m*n+A*s+S*f+y*h,e[1]=m*i+A*l+S*_+y*E,e[2]=m*o+A*u+S*d+y*R,e[3]=m*a+A*c+S*p+y*T,e[4]=(m=r[4])*n+(A=r[5])*s+(S=r[6])*f+(y=r[7])*h,e[5]=m*i+A*l+S*_+y*E,e[6]=m*o+A*u+S*d+y*R,e[7]=m*a+A*c+S*p+y*T,e[8]=(m=r[8])*n+(A=r[9])*s+(S=r[10])*f+(y=r[11])*h,e[9]=m*i+A*l+S*_+y*E,e[10]=m*o+A*u+S*d+y*R,e[11]=m*a+A*c+S*p+y*T,e[12]=(m=r[12])*n+(A=r[13])*s+(S=r[14])*f+(y=r[15])*h,e[13]=m*i+A*l+S*_+y*E,e[14]=m*o+A*u+S*d+y*R,e[15]=m*a+A*c+S*p+y*T,e};function v(e,t,r){var n=new E(3);return n[0]=e,n[1]=t,n[2]=r,n}function g(e,t,r){return{x:e*Math.cos(r)-t*Math.sin(r),y:e*Math.sin(r)+t*Math.cos(r)}}function C(e,t,r,n,i,o,a,s,l,u){var c,f,_,d,p,h=e,E=t,R=r,T=n,m=s,A=l,S=120*Math.PI/180,y=Math.PI/180*(+i||0),v=[];if(u)f=u[0],_=u[1],d=u[2],p=u[3];else{E=(c=g(h,E,-y)).y;var F=((h=c.x)-(m=(c=g(m,A,-y)).x))/2,I=(E-(A=c.y))/2,M=F*F/(R*R)+I*I/(T*T);M>1&&(R*=M=Math.sqrt(M),T*=M);var O=R*R,P=T*T,N=(o===a?-1:1)*Math.sqrt(Math.abs((O*P-O*I*I-P*F*F)/(O*I*I+P*F*F)));d=N*R*I/T+(h+m)/2,f=Math.asin(((E-(p=N*-T*F/R+(E+A)/2))/T*1e9>>0)/1e9),_=Math.asin(((A-p)/T*1e9>>0)/1e9),0>(f=d>h?Math.PI-f:f)&&(f=2*Math.PI+f),0>(_=d>m?Math.PI-_:_)&&(_=2*Math.PI+_),a&&f>_&&(f-=2*Math.PI),!a&&_>f&&(_-=2*Math.PI)}var x=_-f;if(Math.abs(x)>S){var B=_,D=m,L=A;v=C(m=d+R*Math.cos(_=f+S*(a&&_>f?1:-1)),A=p+T*Math.sin(_),R,T,i,0,a,D,L,[_,B,d,p])}x=_-f;var b=Math.cos(f),U=Math.sin(f),G=Math.cos(_),k=Math.sin(_),w=Math.tan(x/4),V=4/3*R*w,W=4/3*T*w,X=[h,E],H=[h+V*U,E-W*b],Y=[m+V*k,A-W*G],K=[m,A];if(H[0]=2*X[0]-H[0],H[1]=2*X[1]-H[1],u)return H.concat(Y,K,v);for(var z=[],j=0,Z=(v=H.concat(Y,K,v)).length;Z>j;j+=1)z[j]=j%2?g(v[j-1],v[j],y).y:g(v[j],v[j+1],y).x;return z}S=new E(3),E!=Float32Array&&(S[0]=0,S[1]=0,S[2]=0);var F,I,M,O,P,N,x,B,D,L,b,U,G,k,w,V,W,X,H,Y,K,z,j,Z,q,J,Q=function(e){return null==e},$={}.toString,ee=function(e,t){return $.call(e)==="[object "+t+"]"},te=function(e){return ee(e,"String")},re=function(e,t,r){return t>e?t:e>r?r:e},ne=function(e){return ee(e,"Number")};function ie(t,r,n,i){return{dimension:e.TextureDimension.n2D,pixelFormat:t,width:r,height:n,depth:1,numLevels:i,usage:e.TextureUsage.Sampled}}function oe(e){return e}function ae(e,t,r){return e<<16|t<<8|r}function se(e){return e>>>8&255}function le(e){return e>>>16&255}function ue(e){return 255&e}function ce(t){switch(t){case e.FormatTypeFlags.F32:case e.FormatTypeFlags.U32:case e.FormatTypeFlags.S32:return 4;case e.FormatTypeFlags.U16:case e.FormatTypeFlags.S16:case e.FormatTypeFlags.F16:return 2;case e.FormatTypeFlags.U8:case e.FormatTypeFlags.S8:return 1;default:throw Error("whoops")}}function fe(e,t){if(void 0===t&&(t=""),!e)throw console.error(Error().stack),Error("Assert fail: ".concat(t))}function _e(e){if(null!=e)return e;throw Error("Missing object")}function de(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function pe(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function he(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function Ee(e,t,r,n){return void 0===n&&(n=1),{r:e,g:t,b:r,a:n}}e.GL=void 0,(F=e.GL||(e.GL={}))[F.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",F[F.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",F[F.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",F[F.POINTS=0]="POINTS",F[F.LINES=1]="LINES",F[F.LINE_LOOP=2]="LINE_LOOP",F[F.LINE_STRIP=3]="LINE_STRIP",F[F.TRIANGLES=4]="TRIANGLES",F[F.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",F[F.TRIANGLE_FAN=6]="TRIANGLE_FAN",F[F.ZERO=0]="ZERO",F[F.ONE=1]="ONE",F[F.SRC_COLOR=768]="SRC_COLOR",F[F.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",F[F.SRC_ALPHA=770]="SRC_ALPHA",F[F.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",F[F.DST_ALPHA=772]="DST_ALPHA",F[F.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",F[F.DST_COLOR=774]="DST_COLOR",F[F.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",F[F.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",F[F.CONSTANT_COLOR=32769]="CONSTANT_COLOR",F[F.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",F[F.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",F[F.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",F[F.FUNC_ADD=32774]="FUNC_ADD",F[F.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",F[F.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",F[F.BLEND_EQUATION=32777]="BLEND_EQUATION",F[F.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",F[F.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",F[F.BLEND_DST_RGB=32968]="BLEND_DST_RGB",F[F.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",F[F.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",F[F.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",F[F.BLEND_COLOR=32773]="BLEND_COLOR",F[F.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",F[F.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",F[F.LINE_WIDTH=2849]="LINE_WIDTH",F[F.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",F[F.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",F[F.CULL_FACE_MODE=2885]="CULL_FACE_MODE",F[F.FRONT_FACE=2886]="FRONT_FACE",F[F.DEPTH_RANGE=2928]="DEPTH_RANGE",F[F.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",F[F.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",F[F.DEPTH_FUNC=2932]="DEPTH_FUNC",F[F.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",F[F.STENCIL_FUNC=2962]="STENCIL_FUNC",F[F.STENCIL_FAIL=2964]="STENCIL_FAIL",F[F.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",F[F.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",F[F.STENCIL_REF=2967]="STENCIL_REF",F[F.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",F[F.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",F[F.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",F[F.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",F[F.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",F[F.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",F[F.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",F[F.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",F[F.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",F[F.VIEWPORT=2978]="VIEWPORT",F[F.SCISSOR_BOX=3088]="SCISSOR_BOX",F[F.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",F[F.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",F[F.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",F[F.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",F[F.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",F[F.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",F[F.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",F[F.RED_BITS=3410]="RED_BITS",F[F.GREEN_BITS=3411]="GREEN_BITS",F[F.BLUE_BITS=3412]="BLUE_BITS",F[F.ALPHA_BITS=3413]="ALPHA_BITS",F[F.DEPTH_BITS=3414]="DEPTH_BITS",F[F.STENCIL_BITS=3415]="STENCIL_BITS",F[F.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",F[F.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",F[F.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",F[F.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",F[F.SAMPLES=32937]="SAMPLES",F[F.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",F[F.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",F[F.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",F[F.VENDOR=7936]="VENDOR",F[F.RENDERER=7937]="RENDERER",F[F.VERSION=7938]="VERSION",F[F.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",F[F.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",F[F.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",F[F.STATIC_DRAW=35044]="STATIC_DRAW",F[F.STREAM_DRAW=35040]="STREAM_DRAW",F[F.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",F[F.ARRAY_BUFFER=34962]="ARRAY_BUFFER",F[F.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",F[F.BUFFER_SIZE=34660]="BUFFER_SIZE",F[F.BUFFER_USAGE=34661]="BUFFER_USAGE",F[F.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",F[F.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",F[F.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",F[F.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",F[F.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",F[F.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",F[F.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",F[F.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",F[F.CULL_FACE=2884]="CULL_FACE",F[F.FRONT=1028]="FRONT",F[F.BACK=1029]="BACK",F[F.FRONT_AND_BACK=1032]="FRONT_AND_BACK",F[F.BLEND=3042]="BLEND",F[F.DEPTH_TEST=2929]="DEPTH_TEST",F[F.DITHER=3024]="DITHER",F[F.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",F[F.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",F[F.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",F[F.SCISSOR_TEST=3089]="SCISSOR_TEST",F[F.STENCIL_TEST=2960]="STENCIL_TEST",F[F.NO_ERROR=0]="NO_ERROR",F[F.INVALID_ENUM=1280]="INVALID_ENUM",F[F.INVALID_VALUE=1281]="INVALID_VALUE",F[F.INVALID_OPERATION=1282]="INVALID_OPERATION",F[F.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",F[F.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",F[F.CW=2304]="CW",F[F.CCW=2305]="CCW",F[F.DONT_CARE=4352]="DONT_CARE",F[F.FASTEST=4353]="FASTEST",F[F.NICEST=4354]="NICEST",F[F.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",F[F.BYTE=5120]="BYTE",F[F.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",F[F.SHORT=5122]="SHORT",F[F.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",F[F.INT=5124]="INT",F[F.UNSIGNED_INT=5125]="UNSIGNED_INT",F[F.FLOAT=5126]="FLOAT",F[F.DOUBLE=5130]="DOUBLE",F[F.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",F[F.ALPHA=6406]="ALPHA",F[F.RGB=6407]="RGB",F[F.RGBA=6408]="RGBA",F[F.LUMINANCE=6409]="LUMINANCE",F[F.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",F[F.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",F[F.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",F[F.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",F[F.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",F[F.VERTEX_SHADER=35633]="VERTEX_SHADER",F[F.COMPILE_STATUS=35713]="COMPILE_STATUS",F[F.DELETE_STATUS=35712]="DELETE_STATUS",F[F.LINK_STATUS=35714]="LINK_STATUS",F[F.VALIDATE_STATUS=35715]="VALIDATE_STATUS",F[F.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",F[F.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",F[F.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",F[F.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",F[F.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",F[F.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",F[F.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",F[F.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",F[F.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",F[F.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",F[F.SHADER_TYPE=35663]="SHADER_TYPE",F[F.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",F[F.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",F[F.NEVER=512]="NEVER",F[F.ALWAYS=519]="ALWAYS",F[F.LESS=513]="LESS",F[F.EQUAL=514]="EQUAL",F[F.LEQUAL=515]="LEQUAL",F[F.GREATER=516]="GREATER",F[F.GEQUAL=518]="GEQUAL",F[F.NOTEQUAL=517]="NOTEQUAL",F[F.KEEP=7680]="KEEP",F[F.REPLACE=7681]="REPLACE",F[F.INCR=7682]="INCR",F[F.DECR=7683]="DECR",F[F.INVERT=5386]="INVERT",F[F.INCR_WRAP=34055]="INCR_WRAP",F[F.DECR_WRAP=34056]="DECR_WRAP",F[F.NEAREST=9728]="NEAREST",F[F.LINEAR=9729]="LINEAR",F[F.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",F[F.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",F[F.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",F[F.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",F[F.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",F[F.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",F[F.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",F[F.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",F[F.TEXTURE_2D=3553]="TEXTURE_2D",F[F.TEXTURE=5890]="TEXTURE",F[F.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",F[F.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",F[F.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",F[F.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",F[F.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",F[F.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",F[F.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",F[F.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",F[F.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",F[F.TEXTURE0=33984]="TEXTURE0",F[F.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",F[F.REPEAT=10497]="REPEAT",F[F.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",F[F.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",F[F.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",F[F.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",F[F.FLOAT_VEC2=35664]="FLOAT_VEC2",F[F.FLOAT_VEC3=35665]="FLOAT_VEC3",F[F.FLOAT_VEC4=35666]="FLOAT_VEC4",F[F.INT_VEC2=35667]="INT_VEC2",F[F.INT_VEC3=35668]="INT_VEC3",F[F.INT_VEC4=35669]="INT_VEC4",F[F.BOOL=35670]="BOOL",F[F.BOOL_VEC2=35671]="BOOL_VEC2",F[F.BOOL_VEC3=35672]="BOOL_VEC3",F[F.BOOL_VEC4=35673]="BOOL_VEC4",F[F.FLOAT_MAT2=35674]="FLOAT_MAT2",F[F.FLOAT_MAT3=35675]="FLOAT_MAT3",F[F.FLOAT_MAT4=35676]="FLOAT_MAT4",F[F.SAMPLER_2D=35678]="SAMPLER_2D",F[F.SAMPLER_CUBE=35680]="SAMPLER_CUBE",F[F.LOW_FLOAT=36336]="LOW_FLOAT",F[F.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",F[F.HIGH_FLOAT=36338]="HIGH_FLOAT",F[F.LOW_INT=36339]="LOW_INT",F[F.MEDIUM_INT=36340]="MEDIUM_INT",F[F.HIGH_INT=36341]="HIGH_INT",F[F.FRAMEBUFFER=36160]="FRAMEBUFFER",F[F.RENDERBUFFER=36161]="RENDERBUFFER",F[F.RGBA4=32854]="RGBA4",F[F.RGB5_A1=32855]="RGB5_A1",F[F.RGB565=36194]="RGB565",F[F.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",F[F.STENCIL_INDEX=6401]="STENCIL_INDEX",F[F.STENCIL_INDEX8=36168]="STENCIL_INDEX8",F[F.DEPTH_STENCIL=34041]="DEPTH_STENCIL",F[F.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",F[F.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",F[F.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",F[F.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",F[F.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",F[F.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",F[F.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",F[F.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",F[F.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",F[F.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",F[F.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",F[F.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",F[F.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",F[F.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",F[F.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",F[F.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",F[F.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",F[F.NONE=0]="NONE",F[F.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",F[F.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",F[F.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",F[F.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",F[F.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",F[F.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",F[F.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",F[F.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",F[F.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",F[F.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",F[F.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",F[F.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",F[F.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",F[F.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",F[F.READ_BUFFER=3074]="READ_BUFFER",F[F.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",F[F.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",F[F.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",F[F.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",F[F.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",F[F.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",F[F.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",F[F.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",F[F.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",F[F.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",F[F.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",F[F.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",F[F.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",F[F.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",F[F.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",F[F.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",F[F.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",F[F.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",F[F.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",F[F.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",F[F.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",F[F.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",F[F.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",F[F.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",F[F.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",F[F.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",F[F.RED=6403]="RED",F[F.RGB8=32849]="RGB8",F[F.RGBA8=32856]="RGBA8",F[F.RGB10_A2=32857]="RGB10_A2",F[F.TEXTURE_3D=32879]="TEXTURE_3D",F[F.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",F[F.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",F[F.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",F[F.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",F[F.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",F[F.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",F[F.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",F[F.SRGB=35904]="SRGB",F[F.SRGB8=35905]="SRGB8",F[F.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",F[F.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",F[F.RGBA32F=34836]="RGBA32F",F[F.RGB32F=34837]="RGB32F",F[F.RGBA16F=34842]="RGBA16F",F[F.RGB16F=34843]="RGB16F",F[F.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",F[F.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",F[F.R11F_G11F_B10F=35898]="R11F_G11F_B10F",F[F.RGB9_E5=35901]="RGB9_E5",F[F.RGBA32UI=36208]="RGBA32UI",F[F.RGB32UI=36209]="RGB32UI",F[F.RGBA16UI=36214]="RGBA16UI",F[F.RGB16UI=36215]="RGB16UI",F[F.RGBA8UI=36220]="RGBA8UI",F[F.RGB8UI=36221]="RGB8UI",F[F.RGBA32I=36226]="RGBA32I",F[F.RGB32I=36227]="RGB32I",F[F.RGBA16I=36232]="RGBA16I",F[F.RGB16I=36233]="RGB16I",F[F.RGBA8I=36238]="RGBA8I",F[F.RGB8I=36239]="RGB8I",F[F.RED_INTEGER=36244]="RED_INTEGER",F[F.RGB_INTEGER=36248]="RGB_INTEGER",F[F.RGBA_INTEGER=36249]="RGBA_INTEGER",F[F.R8=33321]="R8",F[F.RG8=33323]="RG8",F[F.R16F=33325]="R16F",F[F.R32F=33326]="R32F",F[F.RG16F=33327]="RG16F",F[F.RG32F=33328]="RG32F",F[F.R8I=33329]="R8I",F[F.R8UI=33330]="R8UI",F[F.R16I=33331]="R16I",F[F.R16UI=33332]="R16UI",F[F.R32I=33333]="R32I",F[F.R32UI=33334]="R32UI",F[F.RG8I=33335]="RG8I",F[F.RG8UI=33336]="RG8UI",F[F.RG16I=33337]="RG16I",F[F.RG16UI=33338]="RG16UI",F[F.RG32I=33339]="RG32I",F[F.RG32UI=33340]="RG32UI",F[F.R8_SNORM=36756]="R8_SNORM",F[F.RG8_SNORM=36757]="RG8_SNORM",F[F.RGB8_SNORM=36758]="RGB8_SNORM",F[F.RGBA8_SNORM=36759]="RGBA8_SNORM",F[F.RGB10_A2UI=36975]="RGB10_A2UI",F[F.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",F[F.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",F[F.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",F[F.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",F[F.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",F[F.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",F[F.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",F[F.HALF_FLOAT=5131]="HALF_FLOAT",F[F.RG=33319]="RG",F[F.RG_INTEGER=33320]="RG_INTEGER",F[F.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",F[F.CURRENT_QUERY=34917]="CURRENT_QUERY",F[F.QUERY_RESULT=34918]="QUERY_RESULT",F[F.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",F[F.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",F[F.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",F[F.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",F[F.DRAW_BUFFER0=34853]="DRAW_BUFFER0",F[F.DRAW_BUFFER1=34854]="DRAW_BUFFER1",F[F.DRAW_BUFFER2=34855]="DRAW_BUFFER2",F[F.DRAW_BUFFER3=34856]="DRAW_BUFFER3",F[F.DRAW_BUFFER4=34857]="DRAW_BUFFER4",F[F.DRAW_BUFFER5=34858]="DRAW_BUFFER5",F[F.DRAW_BUFFER6=34859]="DRAW_BUFFER6",F[F.DRAW_BUFFER7=34860]="DRAW_BUFFER7",F[F.DRAW_BUFFER8=34861]="DRAW_BUFFER8",F[F.DRAW_BUFFER9=34862]="DRAW_BUFFER9",F[F.DRAW_BUFFER10=34863]="DRAW_BUFFER10",F[F.DRAW_BUFFER11=34864]="DRAW_BUFFER11",F[F.DRAW_BUFFER12=34865]="DRAW_BUFFER12",F[F.DRAW_BUFFER13=34866]="DRAW_BUFFER13",F[F.DRAW_BUFFER14=34867]="DRAW_BUFFER14",F[F.DRAW_BUFFER15=34868]="DRAW_BUFFER15",F[F.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",F[F.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",F[F.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",F[F.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",F[F.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",F[F.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",F[F.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",F[F.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",F[F.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",F[F.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",F[F.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",F[F.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",F[F.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",F[F.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",F[F.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",F[F.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",F[F.SAMPLER_3D=35679]="SAMPLER_3D",F[F.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",F[F.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",F[F.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",F[F.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",F[F.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",F[F.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",F[F.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",F[F.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",F[F.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",F[F.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",F[F.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",F[F.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",F[F.MAX_SAMPLES=36183]="MAX_SAMPLES",F[F.SAMPLER_BINDING=35097]="SAMPLER_BINDING",F[F.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",F[F.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",F[F.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",F[F.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",F[F.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",F[F.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",F[F.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",F[F.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",F[F.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",F[F.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",F[F.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",F[F.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",F[F.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",F[F.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",F[F.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",F[F.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",F[F.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",F[F.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",F[F.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",F[F.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",F[F.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",F[F.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",F[F.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",F[F.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",F[F.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",F[F.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",F[F.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",F[F.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",F[F.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",F[F.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",F[F.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",F[F.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",F[F.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",F[F.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",F[F.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",F[F.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",F[F.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",F[F.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",F[F.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",F[F.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",F[F.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",F[F.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",F[F.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",F[F.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",F[F.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",F[F.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",F[F.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",F[F.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",F[F.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",F[F.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",F[F.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",F[F.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",F[F.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",F[F.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",F[F.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",F[F.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",F[F.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",F[F.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",F[F.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",F[F.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",F[F.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",F[F.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",F[F.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",F[F.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",F[F.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",F[F.UNIFORM_TYPE=35383]="UNIFORM_TYPE",F[F.UNIFORM_SIZE=35384]="UNIFORM_SIZE",F[F.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",F[F.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",F[F.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",F[F.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",F[F.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",F[F.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",F[F.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",F[F.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",F[F.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",F[F.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",F[F.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",F[F.OBJECT_TYPE=37138]="OBJECT_TYPE",F[F.SYNC_CONDITION=37139]="SYNC_CONDITION",F[F.SYNC_STATUS=37140]="SYNC_STATUS",F[F.SYNC_FLAGS=37141]="SYNC_FLAGS",F[F.SYNC_FENCE=37142]="SYNC_FENCE",F[F.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",F[F.UNSIGNALED=37144]="UNSIGNALED",F[F.SIGNALED=37145]="SIGNALED",F[F.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",F[F.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",F[F.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",F[F.WAIT_FAILED=37149]="WAIT_FAILED",F[F.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",F[F.COLOR=6144]="COLOR",F[F.DEPTH=6145]="DEPTH",F[F.STENCIL=6146]="STENCIL",F[F.MIN=32775]="MIN",F[F.MAX=32776]="MAX",F[F.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",F[F.STREAM_READ=35041]="STREAM_READ",F[F.STREAM_COPY=35042]="STREAM_COPY",F[F.STATIC_READ=35045]="STATIC_READ",F[F.STATIC_COPY=35046]="STATIC_COPY",F[F.DYNAMIC_READ=35049]="DYNAMIC_READ",F[F.DYNAMIC_COPY=35050]="DYNAMIC_COPY",F[F.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",F[F.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",F[F.INVALID_INDEX=4294967295]="INVALID_INDEX",F[F.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",F[F.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",F[F.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",F[F.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",F[F.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",F[F.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",F[F.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",F[F.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",F[F.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",F[F.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",F[F.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",F[F.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",F[F.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",F[F.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",F[F.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",F[F.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",F[F.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",F[F.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",F[F.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",F[F.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",F[F.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",F[F.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",F[F.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",F[F.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",F[F.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",F[F.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",F[F.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",F[F.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",F[F.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",F[F.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",F[F.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",F[F.RGBA32F_EXT=34836]="RGBA32F_EXT",F[F.RGB32F_EXT=34837]="RGB32F_EXT",F[F.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",F[F.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",F[F.MIN_EXT=32775]="MIN_EXT",F[F.MAX_EXT=32776]="MAX_EXT",F[F.SRGB_EXT=35904]="SRGB_EXT",F[F.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",F[F.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",F[F.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",F[F.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",F[F.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",F[F.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",F[F.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",F[F.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",F[F.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",F[F.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",F[F.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",F[F.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",F[F.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",F[F.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",F[F.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",F[F.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",F[F.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",F[F.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",F[F.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",F[F.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",F[F.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",F[F.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",F[F.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",F[F.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",F[F.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",F[F.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",F[F.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",F[F.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",F[F.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",F[F.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",F[F.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",F[F.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",F[F.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",F[F.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",F[F.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",F[F.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",F[F.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",F[F.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",F[F.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",F[F.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",F[F.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",F[F.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",F[F.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",F[F.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",F[F.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",F[F.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e.ResourceType=void 0,(I=e.ResourceType||(e.ResourceType={}))[I.Buffer=0]="Buffer",I[I.Texture=1]="Texture",I[I.RenderTarget=2]="RenderTarget",I[I.Sampler=3]="Sampler",I[I.Program=4]="Program",I[I.Bindings=5]="Bindings",I[I.InputLayout=6]="InputLayout",I[I.InputState=7]="InputState",I[I.RenderPipeline=8]="RenderPipeline",I[I.ComputePipeline=9]="ComputePipeline",I[I.Readback=10]="Readback",I[I.QueryPool=11]="QueryPool",e.CompareMode=void 0,(M=e.CompareMode||(e.CompareMode={}))[M.Never=512]="Never",M[M.Less=513]="Less",M[M.Equal=514]="Equal",M[M.LessEqual=515]="LessEqual",M[M.Greater=516]="Greater",M[M.NotEqual=517]="NotEqual",M[M.GreaterEqual=518]="GreaterEqual",M[M.Always=519]="Always",e.FrontFaceMode=void 0,(O=e.FrontFaceMode||(e.FrontFaceMode={}))[O.CCW=2305]="CCW",O[O.CW=2304]="CW",e.CullMode=void 0,(P=e.CullMode||(e.CullMode={}))[P.None=0]="None",P[P.Front=1]="Front",P[P.Back=2]="Back",P[P.FrontAndBack=3]="FrontAndBack",e.BlendFactor=void 0,(N=e.BlendFactor||(e.BlendFactor={}))[N.Zero=0]="Zero",N[N.One=1]="One",N[N.Src=768]="Src",N[N.OneMinusSrc=769]="OneMinusSrc",N[N.Dst=774]="Dst",N[N.OneMinusDst=775]="OneMinusDst",N[N.SrcAlpha=770]="SrcAlpha",N[N.OneMinusSrcAlpha=771]="OneMinusSrcAlpha",N[N.DstAlpha=772]="DstAlpha",N[N.OneMinusDstAlpha=773]="OneMinusDstAlpha",e.BlendMode=void 0,(x=e.BlendMode||(e.BlendMode={}))[x.Add=32774]="Add",x[x.Subtract=32778]="Subtract",x[x.ReverseSubtract=32779]="ReverseSubtract",e.WrapMode=void 0,(B=e.WrapMode||(e.WrapMode={}))[B.Clamp=0]="Clamp",B[B.Repeat=1]="Repeat",B[B.Mirror=2]="Mirror",e.TexFilterMode=void 0,(D=e.TexFilterMode||(e.TexFilterMode={}))[D.Point=0]="Point",D[D.Bilinear=1]="Bilinear",e.MipFilterMode=void 0,(L=e.MipFilterMode||(e.MipFilterMode={}))[L.NoMip=0]="NoMip",L[L.Nearest=1]="Nearest",L[L.Linear=2]="Linear",e.PrimitiveTopology=void 0,(b=e.PrimitiveTopology||(e.PrimitiveTopology={}))[b.Points=0]="Points",b[b.Triangles=1]="Triangles",b[b.TriangleStrip=2]="TriangleStrip",b[b.Lines=3]="Lines",b[b.LineStrip=4]="LineStrip",e.BufferUsage=void 0,(U=e.BufferUsage||(e.BufferUsage={}))[U.MAP_READ=1]="MAP_READ",U[U.MAP_WRITE=2]="MAP_WRITE",U[U.COPY_SRC=4]="COPY_SRC",U[U.COPY_DST=8]="COPY_DST",U[U.INDEX=16]="INDEX",U[U.VERTEX=32]="VERTEX",U[U.UNIFORM=64]="UNIFORM",U[U.STORAGE=128]="STORAGE",U[U.INDIRECT=256]="INDIRECT",U[U.QUERY_RESOLVE=512]="QUERY_RESOLVE",e.BufferFrequencyHint=void 0,(G=e.BufferFrequencyHint||(e.BufferFrequencyHint={}))[G.Static=1]="Static",G[G.Dynamic=2]="Dynamic",e.VertexBufferFrequency=void 0,(k=e.VertexBufferFrequency||(e.VertexBufferFrequency={}))[k.PerVertex=1]="PerVertex",k[k.PerInstance=2]="PerInstance",e.TextureEvent=void 0,(e.TextureEvent||(e.TextureEvent={})).LOADED="loaded",e.TextureDimension=void 0,(w=e.TextureDimension||(e.TextureDimension={}))[w.n2D=0]="n2D",w[w.n2DArray=1]="n2DArray",w[w.n3D=2]="n3D",w[w.Cube=3]="Cube",e.TextureUsage=void 0,(V=e.TextureUsage||(e.TextureUsage={}))[V.Sampled=1]="Sampled",V[V.RenderTarget=2]="RenderTarget",e.ChannelWriteMask=void 0,(W=e.ChannelWriteMask||(e.ChannelWriteMask={}))[W.None=0]="None",W[W.Red=1]="Red",W[W.Green=2]="Green",W[W.Blue=4]="Blue",W[W.Alpha=8]="Alpha",W[W.RGB=7]="RGB",W[W.AllChannels=15]="AllChannels",e.StencilOp=void 0,(X=e.StencilOp||(e.StencilOp={}))[X.Keep=7680]="Keep",X[X.Zero=0]="Zero",X[X.Replace=7681]="Replace",X[X.Invert=5386]="Invert",X[X.IncrementClamp=7682]="IncrementClamp",X[X.DecrementClamp=7683]="DecrementClamp",X[X.IncrementWrap=34055]="IncrementWrap",X[X.DecrementWrap=34056]="DecrementWrap",e.SamplerFormatKind=void 0,(H=e.SamplerFormatKind||(e.SamplerFormatKind={}))[H.Float=0]="Float",H[H.Uint=1]="Uint",H[H.Sint=2]="Sint",H[H.Depth=3]="Depth",e.ViewportOrigin=void 0,(Y=e.ViewportOrigin||(e.ViewportOrigin={}))[Y.LowerLeft=0]="LowerLeft",Y[Y.UpperLeft=1]="UpperLeft",e.ClipSpaceNearZ=void 0,(K=e.ClipSpaceNearZ||(e.ClipSpaceNearZ={}))[K.NegativeOne=0]="NegativeOne",K[K.Zero=1]="Zero",e.QueryPoolType=void 0,(z=e.QueryPoolType||(e.QueryPoolType={}))[z.OcclusionConservative=0]="OcclusionConservative",e.FormatTypeFlags=void 0,(j=e.FormatTypeFlags||(e.FormatTypeFlags={}))[j.U8=1]="U8",j[j.U16=2]="U16",j[j.U32=3]="U32",j[j.S8=4]="S8",j[j.S16=5]="S16",j[j.S32=6]="S32",j[j.F16=7]="F16",j[j.F32=8]="F32",j[j.BC1=65]="BC1",j[j.BC2=66]="BC2",j[j.BC3=67]="BC3",j[j.BC4_UNORM=68]="BC4_UNORM",j[j.BC4_SNORM=69]="BC4_SNORM",j[j.BC5_UNORM=70]="BC5_UNORM",j[j.BC5_SNORM=71]="BC5_SNORM",j[j.U16_PACKED_5551=97]="U16_PACKED_5551",j[j.D24=129]="D24",j[j.D32F=130]="D32F",j[j.D24S8=131]="D24S8",j[j.D32FS8=132]="D32FS8",e.FormatCompFlags=void 0,(Z=e.FormatCompFlags||(e.FormatCompFlags={}))[Z.R=1]="R",Z[Z.RG=2]="RG",Z[Z.RGB=3]="RGB",Z[Z.RGBA=4]="RGBA",Z[Z.A=5]="A",e.FormatFlags=void 0,(q=e.FormatFlags||(e.FormatFlags={}))[q.None=0]="None",q[q.Normalized=1]="Normalized",q[q.sRGB=2]="sRGB",q[q.Depth=4]="Depth",q[q.Stencil=8]="Stencil",q[q.RenderTarget=16]="RenderTarget",e.Format=void 0,(J=e.Format||(e.Format={}))[J.ALPHA=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.A,e.FormatFlags.None)]="ALPHA",J[J.F16_R=ae(e.FormatTypeFlags.F16,e.FormatCompFlags.R,e.FormatFlags.None)]="F16_R",J[J.F16_RG=ae(e.FormatTypeFlags.F16,e.FormatCompFlags.RG,e.FormatFlags.None)]="F16_RG",J[J.F16_RGB=ae(e.FormatTypeFlags.F16,e.FormatCompFlags.RGB,e.FormatFlags.None)]="F16_RGB",J[J.F16_RGBA=ae(e.FormatTypeFlags.F16,e.FormatCompFlags.RGBA,e.FormatFlags.None)]="F16_RGBA",J[J.F32_R=ae(e.FormatTypeFlags.F32,e.FormatCompFlags.R,e.FormatFlags.None)]="F32_R",J[J.F32_RG=ae(e.FormatTypeFlags.F32,e.FormatCompFlags.RG,e.FormatFlags.None)]="F32_RG",J[J.F32_RGB=ae(e.FormatTypeFlags.F32,e.FormatCompFlags.RGB,e.FormatFlags.None)]="F32_RGB",J[J.F32_RGBA=ae(e.FormatTypeFlags.F32,e.FormatCompFlags.RGBA,e.FormatFlags.None)]="F32_RGBA",J[J.U8_R=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.R,e.FormatFlags.None)]="U8_R",J[J.U8_R_NORM=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.R,e.FormatFlags.Normalized)]="U8_R_NORM",J[J.U8_RG=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RG,e.FormatFlags.None)]="U8_RG",J[J.U8_RG_NORM=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RG,e.FormatFlags.Normalized)]="U8_RG_NORM",J[J.U8_RGB=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGB,e.FormatFlags.None)]="U8_RGB",J[J.U8_RGB_NORM=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGB,e.FormatFlags.Normalized)]="U8_RGB_NORM",J[J.U8_RGB_SRGB=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGB,e.FormatFlags.sRGB|e.FormatFlags.Normalized)]="U8_RGB_SRGB",J[J.U8_RGBA=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGBA,e.FormatFlags.None)]="U8_RGBA",J[J.U8_RGBA_NORM=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized)]="U8_RGBA_NORM",J[J.U8_RGBA_SRGB=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGBA,e.FormatFlags.sRGB|e.FormatFlags.Normalized)]="U8_RGBA_SRGB",J[J.U16_R=ae(e.FormatTypeFlags.U16,e.FormatCompFlags.R,e.FormatFlags.None)]="U16_R",J[J.U16_R_NORM=ae(e.FormatTypeFlags.U16,e.FormatCompFlags.R,e.FormatFlags.Normalized)]="U16_R_NORM",J[J.U16_RG_NORM=ae(e.FormatTypeFlags.U16,e.FormatCompFlags.RG,e.FormatFlags.Normalized)]="U16_RG_NORM",J[J.U16_RGBA_NORM=ae(e.FormatTypeFlags.U16,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized)]="U16_RGBA_NORM",J[J.U16_RGB=ae(e.FormatTypeFlags.U16,e.FormatCompFlags.RGB,e.FormatFlags.None)]="U16_RGB",J[J.U32_R=ae(e.FormatTypeFlags.U32,e.FormatCompFlags.R,e.FormatFlags.None)]="U32_R",J[J.U32_RG=ae(e.FormatTypeFlags.U32,e.FormatCompFlags.RG,e.FormatFlags.None)]="U32_RG",J[J.S8_R=ae(e.FormatTypeFlags.S8,e.FormatCompFlags.R,e.FormatFlags.None)]="S8_R",J[J.S8_R_NORM=ae(e.FormatTypeFlags.S8,e.FormatCompFlags.R,e.FormatFlags.Normalized)]="S8_R_NORM",J[J.S8_RG_NORM=ae(e.FormatTypeFlags.S8,e.FormatCompFlags.RG,e.FormatFlags.Normalized)]="S8_RG_NORM",J[J.S8_RGB_NORM=ae(e.FormatTypeFlags.S8,e.FormatCompFlags.RGB,e.FormatFlags.Normalized)]="S8_RGB_NORM",J[J.S8_RGBA_NORM=ae(e.FormatTypeFlags.S8,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized)]="S8_RGBA_NORM",J[J.S16_R=ae(e.FormatTypeFlags.S16,e.FormatCompFlags.R,e.FormatFlags.None)]="S16_R",J[J.S16_RG=ae(e.FormatTypeFlags.S16,e.FormatCompFlags.RG,e.FormatFlags.None)]="S16_RG",J[J.S16_RG_NORM=ae(e.FormatTypeFlags.S16,e.FormatCompFlags.RG,e.FormatFlags.Normalized)]="S16_RG_NORM",J[J.S16_RGB_NORM=ae(e.FormatTypeFlags.S16,e.FormatCompFlags.RGB,e.FormatFlags.Normalized)]="S16_RGB_NORM",J[J.S16_RGBA=ae(e.FormatTypeFlags.S16,e.FormatCompFlags.RGBA,e.FormatFlags.None)]="S16_RGBA",J[J.S16_RGBA_NORM=ae(e.FormatTypeFlags.S16,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized)]="S16_RGBA_NORM",J[J.S32_R=ae(e.FormatTypeFlags.S32,e.FormatCompFlags.R,e.FormatFlags.None)]="S32_R",J[J.U16_RGBA_5551=ae(e.FormatTypeFlags.U16_PACKED_5551,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized)]="U16_RGBA_5551",J[J.BC1=ae(e.FormatTypeFlags.BC1,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized)]="BC1",J[J.BC1_SRGB=ae(e.FormatTypeFlags.BC1,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized|e.FormatFlags.sRGB)]="BC1_SRGB",J[J.BC2=ae(e.FormatTypeFlags.BC2,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized)]="BC2",J[J.BC2_SRGB=ae(e.FormatTypeFlags.BC2,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized|e.FormatFlags.sRGB)]="BC2_SRGB",J[J.BC3=ae(e.FormatTypeFlags.BC3,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized)]="BC3",J[J.BC3_SRGB=ae(e.FormatTypeFlags.BC3,e.FormatCompFlags.RGBA,e.FormatFlags.Normalized|e.FormatFlags.sRGB)]="BC3_SRGB",J[J.BC4_UNORM=ae(e.FormatTypeFlags.BC4_UNORM,e.FormatCompFlags.R,e.FormatFlags.Normalized)]="BC4_UNORM",J[J.BC4_SNORM=ae(e.FormatTypeFlags.BC4_SNORM,e.FormatCompFlags.R,e.FormatFlags.Normalized)]="BC4_SNORM",J[J.BC5_UNORM=ae(e.FormatTypeFlags.BC5_UNORM,e.FormatCompFlags.RG,e.FormatFlags.Normalized)]="BC5_UNORM",J[J.BC5_SNORM=ae(e.FormatTypeFlags.BC5_SNORM,e.FormatCompFlags.RG,e.FormatFlags.Normalized)]="BC5_SNORM",J[J.D24=ae(e.FormatTypeFlags.D24,e.FormatCompFlags.R,e.FormatFlags.Depth)]="D24",J[J.D24_S8=ae(e.FormatTypeFlags.D24S8,e.FormatCompFlags.RG,e.FormatFlags.Depth|e.FormatFlags.Stencil)]="D24_S8",J[J.D32F=ae(e.FormatTypeFlags.D32F,e.FormatCompFlags.R,e.FormatFlags.Depth)]="D32F",J[J.D32F_S8=ae(e.FormatTypeFlags.D32FS8,e.FormatCompFlags.RG,e.FormatFlags.Depth|e.FormatFlags.Stencil)]="D32F_S8",J[J.U8_RGB_RT=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGB,e.FormatFlags.RenderTarget|e.FormatFlags.Normalized)]="U8_RGB_RT",J[J.U8_RGBA_RT=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGBA,e.FormatFlags.RenderTarget|e.FormatFlags.Normalized)]="U8_RGBA_RT",J[J.U8_RGBA_RT_SRGB=ae(e.FormatTypeFlags.U8,e.FormatCompFlags.RGBA,e.FormatFlags.RenderTarget|e.FormatFlags.Normalized|e.FormatFlags.sRGB)]="U8_RGBA_RT_SRGB";var Re=Ee(0,0,0,0),Te=Ee(0,0,0,1),me=Ee(1,1,1,0),Ae=Ee(1,1,1,1),Se=!0;function ye(t,r){if(void 0===r&&(r=Se),!r)return t;switch(t){case e.CompareMode.Less:return e.CompareMode.Greater;case e.CompareMode.LessEqual:return e.CompareMode.GreaterEqual;case e.CompareMode.GreaterEqual:return e.CompareMode.LessEqual;case e.CompareMode.Greater:return e.CompareMode.Less;default:return t}}function ve(e,t){return null!=e?e:t}function ge(e){return void 0===e?null:e}function Ce(e,t,r){e.length=t,e.fill(r)}function Fe(e,t){return((e+t-1)/t|0)*t}function Ie(e,t,r){for(var n=0,i=e.length;i>n;){var o=n+(i-n>>>1);0>r(t,e[o])?i=o:n=o+1}return n}function Me(e,t,r){var n=Ie(e,t,r);e.splice(n,0,t)}function Oe(e,t,r){return r?e|=t:e&=~t,e}function Pe(e,t){for(var r=Array(e),n=0;e>n;n++)r[n]=t();return r}function Ne(e,t,r){for(void 0===r&&(r="0");t>e.length;)e="".concat(r).concat(e);return e}function xe(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function Be(e,t){return void 0===e&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),xe(e.rgbBlendState,t.rgbBlendState),xe(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function De(e,t){e.length!==t.length&&(e.length=t.length);for(var r=0;t.length>r;r++)e[r]=Be(e[r],t[r])}function Le(e,t){void 0!==t.attachmentsState&&De(e.attachmentsState,t.attachmentsState),void 0!==t.blendConstant&&pe(e.blendConstant,t.blendConstant),e.depthCompare=ve(t.depthCompare,e.depthCompare),e.depthWrite=ve(t.depthWrite,e.depthWrite),e.stencilCompare=ve(t.stencilCompare,e.stencilCompare),e.stencilWrite=ve(t.stencilWrite,e.stencilWrite),e.stencilPassOp=ve(t.stencilPassOp,e.stencilPassOp),e.stencilRef=ve(t.stencilRef,e.stencilRef),e.cullMode=ve(t.cullMode,e.cullMode),e.frontFace=ve(t.frontFace,e.frontFace),e.polygonOffset=ve(t.polygonOffset,e.polygonOffset)}function be(e){var t=Object.assign({},e);return t.attachmentsState=[],De(t.attachmentsState,e.attachmentsState),t.blendConstant=he(t.blendConstant),t}function Ue(e,t){void 0!==t.channelWriteMask&&(e.channelWriteMask=t.channelWriteMask),void 0!==t.rgbBlendMode&&(e.rgbBlendState.blendMode=t.rgbBlendMode),void 0!==t.alphaBlendMode&&(e.alphaBlendState.blendMode=t.alphaBlendMode),void 0!==t.rgbBlendSrcFactor&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),void 0!==t.alphaBlendSrcFactor&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),void 0!==t.rgbBlendDstFactor&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),void 0!==t.alphaBlendDstFactor&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}var Ge={blendMode:e.BlendMode.Add,blendSrcFactor:e.BlendFactor.One,blendDstFactor:e.BlendFactor.Zero},ke={attachmentsState:[{channelWriteMask:e.ChannelWriteMask.RGB,rgbBlendState:Ge,alphaBlendState:Ge}],blendConstant:he(Re),depthWrite:!0,depthCompare:e.CompareMode.LessEqual,stencilCompare:e.CompareMode.Always,stencilWrite:!1,stencilPassOp:e.StencilOp.Keep,stencilRef:0,cullMode:e.CullMode.None,frontFace:e.FrontFaceMode.CCW,polygonOffset:!1};function we(e,t){void 0===e&&(e=null),void 0===t&&(t=ke);var r=be(t);return null!==e&&Le(r,e),r}var Ve=we({depthCompare:e.CompareMode.Always,depthWrite:!1},ke);function We(e,t){return void 0===e.attachmentsState&&(e.attachmentsState=[],De(e.attachmentsState,ke.attachmentsState)),Ue(e.attachmentsState[0],t),e}var Xe,He={formatKind:e.SamplerFormatKind.Float,dimension:e.TextureDimension.n2D};function Ye(e,t,r){if(e.length!==t.length)return!1;for(var n=0;e.length>n;n++)if(!r(e[n],t[n]))return!1;return!0}function Ke(e,t){for(var r=Array(e.length),n=0;e.length>n;n++)r[n]=t(e[n]);return r}function ze(e,t){return e.buffer===t.buffer&&e.wordCount===t.wordCount}function je(e,t){return e.dimension===t.dimension&&e.formatKind===t.formatKind}function Ze(e,t){return null===e?null===t:null!==t&&(e.sampler===t.sampler&&e.texture===t.texture)}function qe(e,t){return e.samplerBindings.length===t.samplerBindings.length&&(!!Ye(e.samplerBindings,t.samplerBindings,Ze)&&(!!Ye(e.uniformBufferBindings,t.uniformBufferBindings,ze)&&!!$e(e.bindingLayout,t.bindingLayout)))}function Je(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function Qe(e,t){return!!Je(e.rgbBlendState,t.rgbBlendState)&&(!!Je(e.alphaBlendState,t.alphaBlendState)&&e.channelWriteMask===t.channelWriteMask)}function $e(e,t){return e.numSamplers===t.numSamplers&&e.numUniformBuffers===t.numUniformBuffers}function et(e,t){return e===t}function tt(e,t){return e.topology===t.topology&&(e.inputLayout===t.inputLayout&&(e.sampleCount===t.sampleCount&&(!!function(e,t){return!!Ye(e.attachmentsState,t.attachmentsState,Qe)&&!!de(e.blendConstant,t.blendConstant)&&e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilCompare===t.stencilCompare&&e.stencilWrite===t.stencilWrite&&e.stencilPassOp===t.stencilPassOp&&e.stencilRef===t.stencilRef&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset}(e.megaStateDescriptor,t.megaStateDescriptor)&&(!!function(e,t){return e.id===t.id}(e.program,t.program)&&(!!Ye(e.bindingLayouts,t.bindingLayouts,$e)&&(!!Ye(e.colorAttachmentFormats,t.colorAttachmentFormats,et)&&e.depthStencilAttachmentFormat===t.depthStencilAttachmentFormat))))))}function rt(e,t){return e.bufferIndex===t.bufferIndex&&e.bufferByteOffset===t.bufferByteOffset&&e.location===t.location&&e.format===t.format&&e.divisor===t.divisor}function nt(e,t){return Q(e)?Q(t):!Q(t)&&(e.byteStride===t.byteStride&&e.frequency===t.frequency)}function it(e,t){return e.indexBufferFormat===t.indexBufferFormat&&(!!Ye(e.vertexBufferDescriptors,t.vertexBufferDescriptors,nt)&&!!Ye(e.vertexAttributeDescriptors,t.vertexAttributeDescriptors,rt))}function ot(e,t){return e.wrapS===t.wrapS&&e.wrapT===t.wrapT&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipFilter===t.mipFilter&&e.minLOD===t.minLOD&&e.maxLOD===t.maxLOD&&e.maxAnisotropy===t.maxAnisotropy&&e.compareMode===t.compareMode}function at(e){return{sampler:e.sampler,texture:e.texture,lateBinding:e.lateBinding}}function st(e){return{buffer:e.buffer,wordCount:e.wordCount}}function lt(e){return{bindingLayout:e.bindingLayout,samplerBindings:Ke(e.samplerBindings,at),uniformBufferBindings:Ke(e.uniformBufferBindings,st),pipeline:e.pipeline}}function ut(e){return{dimension:e.dimension,formatKind:e.formatKind}}function ct(e){return{numSamplers:e.numSamplers,numUniformBuffers:e.numUniformBuffers,samplerEntries:void 0!==e.samplerEntries?Ke(e.samplerEntries,ut):void 0}}function ft(e){var t=Ke(e.bindingLayouts,ct),r=e.program,n=e.topology;return{bindingLayouts:t,inputLayout:e.inputLayout,megaStateDescriptor:be(e.megaStateDescriptor),program:r,topology:n,colorAttachmentFormats:e.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:e.depthStencilAttachmentFormat,sampleCount:e.sampleCount}}function _t(e){return{location:e.location,format:e.format,bufferIndex:e.bufferIndex,bufferByteOffset:e.bufferByteOffset,byteStride:e.byteStride,divisor:e.divisor}}function dt(e){return Q(e)?e:{byteStride:e.byteStride,frequency:e.frequency}}function pt(e){return{vertexAttributeDescriptors:Ke(e.vertexAttributeDescriptors,_t),vertexBufferDescriptors:Ke(e.vertexBufferDescriptors,dt),indexBufferFormat:e.indexBufferFormat}}e.Endianness=void 0,(Xe=e.Endianness||(e.Endianness={}))[Xe.LITTLE_ENDIAN=0]="LITTLE_ENDIAN",Xe[Xe.BIG_ENDIAN=1]="BIG_ENDIAN";var ht,Et=new Uint16Array([65279]),Rt=255==new DataView(Et.buffer).getUint8(0)?e.Endianness.LITTLE_ENDIAN:e.Endianness.BIG_ENDIAN;var Tt=/([^[]*)(\[[0-9]+\])?/;function mt(){var e=null;return function(t,r,n){var i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function At(e,t,r,n){var i=null,o=null;return function(a,s,l){var u=t(l,r),c=u.length,f=!1;if(null===i)i=new Float32Array(c),o=c,f=!0;else{fe(o===c,"Uniform length cannot change.");for(var _=0;c>_;++_)if(u[_]!==i[_]){f=!0;break}}return f&&(n(a,e,s,u),i.set(u)),f}}function St(e,t,r,n){e[t](r,n)}function yt(e,t,r,n){e[t](r,!1,n)}var vt={},gt={},Ct={},Ft=[0];function It(e,t,r,n){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(Ft[0]=e,e=Ft);var i=e.length;if(e instanceof r)return e;var o=n[i];o||(o=new r(i),n[i]=o);for(var a=0;i>a;a++)o[a]=e[a];return o}function Mt(e,t){return It(e,t,Float32Array,vt)}function Ot(e,t){return It(e,t,Int32Array,gt)}function Pt(e,t){return It(e,t,Uint32Array,Ct)}var Nt=((ht={})[e.GL.FLOAT]=At.bind(null,"uniform1fv",Mt,1,St),ht[e.GL.FLOAT_VEC2]=At.bind(null,"uniform2fv",Mt,2,St),ht[e.GL.FLOAT_VEC3]=At.bind(null,"uniform3fv",Mt,3,St),ht[e.GL.FLOAT_VEC4]=At.bind(null,"uniform4fv",Mt,4,St),ht[e.GL.INT]=At.bind(null,"uniform1iv",Ot,1,St),ht[e.GL.INT_VEC2]=At.bind(null,"uniform2iv",Ot,2,St),ht[e.GL.INT_VEC3]=At.bind(null,"uniform3iv",Ot,3,St),ht[e.GL.INT_VEC4]=At.bind(null,"uniform4iv",Ot,4,St),ht[e.GL.BOOL]=At.bind(null,"uniform1iv",Ot,1,St),ht[e.GL.BOOL_VEC2]=At.bind(null,"uniform2iv",Ot,2,St),ht[e.GL.BOOL_VEC3]=At.bind(null,"uniform3iv",Ot,3,St),ht[e.GL.BOOL_VEC4]=At.bind(null,"uniform4iv",Ot,4,St),ht[e.GL.FLOAT_MAT2]=At.bind(null,"uniformMatrix2fv",Mt,4,yt),ht[e.GL.FLOAT_MAT3]=At.bind(null,"uniformMatrix3fv",Mt,9,yt),ht[e.GL.FLOAT_MAT4]=At.bind(null,"uniformMatrix4fv",Mt,16,yt),ht[e.GL.UNSIGNED_INT]=At.bind(null,"uniform1uiv",Pt,1,St),ht[e.GL.UNSIGNED_INT_VEC2]=At.bind(null,"uniform2uiv",Pt,2,St),ht[e.GL.UNSIGNED_INT_VEC3]=At.bind(null,"uniform3uiv",Pt,3,St),ht[e.GL.UNSIGNED_INT_VEC4]=At.bind(null,"uniform4uiv",Pt,4,St),ht[e.GL.FLOAT_MAT2x3]=At.bind(null,"uniformMatrix2x3fv",Mt,6,yt),ht[e.GL.FLOAT_MAT2x4]=At.bind(null,"uniformMatrix2x4fv",Mt,8,yt),ht[e.GL.FLOAT_MAT3x2]=At.bind(null,"uniformMatrix3x2fv",Mt,6,yt),ht[e.GL.FLOAT_MAT3x4]=At.bind(null,"uniformMatrix3x4fv",Mt,12,yt),ht[e.GL.FLOAT_MAT4x2]=At.bind(null,"uniformMatrix4x2fv",Mt,8,yt),ht[e.GL.FLOAT_MAT4x3]=At.bind(null,"uniformMatrix4x3fv",Mt,12,yt),ht[e.GL.SAMPLER_2D]=mt,ht[e.GL.SAMPLER_CUBE]=mt,ht[e.GL.SAMPLER_3D]=mt,ht[e.GL.SAMPLER_2D_SHADOW]=mt,ht[e.GL.SAMPLER_2D_ARRAY]=mt,ht[e.GL.SAMPLER_2D_ARRAY_SHADOW]=mt,ht[e.GL.SAMPLER_CUBE_SHADOW]=mt,ht[e.GL.INT_SAMPLER_2D]=mt,ht[e.GL.INT_SAMPLER_3D]=mt,ht[e.GL.INT_SAMPLER_CUBE]=mt,ht[e.GL.INT_SAMPLER_2D_ARRAY]=mt,ht[e.GL.UNSIGNED_INT_SAMPLER_2D]=mt,ht[e.GL.UNSIGNED_INT_SAMPLER_3D]=mt,ht[e.GL.UNSIGNED_INT_SAMPLER_CUBE]=mt,ht[e.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY]=mt,ht);var xt=[[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]];function Bt(e,t){return"#define ".concat(e," ").concat(t)}function Dt(e){var t=[],r=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,(function(e,t,n){var i=[];return n.trim().split("\n").forEach((function(e){var t=u(e.trim().split(/\s+/),2),r=t[1];i.push({type:t[0].trim(),name:r.replace(";","").trim()})})),r.push({type:t.trim(),uniforms:i}),""})),e.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,n){return n.trim().split("\n").forEach((function(e){var n=e.trim().split(" "),i=n[0]||"",o=n[1]||"",a=o.indexOf("[")>-1;if(o=o.replace(";","").replace("[","").trim(),!i.startsWith("#")){if(i){var s=r.find((function(e){return i===e.type}));if(s)if(a)for(var l=function(e){s.uniforms.forEach((function(r){t.push("".concat(o,"[").concat(e,"].").concat(r.name))}))},u=0;5>u;u++)l(u);else s.uniforms.forEach((function(e){t.push("".concat(o,".").concat(e.name))}))}o&&t.push(o)}})),""})),t}function Lt(t,r,n,i,o){var a,s;void 0===i&&(i=null);var c="#version 100"===t.glslVersion,f=n.split("\n").map((function(e){return e.replace(/[/][/].*$/,"")})).filter((function(e){return!(!e||/^\s+$/.test(e))})),_="";null!==i&&(_=Object.keys(i).map((function(e){return Bt(e,i[e])})).join("\n"));var d=f.find((function(e){return e.startsWith("precision")}))||"precision mediump float;",p=f.filter((function(e){return!e.startsWith("precision")})).join("\n"),h="";if(t.viewportOrigin===e.ViewportOrigin.UpperLeft&&(h+="".concat(Bt("VIEWPORT_ORIGIN_TL","1"),"\n")),t.clipSpaceNearZ===e.ClipSpaceNearZ.Zero&&(h+="".concat(Bt("CLIPSPACE_NEAR_ZERO","1"),"\n")),t.explicitBindingLocations){var E=0,R=0,T=0;p=p.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(e,t,r,n){return"layout(".concat(r?"".concat(r,", "):"","set = ").concat(E,", binding = ").concat(R++,") uniform ").concat(n)})),E++,R=0,fe(t.separateSamplerTextures),p=(p=p.replace(/uniform sampler2D (.*);/g,(function(e,t){return"frag"===r?"\nlayout(set = ".concat(E,", binding = ").concat(R++,") uniform texture2D T_").concat(t,";\nlayout(set = ").concat(E,", binding = ").concat(R++,") uniform sampler S_").concat(t,";\n"):""}))).replace("frag"===r?/^\s*\b\s*(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(e,t){return"layout(location = ".concat(T++,") ").concat(t)})),h+="".concat(Bt("gl_VertexID","gl_VertexIndex"),"\n")}p=t.separateSamplerTextures?(p=(p=(p=p.replace(/\bPD_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"texture2D T_P_".concat(t,", sampler S_P_").concat(t)}))).replace(/\bPU_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"SAMPLER_2D(P_".concat(t,")")}))).replace(/\bPP_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"T_".concat(t,", S_").concat(t)}))).replace(/\bSAMPLER_2D\((.*?)\)/g,(function(e,t){return"sampler2D(T_".concat(t,", S_").concat(t,")")})):(p=(p=(p=p.replace(/\bPD_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"sampler2D P_".concat(t)}))).replace(/\bPU_SAMPLER_2D\((.*?)\)/g,(function(e,t){return"SAMPLER_2D(P_".concat(t,")")}))).replace(/\bPP_SAMPLER_2D\((.*?)\)/g,(function(e,t){return t}))).replace(/\bSAMPLER_2D\((.*?)\)/g,(function(e,t){return t}));var m="".concat(c?"":t.glslVersion,"\n").concat("","\n").concat(c&&"frag"===r?"#extension GL_OES_standard_derivatives : enable":"","\n").concat(d,"\n").concat(h,"\n").concat(_,"\n").concat(p,"\n").trim();if(t.explicitBindingLocations&&"frag"===r&&(m=m.replace(/^\b(out)\b/gm,(function(e,t){return"layout(location = 0) ".concat(t)}))),c){if("frag"===r&&(m=m.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,r){return"varying ".concat(t," ").concat(r,";\n")}))),"vert"===r&&(m=(m=m.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,r){return"varying ".concat(t," ").concat(r,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,r){return"attribute ".concat(t," ").concat(r,";\n")}))),m=m.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,t){return t.trim().replace(/^.*$/gm,(function(e){var t=e.trim();return t.startsWith("#")?t:e?"uniform ".concat(t):""}))})),"frag"===r){var A,S=(m=m.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,r){return A=r,"".concat(t," ").concat(r,";\n")}))).lastIndexOf("}");m=m.substring(0,S)+"\n  gl_FragColor = vec4(".concat(A,");\n")+m.substring(S)}m=m.replace(/^\s*layout\((.*)\)/gm,"");try{for(var y=l(xt),v=y.next();!v.done;v=y.next()){var g=u(v.value,2);m=m.replace(g[0],g[1])}}catch(e){a={error:e}}finally{try{v&&!v.done&&(s=y.return)&&s.call(y)}finally{if(a)throw a.error}}}return m}function bt(e,t,r,n,i){return void 0===n&&(n=null),{vert:t,frag:r,preprocessedVert:Lt(e,"vert",t,n),preprocessedFrag:Lt(e,"frag",r,n)}}function Ut(e,t){var r=void 0!==t.defines?t.defines:null,n=void 0!==t.both?t.both+t.vert:t.vert,i=void 0!==t.both?t.both+t.frag:t.frag;return bt(e.queryVendorInfo(),n,i,r)}var Gt=function(){function e(){this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines={},this.features={MRT:!0}}return e.prototype.definesChanged=function(){this.preprocessedVert="",this.preprocessedFrag=""},e.prototype.setDefineString=function(e,t){if(null!==t){if(this.defines[e]===t)return!1;this.defines[e]=t}else{if(Q(this.defines[e]))return!1;delete this.defines[e]}return this.definesChanged(),!0},e.prototype.setDefineBool=function(e,t){return this.setDefineString(e,t?"1":null)},e.prototype.getDefineString=function(e){return ge(this.defines[e])},e.prototype.getDefineBool=function(e){var t=this.getDefineString(e);return null!==t&&fe("1"===t),null!==t},e.prototype.ensurePreprocessed=function(e){""===this.preprocessedVert&&(this.preprocessedVert=Lt(e,"vert",this.both+this.vert,this.defines),this.preprocessedFrag=Lt(e,"frag",this.both+this.frag,this.defines))},e}(),kt=function(){function t(e){this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=e;var t=e.queryLimits();this.uniformBufferWordAlignment=t.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=t.uniformBufferMaxPageWordSize}return t.prototype.isSupportedUBO=function(){return"WebGL1"!==this.device.queryVendorInfo().platformString},t.prototype.findPageIndex=function(e){return e/this.uniformBufferMaxPageWordSize|0},t.prototype.allocateChunk=function(e){e=Fe(e,this.uniformBufferWordAlignment),fe(this.uniformBufferMaxPageWordSize>e);var t=this.currentWordOffset;return this.findPageIndex(t)!==this.findPageIndex(t+e-1)&&(t=Fe(t,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=t+e,this.ensureShadowBuffer(t,e),t},t.prototype.ensureShadowBuffer=function(e,t){if(null===this.shadowBufferU8||null===this.shadowBufferF32){var r=Fe(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(4*r),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(e+t>=this.shadowBufferF32.length){fe(this.currentWordOffset>e&&this.currentWordOffset>=e+t);r=Fe(Math.max(this.currentWordOffset,2*this.shadowBufferF32.length),this.uniformBufferMaxPageWordSize);var n=new Uint8Array(4*r);if(n.set(this.shadowBufferU8,0),this.shadowBufferU8=n,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),r<this.currentWordOffset)throw Error("Assert fail: this.currentWordOffset [".concat(this.currentWordOffset,"] <= newWordCount [").concat(r,"]"))}},t.prototype.mapBufferF32=function(){return _e(this.shadowBufferF32)},t.prototype.prepareToRender=function(){if(null!==this.shadowBufferF32){var t=_e(this.shadowBufferF32);t.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=t.length,null!==this.buffer&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:4*this.currentBufferWordSize,usage:e.BufferUsage.UNIFORM,hint:e.BufferFrequencyHint.Dynamic}));var r=Fe(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(this.currentBufferWordSize<r)throw Error("Assert fail: wordCount [".concat(r,"] (").concat(this.currentWordOffset," aligned ").concat(this.uniformBufferMaxPageWordSize,") <= this.currentBufferWordSize [").concat(this.currentBufferWordSize,"]"));if(this.isSupportedUBO())_e(this.buffer).setSubData(0,this.shadowBufferU8,0,4*r);this.currentWordOffset=0}},t.prototype.destroy=function(){null!==this.buffer&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null},t}();function wt(e,t){return e+=t,e+=e<<10,(e+=e>>>6)>>>0}function Vt(e){return e+=e<<3,e^=e>>>11,(e+=e<<15)>>>0}function Wt(e){return 0}var Xt=function(){this.keys=[],this.values=[]},Ht=function(){function e(e,t){this.keyEqualFunc=e,this.keyHashFunc=t,this.buckets=new Map}return e.prototype.findBucketIndex=function(e,t){for(var r=0;e.keys.length>r;r++)if(this.keyEqualFunc(t,e.keys[r]))return r;return-1},e.prototype.findBucket=function(e){var t=this.keyHashFunc(e);return this.buckets.get(t)},e.prototype.get=function(e){var t=this.findBucket(e);if(void 0===t)return null;var r=this.findBucketIndex(t,e);return 0>r?null:t.values[r]},e.prototype.add=function(e,t){var r=this.keyHashFunc(e);void 0===this.buckets.get(r)&&this.buckets.set(r,new Xt);var n=this.buckets.get(r);n.keys.push(e),n.values.push(t)},e.prototype.delete=function(e){var t=this.findBucket(e);if(void 0!==t){var r=this.findBucketIndex(t,e);-1!==r&&(t.keys.splice(r,1),t.values.splice(r,1))}},e.prototype.clear=function(){this.buckets.clear()},e.prototype.size=function(){var e,t,r=0;try{for(var n=l(this.buckets.values()),i=n.next();!i.done;i=n.next()){r+=i.value.values.length}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},e.prototype.values=function(){var e,t,r,n,i,o,a;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,7,8,9]),e=l(this.buckets.values()),t=e.next(),s.label=1;case 1:if(t.done)return[3,6];n=(r=t.value).values.length-1,s.label=2;case 2:return n<0?[3,5]:[4,r.values[n]];case 3:s.sent(),s.label=4;case 4:return n--,[3,2];case 5:return t=e.next(),[3,1];case 6:return[3,9];case 7:return i=s.sent(),o={error:i},[3,9];case 8:try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(o)throw o.error}return[7];case 9:return[2]}}))},e}();function Yt(e,t){return fe(""!==e.preprocessedVert&&""!==t.preprocessedVert),fe(""!==e.preprocessedFrag&&""!==t.preprocessedFrag),e.preprocessedVert===t.preprocessedVert&&e.preprocessedFrag===t.preprocessedFrag}function Kt(e,t){return e=wt(e,t.numUniformBuffers),e=wt(e,t.numSamplers)}function zt(e,t){return e=wt(e,t.blendMode),e=wt(e,t.blendSrcFactor),e=wt(e,t.blendDstFactor)}function jt(e,t){return e=zt(e,t.rgbBlendState),e=wt(e=zt(e,t.alphaBlendState),t.channelWriteMask)}function Zt(e,t){for(var r=0;t.attachmentsState.length>r;r++)e=jt(e,t.attachmentsState[r]);return e=function(e,t){return wt(e,t.r<<24|t.g<<16|t.b<<8|t.a)}(e,t.blendConstant),e=wt(e,t.depthCompare),e=wt(e,t.depthWrite?1:0),e=wt(e,t.stencilCompare),e=wt(e,t.stencilPassOp),e=wt(e,t.stencilWrite?1:0),e=wt(e,t.cullMode),e=wt(e,t.frontFace?1:0),e=wt(e,t.polygonOffset?1:0)}function qt(e){var t=0;t=wt(t,e.program.id),null!==e.inputLayout&&(t=wt(t,e.inputLayout.id));for(var r=0;e.bindingLayouts.length>r;r++)t=Kt(t,e.bindingLayouts[r]);t=Zt(t,e.megaStateDescriptor);for(r=0;e.colorAttachmentFormats.length>r;r++)t=wt(t,e.colorAttachmentFormats[r]||0);return Vt(t=wt(t,e.depthStencilAttachmentFormat||0))}function Jt(e){for(var t=0,r=0;e.samplerBindings.length>r;r++){null!==(n=e.samplerBindings[r])&&null!==n.texture&&(t=wt(t,n.texture.id))}for(r=0;e.uniformBufferBindings.length>r;r++){var n;null!==(n=e.uniformBufferBindings[r])&&null!==n.buffer&&(t=wt(t,n.buffer.id),t=wt(t,n.wordCount))}return Vt(t)}var Qt,$t,er=function(){function e(e){this.bindingsCache=new Ht(qe,Jt),this.renderPipelinesCache=new Ht(tt,qt),this.inputLayoutsCache=new Ht(it,Wt),this.programCache=new Ht(Yt,Wt),this.samplerCache=new Ht(ot,Wt),this.device=e}return e.prototype.createBindings=function(e){var t=this.bindingsCache.get(e);if(null===t){var r=lt(e);t=this.device.createBindings(r),this.bindingsCache.add(r,t)}return t},e.prototype.createRenderPipeline=function(e){var t=this.renderPipelinesCache.get(e);if(null===t){var r=ft(e);t=this.device.createRenderPipeline(r),this.renderPipelinesCache.add(r,t)}return t},e.prototype.createInputLayout=function(e){var t=this.inputLayoutsCache.get(e);if(null===t){var r=pt(e);t=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,t)}return t},e.prototype.createProgramSimple=function(e){var t,r=this.programCache.get(e);if(null===r){var n={preprocessedVert:(t=e).preprocessedVert,preprocessedFrag:t.preprocessedFrag,vert:t.vert,frag:t.frag};r=this.device.createProgramSimple(n),this.programCache.add(n,r)}return r},e.prototype.createProgram=function(e){return e.ensurePreprocessed(this.device.queryVendorInfo()),this.createProgramSimple(e)},e.prototype.createSampler=function(e){var t=this.samplerCache.get(e);return null===t&&(t=this.device.createSampler(e),this.samplerCache.add(e,t)),t},e.prototype.destroy=function(){var e,t,r,n,i,o,a,s,u,c;try{for(var f=l(this.bindingsCache.values()),_=f.next();!_.done;_=f.next()){_.value.destroy()}}catch(t){e={error:t}}finally{try{_&&!_.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}try{for(var d=l(this.renderPipelinesCache.values()),p=d.next();!p.done;p=d.next()){p.value.destroy()}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}try{for(var h=l(this.inputLayoutsCache.values()),E=h.next();!E.done;E=h.next()){E.value.destroy()}}catch(e){i={error:e}}finally{try{E&&!E.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}try{for(var R=l(this.programCache.values()),T=R.next();!T.done;T=R.next()){T.value.destroy()}}catch(e){a={error:e}}finally{try{T&&!T.done&&(s=R.return)&&s.call(R)}finally{if(a)throw a.error}}try{for(var m=l(this.samplerCache.values()),A=m.next();!A.done;A=m.next()){A.value.destroy()}}catch(e){u={error:e}}finally{try{A&&!A.done&&(c=m.return)&&c.call(m)}finally{if(u)throw u.error}}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()},e}();e.ToneMapping=void 0,(Qt=e.ToneMapping||(e.ToneMapping={})).NONE="none",Qt.LINEAR="LinearToneMapping",Qt.REINHARD="ReinhardToneMapping",Qt.CINEON="OptimizedCineonToneMapping",Qt.ACES_FILMIC="ACESFilmicToneMapping",Qt.CUSTOM="CustomToneMapping",e.RGAttachmentSlot=void 0,($t=e.RGAttachmentSlot||(e.RGAttachmentSlot={}))[$t.Color0=0]="Color0",$t[$t.Color1=1]="Color1",$t[$t.Color2=2]="Color2",$t[$t.Color3=3]="Color3",$t[$t.ColorMax=3]="ColorMax",$t[$t.DepthStencil=4]="DepthStencil";var tr,rr=function(){function e(){this.renderTargetIDs=[],this.renderTargetLevels=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureOutputExternalTextureLevel=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorAttachmentLevel:[],colorResolveTo:[],colorResolveToLevel:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=1,this.viewportH=1,this.execFunc=null,this.postFunc=null,this.debugThumbnails=[]}return e.prototype.setDebugName=function(e){this.debugName=e},e.prototype.pushDebugThumbnail=function(e){this.debugThumbnails[e]=!0},e.prototype.setViewport=function(e,t,r,n){this.viewportX=e,this.viewportY=t,this.viewportW=r,this.viewportH=n},e.prototype.attachRenderTargetID=function(e,t,r){void 0===r&&(r=0),fe(void 0===this.renderTargetIDs[e]),this.renderTargetIDs[e]=t,this.renderTargetLevels[e]=r},e.prototype.attachResolveTexture=function(e){this.resolveTextureInputIDs.push(e)},e.prototype.attachOcclusionQueryPool=function(e){this.descriptor.occlusionQueryPool=e},e.prototype.resolveToExternalTexture=function(e,t){this.resolveTextureOutputExternalTextures[e]=t},e.prototype.exec=function(e){fe(null===this.execFunc),this.execFunc=e},e.prototype.post=function(e){fe(null===this.postFunc),this.postFunc=e},e.prototype.addExtraRef=function(e){this.renderTargetExtraRefs[e]=!0},e}(),nr=function(){function t(t,r){this.dimension=e.TextureDimension.n2D,this.depth=1,this.numLevels=1,this.width=0,this.height=0,this.sampleCount=0,this.usage=e.TextureUsage.RenderTarget,this.immutable=!0,this.needsClear=!0,this.texture=null,this.age=0,this.pixelFormat=r.pixelFormat,this.width=r.width,this.height=r.height,this.sampleCount=r.sampleCount,fe(this.sampleCount>=1),this.sampleCount>1?this.attachment=t.createRenderTarget(this):(this.texture=t.createTexture(this),this.attachment=t.createRenderTargetFromTexture(this.texture))}return t.prototype.setDebugName=function(e,t){this.debugName=t,null!==this.texture&&e.setResourceName(this.texture,this.debugName),e.setResourceName(this.attachment,this.debugName)},t.prototype.matchesDescription=function(e){return this.pixelFormat===e.pixelFormat&&this.width===e.width&&this.height===e.height&&this.sampleCount===e.sampleCount},t.prototype.reset=function(e){fe(this.matchesDescription(e)),this.age=0},t.prototype.destroy=function(){null!==this.texture&&this.texture.destroy(),this.attachment.destroy()},t}(),ir=function(){function t(t,r){this.dimension=e.TextureDimension.n2D,this.depth=1,this.numLevels=1,this.usage=e.TextureUsage.RenderTarget,this.width=0,this.height=0,this.age=0,this.immutable=!0,this.pixelFormat=r.pixelFormat,this.width=r.width,this.height=r.height,this.texture=t.createTexture(this)}return t.prototype.matchesDescription=function(e){return this.pixelFormat===e.pixelFormat&&this.width===e.width&&this.height===e.height},t.prototype.reset=function(e){fe(this.matchesDescription(e)),this.age=0},t.prototype.destroy=function(){this.texture.destroy()},t}(),or=function(){this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]},ar=function(){function t(e){this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=e}return t.prototype.acquireRenderTargetForDescription=function(e){for(var t=0;this.renderTargetDeadPool.length>t;t++){var r=this.renderTargetDeadPool[t];if(r.matchesDescription(e))return r.reset(e),this.renderTargetDeadPool.splice(t--,1),r}return new nr(this.device,e)},t.prototype.acquireSingleSampledTextureForDescription=function(e){for(var t=0;this.singleSampledTextureDeadPool.length>t;t++){var r=this.singleSampledTextureDeadPool[t];if(r.matchesDescription(e))return r.reset(e),this.singleSampledTextureDeadPool.splice(t--,1),r}return new ir(this.device,e)},t.prototype.beginGraphBuilder=function(){fe(null===this.currentGraph),this.currentGraph=new or},t.prototype.pushPass=function(e){var t=new rr;e(t),this.currentGraph.passes.push(t)},t.prototype.createRenderTargetID=function(e,t){return this.currentGraph.renderTargetDebugNames.push(t),this.currentGraph.renderTargetDescriptions.push(e)-1},t.prototype.createResolveTextureID=function(e){return this.currentGraph.resolveTextureRenderTargetIDs.push(e)-1},t.prototype.findMostRecentPassThatAttachedRenderTarget=function(e){for(var t=this.currentGraph.passes.length-1;t>=0;t--){var r=this.currentGraph.passes[t];if(r.renderTargetIDs.includes(e))return r}return null},t.prototype.resolveRenderTargetPassAttachmentSlot=function(e,t){var r=e;if(void 0===r.resolveTextureOutputIDs[t]){var n=this.createResolveTextureID(r.renderTargetIDs[t]);r.resolveTextureOutputIDs[t]=n}return r.resolveTextureOutputIDs[t]},t.prototype.findPassForResolveRenderTarget=function(e){var t=_e(this.findMostRecentPassThatAttachedRenderTarget(e)),r=t.renderTargetIDs.indexOf(e);return fe(void 0===t.resolveTextureOutputExternalTextures[r]),t},t.prototype.resolveRenderTarget=function(e){var t=this.findPassForResolveRenderTarget(e),r=t.renderTargetIDs.indexOf(e);return this.resolveRenderTargetPassAttachmentSlot(t,r)},t.prototype.resolveRenderTargetToExternalTexture=function(e,t,r){void 0===r&&(r=0);var n=this.findPassForResolveRenderTarget(e),i=n.renderTargetIDs.indexOf(e);fe(void 0===n.resolveTextureOutputIDs[i]),n.resolveTextureOutputExternalTextures[i]=t,n.resolveTextureOutputExternalTextureLevel[i]=r},t.prototype.getRenderTargetDescription=function(e){return _e(this.currentGraph.renderTargetDescriptions[e])},t.prototype.scheduleAddUseCount=function(e,t){for(var r=0;t.renderTargetIDs.length>r;r++){void 0!==(i=t.renderTargetIDs[r])&&(this.renderTargetOutputCount[i]++,t.renderTargetExtraRefs[r]&&this.renderTargetOutputCount[i]++)}for(var n=0;t.resolveTextureInputIDs.length>n;n++){var i,o=t.resolveTextureInputIDs[n];if(void 0!==o)this.resolveTextureUseCount[o]++,this.renderTargetResolveCount[i=e.resolveTextureRenderTargetIDs[o]]++}},t.prototype.acquireRenderTargetForID=function(e,t){if(void 0===t)return null;if(fe(this.renderTargetOutputCount[t]>0),!this.renderTargetAliveForID[t]){var r=this.acquireRenderTargetForDescription(e.renderTargetDescriptions[t]);r.setDebugName(this.device,e.renderTargetDebugNames[t]),this.renderTargetAliveForID[t]=r}return this.renderTargetAliveForID[t]},t.prototype.releaseRenderTargetForID=function(e,t){if(void 0===e)return null;var r=_e(this.renderTargetAliveForID[e]);return t?(fe(this.renderTargetOutputCount[e]>0),this.renderTargetOutputCount[e]--):(fe(this.renderTargetResolveCount[e]>0),this.renderTargetResolveCount[e]--),0===this.renderTargetOutputCount[e]&&0===this.renderTargetResolveCount[e]&&(r.needsClear=!0,delete this.renderTargetAliveForID[e],this.renderTargetDeadPool.push(r)),r},t.prototype.acquireResolveTextureInputTextureForID=function(e,t){var r=e.resolveTextureRenderTargetIDs[t];fe(this.resolveTextureUseCount[t]>0),this.resolveTextureUseCount[t]--;var n=_e(this.releaseRenderTargetForID(r,!1));if(void 0!==this.singleSampledTextureForResolveTextureID[t]){var i=this.singleSampledTextureForResolveTextureID[t];return 0===this.resolveTextureUseCount[t]&&this.singleSampledTextureDeadPool.push(i),i.texture}return _e(n.texture)},t.prototype.determineResolveParam=function(e,t,r){var n=t.renderTargetIDs[r],i=t.resolveTextureOutputIDs[r],o=t.resolveTextureOutputExternalTextures[r],a=void 0!==i,s=void 0!==o;fe(!(a&&s));var l=null,u=!1,c=0;if(this.renderTargetOutputCount[n]>1&&(u=!0),a){fe(e.resolveTextureRenderTargetIDs[i]===n),fe(this.resolveTextureUseCount[i]>0),fe(this.renderTargetOutputCount[n]>0);var f=_e(this.renderTargetAliveForID[n]);if(null!==f.texture&&1===this.renderTargetOutputCount[n])l=null,u=!0;else{if(!this.singleSampledTextureForResolveTextureID[i]){var _=_e(e.renderTargetDescriptions[n]);this.singleSampledTextureForResolveTextureID[i]=this.acquireSingleSampledTextureForDescription(_),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[i].texture,f.debugName+" (Resolve ".concat(i,")"))}l=this.singleSampledTextureForResolveTextureID[i].texture}}else s?(l=o,c=t.resolveTextureOutputExternalTextureLevel[r]):l=null;return{resolveTo:l,store:u,level:c}},t.prototype.schedulePass=function(t,r){for(var n=r.renderTargetIDs[e.RGAttachmentSlot.DepthStencil],i=e.RGAttachmentSlot.Color0;e.RGAttachmentSlot.ColorMax>=i;i++){var o=r.renderTargetIDs[i],a=this.acquireRenderTargetForID(t,o);r.renderTargets[i]=a,r.descriptor.colorAttachment[i]=null!==a?a.attachment:null,r.descriptor.colorAttachmentLevel[i]=r.renderTargetLevels[i];var s=this.determineResolveParam(t,r,i),l=s.store,u=s.level;r.descriptor.colorResolveTo[i]=s.resolveTo,r.descriptor.colorResolveToLevel[i]=u,r.descriptor.colorStore[i]=l,r.descriptor.colorClearColor[i]=null!==a&&a.needsClear?t.renderTargetDescriptions[o].colorClearColor:"load"}var c=this.acquireRenderTargetForID(t,n);r.renderTargets[e.RGAttachmentSlot.DepthStencil]=c,r.descriptor.depthStencilAttachment=null!==c?c.attachment:null;var f=this.determineResolveParam(t,r,e.RGAttachmentSlot.DepthStencil),_=f.store;r.descriptor.depthStencilResolveTo=f.resolveTo,r.descriptor.depthStencilStore=_,r.descriptor.depthClearValue=null!==c&&c.needsClear?t.renderTargetDescriptions[n].depthClearValue:"load",r.descriptor.stencilClearValue=null!==c&&c.needsClear?t.renderTargetDescriptions[n].stencilClearValue:"load";for(var d=0,p=0,h=0,E=0;r.renderTargets.length>E;E++){var R=r.renderTargets[E];if(R){var T=R.width>>>r.renderTargetLevels[E],m=R.height>>>r.renderTargetLevels[E];0===d&&(d=T,p=m,h=R.sampleCount),fe(T===d),fe(m===p),fe(R.sampleCount===h),R.needsClear=!1}}d>0&&p>0&&(r.viewportX*=d,r.viewportY*=p,r.viewportW*=d,r.viewportH*=p);for(E=0;r.resolveTextureInputIDs.length>E;E++){r.resolveTextureInputTextures[E]=this.acquireResolveTextureInputTextureForID(t,r.resolveTextureInputIDs[E])}for(E=0;r.renderTargetIDs.length>E;E++)this.releaseRenderTargetForID(r.renderTargetIDs[E],!0);for(i=0;r.renderTargetExtraRefs.length>i;i++)r.renderTargetExtraRefs[i]&&this.releaseRenderTargetForID(r.renderTargetIDs[i],!0)},t.prototype.scheduleGraph=function(e){fe(0===this.renderTargetOutputCount.length),fe(0===this.renderTargetResolveCount.length),fe(0===this.resolveTextureUseCount.length);for(var t=0;this.renderTargetDeadPool.length>t;t++)this.renderTargetDeadPool[t].age++;for(t=0;this.singleSampledTextureDeadPool.length>t;t++)this.singleSampledTextureDeadPool[t].age++;Ce(this.renderTargetOutputCount,e.renderTargetDescriptions.length,0),Ce(this.renderTargetResolveCount,e.renderTargetDescriptions.length,0),Ce(this.resolveTextureUseCount,e.resolveTextureRenderTargetIDs.length,0);for(t=0;e.passes.length>t;t++)this.scheduleAddUseCount(e,e.passes[t]);for(t=0;e.passes.length>t;t++)this.schedulePass(e,e.passes[t]);for(t=0;this.renderTargetOutputCount.length>t;t++)fe(0===this.renderTargetOutputCount[t]);for(t=0;this.renderTargetResolveCount.length>t;t++)fe(0===this.renderTargetResolveCount[t]);for(t=0;this.resolveTextureUseCount.length>t;t++)fe(0===this.resolveTextureUseCount[t]);for(t=0;this.renderTargetAliveForID.length>t;t++)fe(void 0===this.renderTargetAliveForID[t]);for(t=0;this.renderTargetDeadPool.length>t;t++)1>this.renderTargetDeadPool[t].age||(this.renderTargetDeadPool[t].destroy(),this.renderTargetDeadPool.splice(t--,1));for(t=0;this.singleSampledTextureDeadPool.length>t;t++)1>this.singleSampledTextureDeadPool[t].age||(this.singleSampledTextureDeadPool[t].destroy(),this.singleSampledTextureDeadPool.splice(t--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0},t.prototype.execPass=function(e){fe(null===this.currentPass),this.currentPass=e;var t=this.device.createRenderPass(e.descriptor);t.beginDebugGroup(e.debugName),t.setViewport(e.viewportX,e.viewportY,e.viewportW,e.viewportH),null!==e.execFunc&&e.execFunc(t,this),t.endDebugGroup(),this.device.submitPass(t),null!==e.postFunc&&e.postFunc(this),this.currentPass=null},t.prototype.execGraph=function(e){var t=this;this.scheduleGraph(e),this.device.beginFrame(),e.passes.forEach((function(e){t.execPass(e)})),this.device.endFrame(),this.singleSampledTextureForResolveTextureID.length=0},t.prototype.execute=function(){var e=_e(this.currentGraph);this.execGraph(e),this.currentGraph=null},t.prototype.getDebug=function(){return this},t.prototype.getPasses=function(){return this.currentGraph.passes},t.prototype.getPassDebugThumbnails=function(e){return e.debugThumbnails},t.prototype.getPassRenderTargetID=function(e,t){return e.renderTargetIDs[t]},t.prototype.getRenderTargetIDDebugName=function(e){return this.currentGraph.renderTargetDebugNames[e]},t.prototype.getResolveTextureForID=function(e){var t=this.currentPass,r=t.resolveTextureInputIDs.indexOf(e);return fe(r>=0),_e(t.resolveTextureInputTextures[r])},t.prototype.getRenderTargetAttachment=function(e){var t=this.currentPass.renderTargets[e];return t?t.attachment:null},t.prototype.getRenderTargetTexture=function(e){var t=this.currentPass.renderTargets[e];return t?t.texture:null},t.prototype.newGraphBuilder=function(){return this.beginGraphBuilder(),this},t.prototype.destroy=function(){for(var e=0;this.renderTargetAliveForID.length>e;e++)fe(void 0===this.renderTargetAliveForID[e]);for(e=0;this.singleSampledTextureForResolveTextureID.length>e;e++)fe(void 0===this.singleSampledTextureForResolveTextureID[e]);for(e=0;this.renderTargetDeadPool.length>e;e++)this.renderTargetDeadPool[e].destroy();for(e=0;this.singleSampledTextureDeadPool.length>e;e++)this.singleSampledTextureDeadPool[e].destroy()},t}();e.RendererLayer=void 0,(tr=e.RendererLayer||(e.RendererLayer={}))[tr.BACKGROUND=0]="BACKGROUND",tr[tr.ALPHA_TEST=16]="ALPHA_TEST",tr[tr.OPAQUE=32]="OPAQUE",tr[tr.TRANSLUCENT=128]="TRANSLUCENT";var sr=65536,lr=16;function ur(e,t,r){void 0===r&&(r=sr);var n=re(e,0,r)/r;return t&&(n=1-n),65535&n*((1<<lr)-1)}function cr(e,t){return(16777215&e|(255&t)<<24)>>>0}function fr(e,t){return!!(e>>>31&1)?e:(4278190335&e|(65535&t)<<8)>>>0}function _r(e,t){return cr(fr(0,t),e)}function dr(e,t){return fe(t>=0),(4294967040&e|t>>>8&255)>>>0}function pr(e){return cr(0,e)}function hr(e,t){return fe(t>=0),(4278190335&e|t<<8)>>>0}var Er=m(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1);var Rr,Tr=m(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);function mr(e,t,r,n,i,o){return void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),e[t+0]=r,e[t+1]=n,e[t+2]=i,e[t+3]=o,4}e.RenderInstFlags=void 0,(Rr=e.RenderInstFlags||(e.RenderInstFlags={}))[Rr.None=0]="None",Rr[Rr.Indexed=1]="Indexed",Rr[Rr.AllowSkippingIfPipelineNotReady=2]="AllowSkippingIfPipelineNotReady",Rr[Rr.Template=4]="Template",Rr[Rr.Draw=8]="Draw",Rr[Rr.InheritedFlags=3]="InheritedFlags";var Ar,Sr=function(){function t(){this.sortKey=0,this.debug=null,this.uniforms=[],this.bindingDescriptors=Pe(1,(function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}})),this.dynamicUniformBufferByteOffsets=Pe(4,(function(){return 0})),this.flags=0,this.inputState=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={bindingLayouts:[],inputLayout:null,megaStateDescriptor:be(ke),program:null,topology:e.PrimitiveTopology.Triangles,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}return t.prototype.reset=function(){this.sortKey=0,this.flags=e.RenderInstFlags.AllowSkippingIfPipelineNotReady,this.inputState=null,this.renderPipelineDescriptor.inputLayout=null},t.prototype.setFromTemplate=function(t){Le(this.renderPipelineDescriptor.megaStateDescriptor,t.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=t.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=t.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=t.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,t.renderPipelineDescriptor.colorAttachmentFormats.length);for(var r=0;t.renderPipelineDescriptor.colorAttachmentFormats.length>r;r++)this.renderPipelineDescriptor.colorAttachmentFormats[r]=t.renderPipelineDescriptor.colorAttachmentFormats[r];this.renderPipelineDescriptor.depthStencilAttachmentFormat=t.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=t.renderPipelineDescriptor.sampleCount,this.inputState=t.inputState,this.uniformBuffer=t.uniformBuffer,this.uniforms=c([],u(t.uniforms),!1),this.drawCount=t.drawCount,this.drawStart=t.drawStart,this.drawInstanceCount=t.drawInstanceCount,this.flags=this.flags&~e.RenderInstFlags.InheritedFlags|t.flags&e.RenderInstFlags.InheritedFlags,this.sortKey=t.sortKey;var n=this.bindingDescriptors[0],i=t.bindingDescriptors[0];null!==i.bindingLayout&&this.setBindingLayout(i.bindingLayout);for(r=0;Math.min(n.uniformBufferBindings.length,i.uniformBufferBindings.length)>r;r++)n.uniformBufferBindings[r].wordCount=t.bindingDescriptors[0].uniformBufferBindings[r].wordCount;this.setSamplerBindingsFromTextureMappings(i.samplerBindings);for(r=0;t.dynamicUniformBufferByteOffsets.length>r;r++)this.dynamicUniformBufferByteOffsets[r]=t.dynamicUniformBufferByteOffsets[r]},t.prototype.setProgram=function(e){this.renderPipelineDescriptor.program=e},t.prototype.setMegaStateFlags=function(e){return Le(this.renderPipelineDescriptor.megaStateDescriptor,e),this.renderPipelineDescriptor.megaStateDescriptor},t.prototype.getMegaStateFlags=function(){return this.renderPipelineDescriptor.megaStateDescriptor},t.prototype.setInputLayoutAndState=function(e,t){this.inputState=t,this.renderPipelineDescriptor.inputLayout=e},t.prototype.setBindingLayout=function(e){fe(this.dynamicUniformBufferByteOffsets.length>e.numUniformBuffers),this.renderPipelineDescriptor.bindingLayouts[0]=e,this.bindingDescriptors[0].bindingLayout=e;for(var t=this.bindingDescriptors[0].uniformBufferBindings.length;e.numUniformBuffers>t;t++)this.bindingDescriptors[0].uniformBufferBindings.push({buffer:null,wordCount:0});for(t=this.bindingDescriptors[0].samplerBindings.length;e.numSamplers>t;t++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null,lateBinding:null})},t.prototype.setBindingLayouts=function(e){fe(this.bindingDescriptors.length>=e.length),fe(1===e.length),this.setBindingLayout(e[0])},t.prototype.drawIndexes=function(t,r){void 0===r&&(r=0),this.flags=Oe(this.flags,e.RenderInstFlags.Indexed,!0),this.drawCount=t,this.drawStart=r,this.drawInstanceCount=1},t.prototype.drawIndexesInstanced=function(t,r,n){void 0===n&&(n=0),this.flags=Oe(this.flags,e.RenderInstFlags.Indexed,!0),this.drawCount=t,this.drawStart=n,this.drawInstanceCount=r},t.prototype.drawPrimitives=function(t,r){void 0===r&&(r=0),this.flags=Oe(this.flags,e.RenderInstFlags.Indexed,!1),this.drawCount=t,this.drawStart=r,this.drawInstanceCount=1},t.prototype.setUniforms=function(e,t){if(0!==t.length){this.uniforms[e]=t;var r=0,n=[];t.forEach((function(e){var t=e.value;if(ne(t)||Array.isArray(t)||t instanceof Float32Array){var i=ne(t)?[t]:t,o=4-r%4;if(4!==o)if(o<(i.length>4?4:i.length)){r+=o;for(var a=0;o>a;a++)n.push(0)}else;r+=i.length,n.push.apply(n,c([],u(i),!1))}}));var i=4-n.length%4;if(4!==i)for(var o=0;i>o;o++)n.push(0);for(var a=this.allocateUniformBuffer(e,n.length),s=this.mapUniformBufferF32(e),l=0;n.length>l;l+=4)a+=mr(s,a,n[l],n[l+1],n[l+2],n[l+3])}},t.prototype.setUniformBuffer=function(e){this.uniformBuffer=e},t.prototype.allocateUniformBuffer=function(e,t){return fe(this.dynamicUniformBufferByteOffsets.length>this.bindingDescriptors[0].bindingLayout.numUniformBuffers),this.dynamicUniformBufferByteOffsets[e]=this.uniformBuffer.allocateChunk(t)<<2,this.bindingDescriptors[0].uniformBufferBindings[e].wordCount=t,this.getUniformBufferOffset(e)},t.prototype.getUniformBufferOffset=function(e){return this.dynamicUniformBufferByteOffsets[e]>>>2},t.prototype.setUniformBufferOffset=function(e,t,r){this.dynamicUniformBufferByteOffsets[e]=t<<2,this.bindingDescriptors[0].uniformBufferBindings[e].wordCount=r},t.prototype.mapUniformBufferF32=function(e){return this.uniformBuffer.mapBufferF32()},t.prototype.getUniformBuffer=function(){return this.uniformBuffer},t.prototype.setSamplerBindingsFromTextureMappings=function(e){e=e.filter((function(e){return e}));for(var t=0;this.bindingDescriptors[0].samplerBindings.length>t;t++){var r=this.bindingDescriptors[0].samplerBindings[t],n=e[t];null!=n?(r.texture=n.texture,r.sampler=n.sampler,r.lateBinding=n.lateBinding):(r.texture=null,r.sampler=null,r.lateBinding=null)}},t.prototype.hasLateSamplerBinding=function(e){for(var t=0;this.bindingDescriptors[0].samplerBindings.length>t;t++){if(this.bindingDescriptors[0].samplerBindings[t].lateBinding===e)return!0}return!1},t.prototype.resolveLateSamplerBinding=function(e,t){for(var r=0;this.bindingDescriptors[0].samplerBindings.length>r;r++){var n=this.bindingDescriptors[0].samplerBindings[r];n.lateBinding===e&&(null===t?(n.texture=null,n.sampler=null):(fe(null===t.lateBinding),n.texture=t.texture,null!==t.sampler&&(n.sampler=t.sampler)),n.lateBinding=null)}},t.prototype.setAllowSkippingIfPipelineNotReady=function(t){this.flags=Oe(this.flags,e.RenderInstFlags.AllowSkippingIfPipelineNotReady,t)},t.prototype.setAttachmentFormatsFromRenderPass=function(e,t){for(var r=e.queryRenderPass(t),n=-1,i=0;r.colorAttachment.length>i;i++){var o=null!==r.colorAttachment[i]?e.queryRenderTarget(r.colorAttachment[i]):null;this.renderPipelineDescriptor.colorAttachmentFormats[i]=null!==o?o.pixelFormat:null,null!==o&&(-1===n?n=o.sampleCount:fe(n===o.sampleCount))}var a=null!==r.depthStencilAttachment?e.queryRenderTarget(r.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=null!==a?a.pixelFormat:null,null!==a&&(-1===n?n=a.sampleCount:fe(n==a.sampleCount)),fe(n>0),this.renderPipelineDescriptor.sampleCount=n},t.prototype.drawOnPass=function(t,r){var n=this,o=t.device;this.setAttachmentFormatsFromRenderPass(o,r);var a=t.createRenderPipeline(this.renderPipelineDescriptor);if(!o.pipelineQueryReady(a)){if(this.flags&e.RenderInstFlags.AllowSkippingIfPipelineNotReady)return!1;o.pipelineForceReady(a)}r.setPipeline(a),r.setInputState(this.inputState);for(var s=0;this.bindingDescriptors[0].uniformBufferBindings.length>s;s++)this.bindingDescriptors[0].uniformBufferBindings[s].buffer=_e(this.uniformBuffer.buffer);this.renderPipelineDescriptor.program.gl_program&&this.uniforms.forEach((function(e){var t={};e.forEach((function(e){t[e.name]=e.value})),n.renderPipelineDescriptor.program.setUniforms(t)}));var l=t.createBindings(i(i({},this.bindingDescriptors[0]),{pipeline:a}));return r.setBindings(0,l,this.dynamicUniformBufferByteOffsets),this.drawInstanceCount>1?(fe(!!(this.flags&e.RenderInstFlags.Indexed)),r.drawIndexedInstanced(this.drawCount,this.drawStart,this.drawInstanceCount)):this.flags&e.RenderInstFlags.Indexed?r.drawIndexed(this.drawCount,this.drawStart):r.draw(this.drawCount,this.drawStart),!0},t}();function yr(e,t){return e.sortKey-t.sortKey}e.RenderInstExecutionOrder=void 0,(Ar=e.RenderInstExecutionOrder||(e.RenderInstExecutionOrder={}))[Ar.Forwards=0]="Forwards",Ar[Ar.Backwards=1]="Backwards";var vr=function(){function t(t,r){void 0===t&&(t=yr),void 0===r&&(r=e.RenderInstExecutionOrder.Forwards),this.renderInsts=[],this.usePostSort=!1,this.compareFunction=t,this.executionOrder=r}return t.prototype.checkUsePostSort=function(){this.usePostSort=null!==this.compareFunction&&this.renderInsts.length>=500},t.prototype.insertSorted=function(e){null===this.compareFunction||this.usePostSort?this.renderInsts.push(e):Me(this.renderInsts,e,this.compareFunction),this.checkUsePostSort()},t.prototype.submitRenderInst=function(t){t.flags|=e.RenderInstFlags.Draw,this.insertSorted(t)},t.prototype.hasLateSamplerBinding=function(e){for(var t=0;this.renderInsts.length>t;t++)if(this.renderInsts[t].hasLateSamplerBinding(e))return!0;return!1},t.prototype.resolveLateSamplerBinding=function(e,t){for(var r=0;this.renderInsts.length>r;r++)this.renderInsts[r].resolveLateSamplerBinding(e,t)},t.prototype.ensureSorted=function(){this.usePostSort&&(0!==this.renderInsts.length&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)},t.prototype.drawOnPassRendererNoReset=function(t,r){this.ensureSorted();var n=0;if(this.executionOrder===e.RenderInstExecutionOrder.Forwards)for(var i=0;this.renderInsts.length>i;i++)this.renderInsts[i].drawOnPass(t,r)&&n++;else for(i=this.renderInsts.length-1;i>=0;i--)this.renderInsts[i].drawOnPass(t,r)&&n++;return n},t.prototype.reset=function(){this.renderInsts.length=0},t.prototype.drawOnPassRenderer=function(e,t){this.drawOnPassRendererNoReset(e,t),this.reset()},t}(),gr=function(){function e(){this.pool=[],this.allocCount=0}return e.prototype.allocRenderInstIndex=function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new Sr),this.allocCount-1},e.prototype.popRenderInst=function(){this.allocCount--},e.prototype.reset=function(){for(var e=0;this.pool.length>e;e++)this.pool[e].reset();this.allocCount=0},e.prototype.destroy=function(){this.pool.length=0,this.allocCount=0},e}(),Cr=function(){function t(e){this.renderCache=e,this.instPool=new gr,this.templatePool=new gr,this.simpleRenderInstList=new vr,this.currentRenderInstList=this.simpleRenderInstList}return t.prototype.newRenderInst=function(){var e=this.templatePool.allocCount-1,t=this.instPool.allocRenderInstIndex(),r=this.instPool.pool[t];return r.debug=null,0>e||r.setFromTemplate(this.templatePool.pool[e]),r},t.prototype.submitRenderInst=function(e,t){void 0===t&&(t=this.currentRenderInstList),t.submitRenderInst(e)},t.prototype.setCurrentRenderInstList=function(e){fe(null===this.simpleRenderInstList),this.currentRenderInstList=e},t.prototype.pushTemplateRenderInst=function(){var t=this.templatePool.allocCount-1,r=this.templatePool.allocRenderInstIndex(),n=this.templatePool.pool[r];return 0>t||n.setFromTemplate(this.templatePool.pool[t]),n.flags|=e.RenderInstFlags.Template,n},t.prototype.popTemplateRenderInst=function(){this.templatePool.popRenderInst()},t.prototype.getTemplateRenderInst=function(){return this.templatePool.pool[this.templatePool.allocCount-1]},t.prototype.resetRenderInsts=function(){this.instPool.reset(),null!==this.simpleRenderInstList&&this.simpleRenderInstList.reset(),fe(0===this.templatePool.allocCount)},t.prototype.destroy=function(){this.instPool.destroy(),this.renderCache.destroy()},t.prototype.disableSimpleMode=function(){this.simpleRenderInstList=null},t.prototype.drawOnPassRenderer=function(e){_e(this.simpleRenderInstList).drawOnPassRenderer(this.renderCache,e)},t.prototype.drawOnPassRendererNoReset=function(e){_e(this.simpleRenderInstList).drawOnPassRendererNoReset(this.renderCache,e)},t}(),Fr=function(){function t(e){this.parameters=e}return t.prototype.getDevice=function(){return this.device},t.prototype.setDevice=function(e){this.device=e,this.renderCache=new er(e),this.renderGraph=new ar(this.device),this.renderInstManager=new Cr(this.renderCache),this.uniformBuffer=new kt(this.device)},t.prototype.pushTemplateRenderInst=function(){var e=this.renderInstManager.pushTemplateRenderInst();return e.setUniformBuffer(this.uniformBuffer),e},t.prototype.prepareToRender=function(){this.uniformBuffer.prepareToRender()},t.prototype.destroy=function(){this.uniformBuffer&&this.uniformBuffer.destroy(),this.renderInstManager&&this.renderInstManager.destroy(),this.renderCache&&this.renderCache.destroy(),this.renderGraph&&this.renderGraph.destroy()},t.prototype.getCache=function(){return this.renderCache},t.prototype.getDefines=function(){var t,r,n;return{USE_TONEMAPPING:(null===(t=this.parameters)||void 0===t?void 0:t.toneMapping)&&(null===(r=this.parameters)||void 0===r?void 0:r.toneMapping)!==e.ToneMapping.NONE,toneMapping:null===(n=this.parameters)||void 0===n?void 0:n.toneMapping}},t}(),Ir=function(){function e(e){this.pixelFormat=e,this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load"}return e.prototype.setDimensions=function(e,t,r){this.width=e,this.height=t,this.sampleCount=r},e.prototype.copyDimensions=function(e){this.width=e.width,this.height=e.height,this.sampleCount=e.sampleCount},e}();function Mr(e){return{colorClearColor:e,depthClearValue:1,stencilClearValue:0}}var Or,Pr=Mr(Ee(.88,.88,.88,1)),Nr=Mr(Te),xr=Mr(Ae);function Br(t,r){var n=function(t){return t.antialiasingMode===e.AntialiasingMode.MSAAx4?4:1}(r);t.setDimensions(r.backbufferWidth,r.backbufferHeight,n)}function Dr(t,r,n){var i=function(t){if(t===e.RGAttachmentSlot.Color0)return e.Format.U8_RGBA_RT;if(t===e.RGAttachmentSlot.DepthStencil)return e.Format.D24_S8;throw Error("whoops")}(t),o=new Ir(i);return Br(o,r),null!==n&&(o.colorClearColor=n.colorClearColor,o.depthClearValue=n.depthClearValue,o.stencilClearValue=n.stencilClearValue),o}e.AntialiasingMode=void 0,(Or=e.AntialiasingMode||(e.AntialiasingMode={}))[Or.None=0]="None",Or[Or.FXAA=1]="FXAA",Or[Or.MSAAx4=2]="MSAAx4";var Lr,br=function(){function e(){this.texture=null,this.sampler=null,this.lateBinding=null,this.width=0,this.height=0,this.lodBias=0}return e.prototype.reset=function(){this.texture=null,this.sampler=null,this.lateBinding=null,this.width=0,this.height=0,this.lodBias=0},e.prototype.copy=function(e){this.texture=e.texture,this.sampler=e.sampler,this.lateBinding=e.lateBinding,this.width=e.width,this.height=e.height,this.lodBias=e.lodBias},e}(),Ur=function(){function e(){this.inputTexture=null,this.outputTexture=null}return e.prototype.setDescription=function(e,t){this.inputTexture!==this.outputTexture&&(null!==this.inputTexture&&this.inputTexture.destroy(),this.inputTexture=this.outputTexture),fe(this.inputTexture===this.outputTexture),null!==this.outputTexture&&this.outputTexture.matchesDescription(t)||(this.outputTexture=new ir(e,t),null===this.inputTexture&&(this.inputTexture=this.outputTexture))},e.prototype.getTextureForSampling=function(){return null!==this.inputTexture?this.inputTexture.texture:null},e.prototype.getTextureForResolving=function(){var e;return null===(e=this.outputTexture)||void 0===e?void 0:e.texture},e.prototype.destroy=function(){null!==this.outputTexture&&this.outputTexture!==this.inputTexture&&(this.outputTexture.destroy(),this.outputTexture=null),null!==this.inputTexture&&(this.inputTexture.destroy(),this.inputTexture=null)},e}(),Gr=function(e){function t(r){void 0===r&&(r={});var n=r.style,a=o(r,["style"]);return e.call(this,i({type:t.tag,style:i({intensity:Math.PI},n)},a))||this}return n(t,e),t.tag="light",t}(t.DisplayObject);e.FogType=void 0,(Lr=e.FogType||(e.FogType={}))[Lr.NONE=0]="NONE",Lr[Lr.EXP=1]="EXP",Lr[Lr.EXP2=2]="EXP2",Lr[Lr.LINEAR=3]="LINEAR";var kr,wr=function(t){function r(n){void 0===n&&(n={});var a=n.style,s=o(n,["style"]);return t.call(this,i({type:r.tag,style:i({type:e.FogType.NONE,fill:"black",start:1,end:1e3,density:0},a)},s))||this}return n(r,t),r.tag="fog",r}(t.DisplayObject);!function(e){e.PROJECTION_MATRIX="u_ProjectionMatrix",e.VIEW_MATRIX="u_ViewMatrix",e.CAMERA_POSITION="u_CameraPosition",e.DEVICE_PIXEL_RATIO="u_DevicePixelRatio",e.VIEWPORT="u_Viewport",e.IS_ORTHO="u_IsOrtho",e.IS_PICKING="u_IsPicking"}(kr||(kr={}));var Vr=function(){function r(e,t,r,n){this.renderHelper=e,this.lightPool=t,this.texturePool=r,this.batchManager=n,this.renderLists={world:new vr,picking:new vr}}return r.prototype.getDevice=function(){return this.device},r.prototype.getSwapChain=function(){return this.swapChain},r.prototype.getRenderLists=function(){return this.renderLists},r.prototype.apply=function(n){var o=this;this.context=n;var l=n.renderingService,u=n.renderingContext.root.ownerDocument.defaultView,c=function(e){var t=e.target;t.nodeName!==Gr.tag?t.nodeName!==wr.tag?(t.renderable3D||(t.renderable3D=new f),o.batchManager.add(t)):o.lightPool.addFog(t):o.lightPool.addLight(t)},_=function(e){var t=e.target;t.nodeName!==Gr.tag?t.nodeName!==wr.tag?(o.swapChain&&o.batchManager.remove(t),delete t.renderable3D):o.lightPool.removeFog(t):o.lightPool.removeLight(t)},d=function(e){if(o.swapChain){var t=e.target,r=e.attrName,n=e.newValue;"zIndex"===r?t.parentNode.forEach((function(e){o.batchManager.changeRenderOrder(e,e.sortable.renderOrder)})):o.batchManager.updateAttribute(t,r,n)}},p=function(e){o.swapChain&&o.batchManager.updateAttribute(e.target,"modelMatrix",null)};l.hooks.initAsync.tapPromise(r.tag,(function(){return a(o,void 0,void 0,(function(){var e,r,o,a=this;return s(this,(function(s){switch(s.label){case 0:return u.addEventListener(t.ElementEvent.MOUNTED,c),u.addEventListener(t.ElementEvent.UNMOUNTED,_),u.addEventListener(t.ElementEvent.ATTR_MODIFIED,d),u.addEventListener(t.ElementEvent.BOUNDS_CHANGED,p),this.context.config.renderer.getConfig().enableDirtyRectangleRendering=!1,e=this.context.contextService.getDomElement(),this.context.contextService.resize((o=this.context.config).width,o.height),r=this,[4,this.context.deviceContribution.createSwapChain(e)];case 1:return r.swapChain=s.sent(),this.device=this.swapChain.getDevice(),this.renderHelper.setDevice(this.device),this.renderHelper.renderInstManager.disableSimpleMode(),this.swapChain.configureSwapChain(e.width,e.height),u.addEventListener(t.CanvasEvent.RESIZE,(function(){a.swapChain.configureSwapChain(e.width,e.height)})),this.batchManager.attach(i({device:this.device},n)),[2]}}))}))})),l.hooks.destroy.tap(r.tag,(function(){o.renderHelper.destroy(),u.removeEventListener(t.ElementEvent.MOUNTED,c),u.removeEventListener(t.ElementEvent.UNMOUNTED,_),u.removeEventListener(t.ElementEvent.ATTR_MODIFIED,d),u.removeEventListener(t.ElementEvent.BOUNDS_CHANGED,p)})),l.hooks.beginFrame.tap(r.tag,(function(){var r,n=o.swapChain.getCanvas(),i=o.renderHelper.renderInstManager;if(o.builder=o.renderHelper.renderGraph.newGraphBuilder(),"transparent"===o.context.config.background)r=Re;else{var a=t.parseColor(o.context.config.background);r=o.context.config.background?Ee(Number(a.r)/255*Number(a.alpha),Number(a.g)/255*Number(a.alpha),Number(a.b)/255*Number(a.alpha),Number(a.alpha)):me}var s={backbufferWidth:n.width,backbufferHeight:n.height,antialiasingMode:e.AntialiasingMode.None},l=Dr(e.RGAttachmentSlot.Color0,s,Mr(r)),u=Dr(e.RGAttachmentSlot.DepthStencil,s,xr),c=o.builder.createRenderTargetID(l,"Main Color"),f=o.builder.createRenderTargetID(u,"Main Depth");o.builder.pushPass((function(t){t.setDebugName("Main Render Pass"),t.attachRenderTargetID(e.RGAttachmentSlot.Color0,c),t.attachRenderTargetID(e.RGAttachmentSlot.DepthStencil,f),t.exec((function(e){o.renderLists.world.drawOnPassRenderer(i.renderCache,e)}))})),o.builder.resolveRenderTargetToExternalTexture(c,o.swapChain.getOnscreenTexture())})),l.hooks.endFrame.tap(r.tag,(function(){var t,r,n=o.renderHelper.renderInstManager,i=o.renderHelper.pushTemplateRenderInst();i.setBindingLayouts([{numUniformBuffers:2,numSamplers:0}]),i.setMegaStateFlags(We({depthWrite:!0,blendConstant:Re},{rgbBlendMode:e.BlendMode.Add,alphaBlendMode:e.BlendMode.Add,rgbBlendSrcFactor:e.BlendFactor.SrcAlpha,alphaBlendSrcFactor:e.BlendFactor.One,rgbBlendDstFactor:e.BlendFactor.OneMinusSrcAlpha,alphaBlendDstFactor:e.BlendFactor.OneMinusSrcAlpha}));var a=(t=o.context.config).width,s=t.height,l=o.context.camera;if(i.setUniforms(0,[{name:kr.PROJECTION_MATRIX,value:l.getPerspective()},{name:kr.VIEW_MATRIX,value:l.getViewTransform()},{name:kr.CAMERA_POSITION,value:l.getPosition()},{name:kr.DEVICE_PIXEL_RATIO,value:o.context.contextService.getDPR()},{name:kr.VIEWPORT,value:[a,s]},{name:kr.IS_ORTHO,value:l.isOrtho()?1:0},{name:kr.IS_PICKING,value:0}]),o.batchManager.render(o.renderLists.world),n.popTemplateRenderInst(),o.renderHelper.prepareToRender(),o.renderHelper.renderGraph.execute(),n.resetRenderInsts(),o.enableCapture&&o.resolveCapturePromise){var u=(r=o.captureOptions).type,c=r.encoderOptions,f=o.context.contextService.getDomElement().toDataURL(u,c);o.resolveCapturePromise(f),o.enableCapture=!1,o.captureOptions=void 0,o.resolveCapturePromise=void 0}}))},r.prototype.loadTexture=function(e,t,r){return this.texturePool.getOrCreateTexture(this.device,e,t,(function(e){r&&r(e)}))},r.prototype.toDataURL=function(e){return a(this,void 0,void 0,(function(){var t=this;return s(this,(function(r){return this.enableCapture=!0,this.captureOptions=e,this.capturePromise=new Promise((function(e){t.resolveCapturePromise=function(t){e(t)}})),[2,this.capturePromise]}))}))},r.tag="RenderGraph",r}(),Wr=function(){function r(e,t,r,n){this.renderHelper=e,this.renderGraphPlugin=t,this.pickingIdGenerator=r,this.batchManager=n}return r.prototype.apply=function(e){var n=this;this.context=e;var i=e.renderingService,o=e.renderingContext.root.ownerDocument.defaultView,l=function(e){var t=e.target;t.renderable3D||(t.renderable3D=new f);var r=t.renderable3D,i=n.pickingIdGenerator.getId(t);r.pickingId=i,r.encodedPickingColor=n.pickingIdGenerator.encodePickingColor(i)};i.hooks.init.tap(r.tag,(function(){o.addEventListener(t.ElementEvent.MOUNTED,l)})),i.hooks.destroy.tap(r.tag,(function(){o.removeEventListener(t.ElementEvent.MOUNTED,l)})),i.hooks.pickSync.tap(r.tag,(function(e){return n.pick(e)})),i.hooks.pick.tapPromise(r.tag,(function(e){return a(n,void 0,void 0,(function(){return s(this,(function(t){return[2,this.pick(e)]}))}))}))},r.prototype.pick=function(e){var r=e.topmost,n=e.position,i=n.viewportX,o=n.viewportY,a=this.context.contextService.getDPR(),s=this.context.config.width*a,l=this.context.config.height*a,u=i*a,c=o*a;if(!this.renderHelper.renderGraph||u>s||0>u||c>l||0>c)return e.picked=[],e;var f=this.pickByRectangleInDepth(new t.Rectangle(re(Math.round(u),0,s-1),re(Math.round(c),0,l-1),1,1),r?1:100);return e.picked=f,e},r.prototype.pickByRectangleInDepth=function(e,t){void 0===t&&(t=100);var r=null,n=1,i=[];do{if(!(r=this.pickByRectangle(e,r)))break;n++,i.push(r)}while(r&&t>=n);return t>1&&this.restorePickingColor(i),i},r.prototype.restorePickingColor=function(e){var t=this;e.forEach((function(e){t.batchManager.updateAttribute(e,"pointerEvents",!0,!0)}))},r.prototype.pickByRectangle=function(t,r){var n,o,a=this,s=this.renderGraphPlugin.getDevice(),l=this.renderGraphPlugin.getRenderLists(),u=this.renderHelper.renderInstManager,c=this.renderHelper.renderGraph.newGraphBuilder(),f=this.context.camera,_=t.x,d=t.y,p=t.width,h=t.height,E={backbufferWidth:p,backbufferHeight:h,antialiasingMode:e.AntialiasingMode.None},R=Dr(e.RGAttachmentSlot.Color0,E,Mr(Re)),T=c.createRenderTargetID(R,"Picking Color"),m=Dr(e.RGAttachmentSlot.DepthStencil,E,xr),A=c.createRenderTargetID(m,"Picking Depth"),S=i({},f.getView());this.renderHelper.renderGraph.renderTargetDeadPool.forEach((function(e){e.age=-1})),c.pushPass((function(t){t.setDebugName("Picking Pass"),t.attachRenderTargetID(e.RGAttachmentSlot.Color0,T),t.attachRenderTargetID(e.RGAttachmentSlot.DepthStencil,A),t.exec((function(e){l.picking.drawOnPassRenderer(u.renderCache,e)})),t.post((function(t){var r=t.getRenderTargetTexture(e.RGAttachmentSlot.Color0),n=s.createReadback();S&&S.enabled?f.setViewOffset(S.fullWidth,S.fullHeight,S.offsetX,S.offsetY,S.width,S.height):f.clearViewOffset(),f.setEnableUpdate(!0);var i=n.readTextureSync(r,0,0,p,h,new Uint8Array(p*h*4)),l=-1;if(!i||0===i[0]&&0===i[1]&&0===i[2]||(l=a.pickingIdGenerator.decodePickingColor(i)),l>-1){var u=a.pickingIdGenerator.getById(l);u&&u.isVisible()&&u.isInteractive()&&(o=u)}n.destroy()}))}));var y=this.renderHelper.pushTemplateRenderInst();y.setBindingLayouts([{numUniformBuffers:2,numSamplers:0}]),y.setMegaStateFlags(We({depthWrite:!0},{rgbBlendMode:e.BlendMode.Add,rgbBlendSrcFactor:e.BlendFactor.One,rgbBlendDstFactor:e.BlendFactor.Zero,alphaBlendMode:e.BlendMode.Add,alphaBlendSrcFactor:e.BlendFactor.One,alphaBlendDstFactor:e.BlendFactor.Zero}));var v=(n=this.context.config).width,g=n.height,C=this.context.contextService.getDPR();return f.setEnableUpdate(!1),f.setViewOffset(v*C,g*C,_,d,p,h),y.setUniforms(0,[{name:kr.PROJECTION_MATRIX,value:f.getPerspective()},{name:kr.VIEW_MATRIX,value:f.getViewTransform()},{name:kr.CAMERA_POSITION,value:f.getPosition()},{name:kr.DEVICE_PIXEL_RATIO,value:this.context.contextService.getDPR()},{name:kr.VIEWPORT,value:[v,g]},{name:kr.IS_ORTHO,value:f.isOrtho()?1:0},{name:kr.IS_PICKING,value:1}]),r&&this.batchManager.updateAttribute(r,"pointerEvents",!1,!0),this.batchManager.render(l.picking,!0),u.popTemplateRenderInst(),this.renderHelper.prepareToRender(),this.renderHelper.renderGraph.execute(),u.resetRenderInsts(),o},r.tag="WebGLPicker",r}(),Xr=.005,Hr=function(){function e(){this.meshes=[],this.clipPathMeshCreated=!1}return e.prototype.shouldSubmitRenderInst=function(e,t){return!0},e.prototype.beforeUploadUBO=function(e,t,r){},e.prototype.beforeInitMesh=function(e){},e.prototype.afterInitMesh=function(e){},e}(),Yr={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=this._events[r?r+e:e];if(!t)return[];if(t.fn)return[t.fn];for(var n=0,i=t.length,o=Array(i);i>n;n++)o[n]=t[n].fn;return o},s.prototype.listenerCount=function(e){var t=this._events[r?r+e:e];return t?t.fn?1:t.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var l,u,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,o),!0;case 6:return c.fn.call(c.context,t,n,i,o,a),!0}for(u=1,l=Array(f-1);f>u;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var _,d=c.length;for(u=0;d>u;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),f){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,i);break;default:if(!l)for(_=1,l=Array(f-1);f>_;_++)l[_-1]=arguments[_];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var l=0,u=[],c=s.length;c>l;l++)(s[l].fn!==t||i&&!s[l].once||n&&s[l].context!==n)&&u.push(s[l]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?this._events[t=r?r+e:e]&&a(this,t):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(Yr);var Kr=Yr.exports;function zr(t,r,n,i){void 0===i&&(i=e.BufferFrequencyHint.Static);var o=t.createBuffer({viewOrSize:n.byteLength,usage:r,hint:i});return o.setSubData(0,new Uint8Array(n)),o}e.GeometryEvent=void 0,(e.GeometryEvent||(e.GeometryEvent={})).CHANGED="changed";var jr=function(r){function i(t,n){void 0===n&&(n={});var i=r.call(this)||this;return i.device=t,i.props=n,i.drawMode=e.PrimitiveTopology.Triangles,i.vertexBuffers=[],i.vertices=[],i.inputLayoutDescriptor={vertexBufferDescriptors:[],vertexAttributeDescriptors:[],indexBufferFormat:e.Format.U32_R},i.vertexCount=0,i.instancedCount=0,i.indexStart=0,i.primitiveStart=0,i.dirty=!0,i.meshes=[],i}return n(i,r),i.prototype.validate=function(e){return!0},i.prototype.build=function(e){},i.prototype.computeBoundingBox=function(){return new t.AABB},i.prototype.setIndexBuffer=function(t){return this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=zr(this.device,e.BufferUsage.INDEX,new Uint32Array(ArrayBuffer.isView(t)?t.buffer:t).buffer),this.indices=t,this},i.prototype.setVertexBuffer=function(t){var r=this,n=t.bufferIndex,i=t.attributes,o=t.data;this.inputLayoutDescriptor.vertexBufferDescriptors[n]={byteStride:t.byteStride,frequency:t.frequency},this.vertices[n]=o,i.forEach((function(e){var t=e.format,i=e.bufferByteOffset,o=e.location,a=e.divisor,s=e.byteStride,l=r.inputLayoutDescriptor.vertexAttributeDescriptors.find((function(e){return e.bufferIndex===n&&e.location===o}));l?(l.format=t,l.bufferByteOffset=i,l.byteStride=s,l.divisor=a):r.inputLayoutDescriptor.vertexAttributeDescriptors.push({format:t,bufferIndex:n,bufferByteOffset:i,location:o,byteStride:s,divisor:a})})),this.vertexBuffers[n]&&this.vertexBuffers[n].destroy();var a=zr(this.device,e.BufferUsage.VERTEX,o.buffer,e.BufferFrequencyHint.Dynamic);return this.vertexBuffers[n]=a,this},i.prototype.getVertexBuffer=function(e){return this.vertexBuffers[e]},i.prototype.updateVertexBuffer=function(t,r,n,i){var o=this.inputLayoutDescriptor.vertexBufferDescriptors[t].byteStride,a=this.inputLayoutDescriptor.vertexAttributeDescriptors.find((function(e){return e.location===r}));a&&this.getVertexBuffer(t).setSubData(a.bufferByteOffset+n*o,i);this.emit(e.GeometryEvent.CHANGED)},i.prototype.updateIndices=function(e,t){return void 0===t&&(t=0),this.indexBuffer&&this.indexBuffer.setSubData(t,new Uint8Array(ArrayBuffer.isView(e)?e:new Uint32Array(e))),this},i.prototype.destroy=function(){this.vertexBuffers.forEach((function(e){e&&e.destroy()})),this.indexBuffer&&this.indexBuffer.destroy(),this.inputLayoutDescriptor.vertexAttributeDescriptors=[],this.inputLayoutDescriptor.vertexBufferDescriptors=[],this.indexBuffer=void 0,this.vertexBuffers=[],this.indices=void 0,this.vertices=[],this.vertexCount=0,this.instancedCount=0},i}(Kr);e.MaterialEvent=void 0,(e.MaterialEvent||(e.MaterialEvent={})).CHANGED="changed";var Zr=function(t){function r(e,r){var n=t.call(this)||this;n.props={},n.meshes=[],n.defines={},n.uniforms={},n.uboBuffer=[],n.textures={},n.samplers=[],n.programDirty=!0,n.textureDirty=!0,n.geometryDirty=!0;var o=be(ke),a=o.cullMode,s=o.depthCompare,l=o.depthWrite,u=o.stencilCompare,c=o.stencilWrite,f=o.stencilPassOp,_=o.frontFace,d=o.polygonOffset,p=o.attachmentsState;return n.device=e,n.props=i({cullMode:a,depthTest:!0,depthCompare:s,depthWrite:l,stencilCompare:u,stencilWrite:c,stencilPassOp:f,frontFace:_,polygonOffset:d,attachmentsState:p,dithering:!1,wireframe:!1,wireframeColor:"black",wireframeLineWidth:1,vertexShader:"",fragmentShader:""},r),n.compile(),n}return n(r,t),Object.defineProperty(r.prototype,"cullMode",{get:function(){return this.props.cullMode},set:function(e){this.props.cullMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"frontFace",{get:function(){return this.props.frontFace},set:function(e){this.props.frontFace=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendConstant",{get:function(){return this.props.blendConstant},set:function(e){this.props.blendConstant=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendEquation",{get:function(){return this.props.blendEquation},set:function(e){this.props.blendEquation=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendEquationAlpha",{get:function(){return this.props.blendEquationAlpha},set:function(e){this.props.blendEquationAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendSrc",{get:function(){return this.props.blendSrc},set:function(e){this.props.blendSrc=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendDst",{get:function(){return this.props.blendDst},set:function(e){this.props.blendDst=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendSrcAlpha",{get:function(){return this.props.blendSrcAlpha},set:function(e){this.props.blendSrcAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendDstAlpha",{get:function(){return this.props.blendDstAlpha},set:function(e){this.props.blendDstAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthCompare",{get:function(){return this.props.depthCompare},set:function(e){this.props.depthCompare=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return this.props.depthTest},set:function(e){this.props.depthTest=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthWrite",{get:function(){return this.props.depthWrite},set:function(e){this.props.depthWrite=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilCompare",{get:function(){return this.props.stencilCompare},set:function(e){this.props.stencilCompare=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilWrite",{get:function(){return this.props.stencilWrite},set:function(e){this.props.stencilWrite=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilPassOp",{get:function(){return this.props.stencilPassOp},set:function(e){this.props.stencilPassOp=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilRef",{get:function(){return this.props.stencilRef},set:function(e){this.props.stencilRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"polygonOffset",{get:function(){return this.props.polygonOffset},set:function(e){this.props.polygonOffset=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"dithering",{get:function(){return this.props.dithering},set:function(e){this.props.dithering=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wireframe",{get:function(){return this.props.wireframe},set:function(e){this.props.wireframe!==e&&(this.geometryDirty=!0,this.programDirty=!0,this.props.wireframe=e,this.dispatchMutationEvent()),this.defines.USE_WIREFRAME=!!e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wireframeColor",{get:function(){return this.props.wireframeColor},set:function(e){this.props.wireframeColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wireframeLineWidth",{get:function(){return this.props.wireframeLineWidth},set:function(e){this.props.wireframeLineWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"vertexShader",{get:function(){return this.props.vertexShader},set:function(e){this.props.vertexShader!==e&&(this.programDirty=!0,this.props.vertexShader=e,this.compile())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fragmentShader",{get:function(){return this.props.fragmentShader},set:function(e){this.props.fragmentShader!==e&&(this.programDirty=!0,this.props.fragmentShader=e,this.compile())},enumerable:!1,configurable:!0}),r.prototype.compile=function(){var e=this;this.props.fragmentShader.replace(/^\s*uniform\s*sampler2D\s*(.*)\s*;$/gm,(function(t,r){return e.samplers.push(r),""})),this.uniformNames=Dt(this.props.fragmentShader)},r.prototype.setUniforms=function(t){var r=this,n=!1;Object.keys(t).forEach((function(i){var o,a=t[i],s=r.textures[i];s&&s!==a&&(r.textureDirty=!0),(o=a)&&o.type?(r.textures[i]=a,r.textureDirty=!0,a.on(e.TextureEvent.LOADED,(function(){r.dispatchMutationEvent()}))):(r.uniforms[i]=a,n=!0),Q(t[i])&&(delete r.textures[i],delete r.uniforms[i])})),n&&this.dispatchMutationEvent()},r.prototype.dispatchMutationEvent=function(){this.emit(e.MaterialEvent.CHANGED)},r}(Kr),qr=function(e){function t(t,r){var n=e.call(this,t,i({},r))||this;return n.defines=i(i({},n.defines),{USE_UV:!1,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1}),n}return n(t,e),t}(Zr);function Jr(e){var t={};return Object.keys(e).forEach((function(r){"number"==typeof e[r]&&(t[r]=e[r])})),t}function Qr(e,t){var r=Object.keys(e);return r.length===Object.keys(t).length&&r.every((function(r){return e[r]===t[r]}))}var $r=function(e){return Object.fromEntries(Object.entries(e).filter((function(e){var t=u(e,2);return void 0!==t[1]})))};function en(e,t){return 256*(e=re(Math.floor(e),0,255))+(t=re(Math.floor(t),0,255))}var tn,rn,nn=1,on="FillTextureMapping";e.VertexAttributeBufferIndex=void 0,(tn=e.VertexAttributeBufferIndex||(e.VertexAttributeBufferIndex={}))[tn.MODEL_MATRIX=0]="MODEL_MATRIX",tn[tn.PACKED_COLOR=1]="PACKED_COLOR",tn[tn.PACKED_STYLE=2]="PACKED_STYLE",tn[tn.PICKING_COLOR=3]="PICKING_COLOR",tn[tn.POSITION=4]="POSITION",tn[tn.NORMAL=5]="NORMAL",tn[tn.UV=6]="UV",tn[tn.BARYCENTRIC=7]="BARYCENTRIC",tn[tn.MAX=8]="MAX",e.VertexAttributeLocation=void 0,(rn=e.VertexAttributeLocation||(e.VertexAttributeLocation={}))[rn.MODEL_MATRIX0=0]="MODEL_MATRIX0",rn[rn.MODEL_MATRIX1=1]="MODEL_MATRIX1",rn[rn.MODEL_MATRIX2=2]="MODEL_MATRIX2",rn[rn.MODEL_MATRIX3=3]="MODEL_MATRIX3",rn[rn.PACKED_COLOR=4]="PACKED_COLOR",rn[rn.PACKED_STYLE1=5]="PACKED_STYLE1",rn[rn.PACKED_STYLE2=6]="PACKED_STYLE2",rn[rn.PICKING_COLOR=7]="PICKING_COLOR",rn[rn.POSITION=8]="POSITION",rn[rn.NORMAL=9]="NORMAL",rn[rn.UV=10]="UV",rn[rn.BARYCENTRIC=11]="BARYCENTRIC",rn[rn.MAX=12]="MAX";var an,sn,ln=function(){function r(e,t,r,n){this.renderHelper=e,this.texturePool=t,this.lightPool=r,this.id=nn++,this.index=-1,this.objects=[],this.program=new Gt,this.geometryDirty=!0,this.materialDirty=!0,this.inputStateDirty=!0,this.textureMappings=[],this.lightReceived=!1,this.divisor=1,this.mergeAnchorIntoModelMatrix=!1,this.maxInstances=5e3,this.inited=!1}return Object.defineProperty(r.prototype,"instance",{get:function(){return this.objects[0]},enumerable:!1,configurable:!0}),r.prototype.init=function(t){this.inited||(this.renderer.beforeInitMesh(this),this.context=t,this.material=new qr(this.context.device),this.material.defines=i(i({},Jr(e.VertexAttributeLocation)),this.material.defines),this.geometry=new jr(this.context.device),this.geometry.meshes=this.objects,this.material.meshes=this.objects,this.observeGeometryChanged(),this.observeMaterialChanged(),this.inited=!0,this.renderer.afterInitMesh(this))},r.prototype.observeGeometryChanged=function(){var t=this;this.geometry.on(e.GeometryEvent.CHANGED,(function(){t.geometry.meshes.forEach((function(e){e.renderable.dirty=!0})),t.context.renderingService.dirtify()}))},r.prototype.observeMaterialChanged=function(){var t=this;this.material.on(e.MaterialEvent.CHANGED,(function(){t.material.meshes.forEach((function(e){e.renderable.dirty=!0})),t.context.renderingService.dirtify()}))},r.prototype.shouldMergeColor=function(e,r,n){var i=e.parsedStyle[n],o=r.parsedStyle[n];return!(!t.isCSSRGB(i)||!t.isCSSRGB(o))||(!(!t.isPattern(i)||!t.isPattern(o)||i.image!==o.image)||!(!Array.isArray(i)||!Array.isArray(o)||e.style[n]!==r.style[n]))},r.prototype.shouldMerge=function(e,t){return!this.instance||(this.instance.nodeName===e.nodeName||this.instance.nodeName===e.renderable.proxyNodeName||this.instance.renderable.proxyNodeName===e.nodeName||this.instance.renderable.proxyNodeName===e.renderable.proxyNodeName)&&(!e.parsedStyle.clipPath&&!(!this.shouldMergeColor(this.instance,e,"fill")||!this.shouldMergeColor(this.instance,e,"stroke")))},r.prototype.createGeometry=function(r){var n=this,i=R(),o=R(),a=[],s=[],l=[],f=[],_=this.divisor;r.forEach((function(e){var r,_=e.parsedStyle,d=_.fill,p=_.stroke,h=_.opacity,E=_.fillOpacity,R=_.strokeOpacity,m=_.lineWidth,S=_.anchor,g=_.visibility,C=_.increasedLineWidthForHitTesting,F=[0,0,0,0];t.isCSSRGB(d)&&(F=[Number(d.r),Number(d.g),Number(d.b),255*Number(d.alpha)]);var I=[0,0,0,0];t.isCSSRGB(p)&&(I=[Number(p.r),Number(p.g),Number(p.b),255*Number(p.alpha)]),y(o,n.context.camera.getViewTransform(),i);var M=e.isInteractive()&&(null===(r=e.renderable3D)||void 0===r?void 0:r.encodedPickingColor)||[0,0,0];if(n.mergeAnchorIntoModelMatrix){var O=e.parsedStyle.anchor,P=0,N=0,x=0,B=e.getGeometryBounds();if(B){var D=B.halfExtents;P=-D[0]*O[0]*2,N=-D[1]*O[1]*2,x=-D[2]*(O[2]||0)*2}y(i,e.getWorldTransform(),A(i,v(P,N,x)))}else T(i,e.getWorldTransform());a.push.apply(a,c([],u(i),!1)),s.push(en(F[0],F[1]),en(F[2],F[3]),en(I[0],I[1]),en(I[2],I[3])),l.push(h,E,R,m,"visible"===g?1:0,S[0],S[1],C||0),f.push.apply(f,c(c([],u(M),!1),[e.sortable.renderOrder*Xr],!1))})),this.geometry.instancedCount=r.length,this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.MODEL_MATRIX,byteStride:64,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGBA,bufferByteOffset:0,location:e.VertexAttributeLocation.MODEL_MATRIX0,divisor:_},{format:e.Format.F32_RGBA,bufferByteOffset:16,location:e.VertexAttributeLocation.MODEL_MATRIX1,divisor:_},{format:e.Format.F32_RGBA,bufferByteOffset:32,location:e.VertexAttributeLocation.MODEL_MATRIX2,divisor:_},{format:e.Format.F32_RGBA,bufferByteOffset:48,location:e.VertexAttributeLocation.MODEL_MATRIX3,divisor:_}],data:new Float32Array(a)}),this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.PACKED_COLOR,byteStride:16,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGBA,bufferByteOffset:0,location:e.VertexAttributeLocation.PACKED_COLOR,divisor:_}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.PACKED_STYLE,byteStride:32,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGBA,bufferByteOffset:0,location:e.VertexAttributeLocation.PACKED_STYLE1,divisor:_},{format:e.Format.F32_RGBA,bufferByteOffset:16,location:e.VertexAttributeLocation.PACKED_STYLE2,divisor:_}],data:new Float32Array(l)}),this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.PICKING_COLOR,byteStride:16,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGBA,bufferByteOffset:0,location:e.VertexAttributeLocation.PICKING_COLOR,divisor:_}],data:new Float32Array(f)})},r.prototype.destroy=function(){this.geometry&&this.geometry.destroy(),this.inputState&&this.inputState.destroy()},r.prototype.applyRenderInst=function(t,r){var n=this,o=this.lightPool.getAllLights(),a=!!this.lightPool.getFog(),s=!!o.length;this.clipPathTarget||this.clipPath?this.clipPathTarget?(this.material.stencilWrite=!0,this.material.depthWrite=!1,this.material.stencilCompare=e.CompareMode.Always,this.material.stencilPassOp=e.StencilOp.Replace):(this.material.stencilWrite=!1,this.material.depthWrite=!0,this.material.stencilCompare=e.CompareMode.Equal,this.material.stencilPassOp=e.StencilOp.Keep):this.material.stencilWrite=!1,(this.materialDirty||this.material.programDirty)&&this.createMaterial(r);var l=i({},this.material.defines);if(this.material.defines.USE_FOG=a,this.material.defines.USE_LIGHT=s,this.material.defines=i(i(i({},this.material.defines),this.lightPool.getDefines()),this.renderHelper.getDefines()),this.material.textureDirty){this.textureMappings=[];var u=this.createFillGradientTextureMapping(r);u&&this.textureMappings.push(u),Object.keys(this.material.textures).sort((function(e,t){return n.material.samplers.indexOf(e)-n.material.samplers.indexOf(t)})).forEach((function(t){var r=new br;r.name=t,r.texture=n.material.textures[t],n.context.device.setResourceName(r.texture,"Material Texture "+t),r.sampler=n.renderHelper.getCache().createSampler({wrapS:e.WrapMode.Clamp,wrapT:e.WrapMode.Clamp,minFilter:e.TexFilterMode.Point,magFilter:e.TexFilterMode.Bilinear,mipFilter:e.MipFilterMode.Linear,minLOD:0,maxLOD:0}),n.textureMappings.push(r)})),this.textureMappings.length?(this.material.defines.USE_UV=!0,this.material.defines.USE_MAP=!0):(this.material.defines.USE_UV=!1,this.material.defines.USE_MAP=!1),this.material.textureDirty=!1}(!Qr(l,this.material.defines)||this.material.programDirty||this.materialDirty)&&(this.material.defines=i(i({},this.material.defines),Jr(e.VertexAttributeLocation)),Object.keys(this.material.defines).forEach((function(e){var t=n.material.defines[e];"boolean"==typeof t?n.program.setDefineBool(e,t):n.program.setDefineString(e,"".concat(t))})),this.program.vert=this.material.vertexShader,this.program.frag=this.material.fragmentShader,this.programDescriptorSimpleWithOrig=Ut(this.context.device,this.program),this.material.programDirty=!1,this.materialDirty=!1),this.material.geometryDirty&&(this.geometryDirty=!0,this.inputStateDirty=!0,this.material.geometryDirty=!1),(this.geometryDirty||this.geometry.dirty)&&(this.geometry&&this.geometry.destroy(),this.createGeometry(r),this.material.wireframe&&this.generateWireframe(this.geometry),this.geometryDirty=!1,this.geometry.dirty=!1,this.inputStateDirty=!0);var c=this.renderHelper.getCache().createInputLayout(this.geometry.inputLayoutDescriptor),f=this.renderHelper.getCache().createProgramSimple(this.programDescriptorSimpleWithOrig),_=!!this.geometry.indexBuffer;this.inputStateDirty&&(this.inputState&&this.inputState.destroy(),this.inputState=this.context.device.createInputState(c,this.geometry.vertexBuffers.map((function(e){return{buffer:e,byteOffset:0}})),_?{buffer:this.geometry.indexBuffer,byteOffset:0}:null,f),this.inputStateDirty=!1),t.renderPipelineDescriptor.topology=this.geometry.drawMode,t.setProgram(f),t.setInputLayoutAndState(c,this.inputState),this.renderer.beforeUploadUBO(t,this,this.index),this.uploadUBO(t),_?t.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.instancedCount,this.geometry.indexStart):t.drawPrimitives(this.geometry.vertexCount,this.geometry.primitiveStart),t.sortKey=_r(e.RendererLayer.OPAQUE,r[0].sortable.renderOrder)},r.prototype.updateBatchedAttribute=function(r,n,i,o){var a=this;if("fill"===i||"stroke"===i){var s=[];r.forEach((function(e){var r=e.parsedStyle,n=r.fill,i=r.stroke,o=[0,0,0,0];t.isCSSRGB(n)&&(o=[Number(n.r),Number(n.g),Number(n.b),255*Number(n.alpha)]);var a=[0,0,0,0];t.isCSSRGB(i)&&(a=[Number(i.r),Number(i.g),Number(i.b),255*Number(i.alpha)]),s.push(en(o[0],o[1]),en(o[2],o[3]),en(a[0],a[1]),en(a[2],a[3]))})),this.geometry.updateVertexBuffer(e.VertexAttributeBufferIndex.PACKED_COLOR,e.VertexAttributeLocation.PACKED_COLOR,n,new Uint8Array(new Float32Array(s).buffer));var l=this.instance.parsedStyle.fill,f=this.textureMappings.findIndex((function(e){return e.name===on}));if(t.isCSSRGB(l))0>f||(this.textureMappings.splice(f,-1),this.material.textureDirty=!0);else{var _=this.createFillGradientTextureMapping([this.instance]);0>f||this.textureMappings.splice(f,1,_),this.material.textureDirty=!0}}else if(["opacity","fillOpacity","strokeOpacity","lineWidth","visibility","anchor","increasedLineWidthForHitTesting"].indexOf(i)>-1){var d=[];r.forEach((function(e){var t=e.parsedStyle,r=t.anchor;d.push(t.opacity,t.fillOpacity,t.strokeOpacity,t.lineWidth,"visible"===t.visibility?1:0,r[0],r[1],t.increasedLineWidthForHitTesting||0)})),this.geometry.updateVertexBuffer(e.VertexAttributeBufferIndex.PACKED_STYLE,e.VertexAttributeLocation.PACKED_STYLE1,n,new Uint8Array(new Float32Array(d).buffer))}else if("modelMatrix"===i){var p=[],h=R();r.forEach((function(e){if(a.mergeAnchorIntoModelMatrix){var t=e.parsedStyle.anchor,r=0,n=0,i=0,o=e.getGeometryBounds();if(o){var s=o.halfExtents;r=-s[0]*t[0]*2,n=-s[1]*t[1]*2,i=-s[2]*(t[2]||0)*2}y(h,e.getWorldTransform(),A(h,v(r,n,i)))}else T(h,e.getWorldTransform());p.push.apply(p,c([],u(h),!1))})),this.geometry.updateVertexBuffer(e.VertexAttributeBufferIndex.MODEL_MATRIX,e.VertexAttributeLocation.MODEL_MATRIX0,n,new Uint8Array(new Float32Array(p).buffer))}else if("pointerEvents"===i){var E=[];r.forEach((function(e){var t,r=o&&e.isInteractive()&&(null===(t=e.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0];E.push.apply(E,c(c([],u(r),!1),[e.sortable.renderOrder*Xr],!1))})),this.geometry.updateVertexBuffer(e.VertexAttributeBufferIndex.PICKING_COLOR,e.VertexAttributeLocation.PICKING_COLOR,n,new Uint8Array(new Float32Array(E).buffer))}},r.prototype.updateAttribute=function(e,t,r,n){"clipPath"===r&&this.clipPath&&(this.geometryDirty=!0)},r.prototype.changeRenderOrder=function(t,r){var n,i=this.objects.indexOf(t),o=t.isInteractive()&&(null===(n=t.renderable3D)||void 0===n?void 0:n.encodedPickingColor)||[0,0,0];this.geometry.updateVertexBuffer(e.VertexAttributeBufferIndex.PICKING_COLOR,e.VertexAttributeLocation.PICKING_COLOR,i,new Uint8Array(new Float32Array(c(c([],u(o),!1),[r*Xr],!1)).buffer))},r.prototype.generateWireframe=function(t){for(var r=t.indices,n=t.indices.length,i=t.vertices.map((function(e){return e.slice()})),o=e.VertexAttributeBufferIndex.PICKING_COLOR;t.vertexBuffers.length>o;o++){var a=t.inputLayoutDescriptor.vertexBufferDescriptors[o].byteStride;t.vertices[o]=new Float32Array(a/4*n)}var s=0,l=new Uint32Array(n);for(o=0;n>o;o++){for(var u=r[o],c=1;t.vertices.length>c;c++)for(var f=(a=t.inputLayoutDescriptor.vertexBufferDescriptors[c].byteStride)/4,_=0;f>_;_++)t.vertices[c][s*f+_]=i[c][u*f+_];l[o]=s,s++}var d=function(e){var r=t.inputLayoutDescriptor.vertexBufferDescriptors[e],n=r.frequency,i=r.byteStride,o=t.inputLayoutDescriptor.vertexAttributeDescriptors.find((function(t){return t.bufferIndex===e}));o&&t.setVertexBuffer({bufferIndex:o.bufferIndex,byteStride:i,frequency:n,attributes:[{format:o.format,bufferByteOffset:o.bufferByteOffset,location:o.location,divisor:o.divisor}],data:t.vertices[e]})};for(o=e.VertexAttributeBufferIndex.PICKING_COLOR+1;t.vertexBuffers.length>o;o++)d(o);var p=new Float32Array(3*n);for(o=0;n>o;)for(c=0;3>c;c++){p[3*(u=l[o++])+c]=1}t.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.BARYCENTRIC,byteStride:12,frequency:e.VertexBufferFrequency.PerVertex,attributes:[{format:e.Format.F32_RGB,bufferByteOffset:0,location:Number(e.VertexAttributeLocation.BARYCENTRIC)}],data:p}),t.setIndexBuffer(l)},r.prototype.beforeUploadUBO=function(e,t,r){},r.prototype.uploadUBO=function(r){var n=this,o=this.material,a=this.lightPool.getAllLights(),s=this.lightPool.getFog(),l=!!s,u=this.lightReceived&&!!a.length,c=[];if(o.defines.USE_WIREFRAME){var f=t.parseColor(o.wireframeColor);c.push({name:"u_WireframeLineColor",value:[Number(f.r)/255,Number(f.g)/255,Number(f.b)/255]}),c.push({name:"u_WireframeLineWidth",value:o.wireframeLineWidth})}if(l&&this.uploadFog(c,s),this.uploadMaterial(c,o),u){var _={};a.forEach((function(e){_[e.define]||(_[e.define]=-1),_[e.define]++,e.uploadUBO(c,_[e.define])}))}c.sort((function(e,t){return n.material.uniformNames.indexOf(e.name)-n.material.uniformNames.indexOf(t.name)})),r.setUniforms(1,c);var d=o.blendEquation,p=o.blendEquationAlpha,h=o.blendSrc,E=o.blendDst,R=o.blendSrcAlpha,T=o.blendDstAlpha,m=$r({blendConstant:o.blendConstant,depthCompare:o.depthCompare,depthWrite:o.depthWrite,stencilCompare:o.stencilCompare,stencilWrite:o.stencilWrite,stencilPassOp:o.stencilPassOp,stencilRef:o.stencilRef,cullMode:o.cullMode,frontFace:o.frontFace,polygonOffset:o.polygonOffset}),A=r.getMegaStateFlags().attachmentsState[0];r.setMegaStateFlags(i({attachmentsState:[{channelWriteMask:this.material.stencilWrite?e.ChannelWriteMask.None:e.ChannelWriteMask.AllChannels,rgbBlendState:i(i({},A.rgbBlendState),$r({blendMode:d,blendSrcFactor:h,blendDstFactor:E})),alphaBlendState:i(i({},A.alphaBlendState),$r({blendMode:p,blendSrcFactor:R,blendDstFactor:T}))}]},m)),r.setBindingLayouts([{numUniformBuffers:1,numSamplers:this.textureMappings.length,samplerEntries:this.samplerEntries}]),r.setSamplerBindingsFromTextureMappings(this.textureMappings)},r.prototype.uploadFog=function(e,r){var n=r.parsedStyle,i=n.type,o=n.fill,a=n.start,s=n.end,l=n.density;if(t.isCSSRGB(o)){var u=[Number(o.r)/255,Number(o.g)/255,Number(o.b)/255,Number(o.alpha)];e.push({name:"u_FogInfos",value:[i,a,s,l]}),e.push({name:"u_FogColor",value:u})}},r.prototype.uploadMaterial=function(e,t){var r=Object.keys(t.uniforms).map((function(e){return{name:e,value:t.uniforms[e]}}));e.push.apply(e,c([],u(r),!1))},r.prototype.createFillGradientTextureMapping=function(r){var n,i=this,o=r[0],a=o.nodeName===t.Shape.LINE?o.parsedStyle.stroke:o.parsedStyle.fill;if(a&&(t.isPattern(a)||Array.isArray(a))){Array.isArray(a)?(this.program.setDefineBool("USE_PATTERN",!1),this.texturePool.getOrCreateGradient({gradients:a,width:128,height:128,instance:o})):t.isPattern(a)&&(this.program.setDefineBool("USE_PATTERN",!0),this.texturePool.getOrCreatePattern(a,o,(function(){r.forEach((function(e){e.renderable.dirty=!0})),i.material.textureDirty=!0}))),n=this.texturePool.getOrCreateCanvas();var s=this.texturePool.getOrCreateTexture(this.context.device,n,ie(e.Format.U8_RGBA_NORM,1,1,1));if(s){var l=new br;return l.name=on,l.texture=s,l.texture.on("loaded",(function(){r.forEach((function(e){e.renderable.dirty=!0})),i.material.textureDirty=!0})),this.context.device.setResourceName(l.texture,"Fill Texture"+this.id),l.sampler=this.renderHelper.getCache().createSampler({wrapS:e.WrapMode.Repeat,wrapT:e.WrapMode.Repeat,minFilter:e.TexFilterMode.Point,magFilter:e.TexFilterMode.Bilinear,mipFilter:e.MipFilterMode.Linear,minLOD:0,maxLOD:0}),l}}return null},r}();!function(e){e[e.PACKED_STYLE=5]="PACKED_STYLE"}(an||(an={})),function(e){e[e.PACKED_STYLE3=12]="PACKED_STYLE3",e[e.SIZE=13]="SIZE"}(sn||(sn={}));var un,cn,fn=[t.Shape.CIRCLE,t.Shape.ELLIPSE,t.Shape.RECT],_n=function(r){function o(){return null!==r&&r.apply(this,arguments)||this}return n(o,r),o.prototype.shouldMerge=function(e,t){return!!r.prototype.shouldMerge.call(this,e,t)},o.prototype.createMaterial=function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec2 a_Extrude;\n// shape, radius, omitStroke, isBillboard\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\nlayout(location = SIZE) in vec2 a_Size;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nout vec3 v_Data;\nout vec2 v_Radius;\nout vec4 v_StylePacked3;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n\n  bool omitStroke = a_StylePacked3.z == 1.0;\n  vec2 radius = a_Size + vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * u_Anchor.xy) * a_Size + a_Extrude * vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n  float antialiasblur = 1.0 / radius.y;\n\n  bool isBillboard = a_StylePacked3.w > 0.5;\n  if (isBillboard) {\n    vec4 mvPosition = u_ViewMatrix * u_ModelMatrix * vec4(0.0, 0.0, u_ZIndex, 1.0);\nvec2 scale;\nscale.x = length(vec3(u_ModelMatrix[0][0], u_ModelMatrix[0][1], u_ModelMatrix[0][2]));\nscale.y = length(vec3(u_ModelMatrix[1][0], u_ModelMatrix[1][1], u_ModelMatrix[1][2]));\n\n// if (sizeAttenuation < 0.5) {\n// bool isPerspective = isPerspectiveMatrix( u_ProjectionMatrix );\n// if ( isPerspective ) scale *= - mvPosition.z;\n// }\n\nvec2 alignedPosition = offset * scale;\n\nfloat rotation = 0.0;\nvec2 rotatedPosition;\nrotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\nrotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\nmvPosition.xy += rotatedPosition;\n\ngl_Position = u_ProjectionMatrix * mvPosition;\n  } else {\n    gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n  \n  v_Radius = radius;\n  v_Data = vec3(a_Extrude * radius / radius.y, antialiasblur);\n  v_StylePacked3 = a_StylePacked3;\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec3 v_Data;\nin vec2 v_Radius;\nin vec4 v_StylePacked3;\n\nout vec4 outputColor;\n\n/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\n// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm\nfloat sdEllipsoidApproximated(vec2 p, vec2 r) {\n  float k0 = length(p / r);\n  float k1 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\n// @see https://www.shadertoy.com/view/4llXD7\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n  p = abs(p) - b + r;\n  return length(max(p, 0.0)) + min(max(p.x, p.y), 0.0) - r;\n}\n\nvoid main() {\n  int shape = int(floor(v_StylePacked3.x + 0.5));\n  float epsilon = 0.000001;\n\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  bool omitStroke = v_StylePacked3.z == 1.0;\n\n  float antialiasblur = v_Data.z;\n  float antialiased_blur = -max(0.0, antialiasblur);\n  vec2 r = (v_Radius - (omitStroke ? 0.0 : u_StrokeWidth)) / v_Radius.y;\n  float wh = v_Radius.x / v_Radius.y;\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'ellipse', 'rect'\n  if (shape == 0) {\n    outer_df = sdCircle(v_Data.xy, 1.0);\n    inner_df = sdCircle(v_Data.xy, r.x);\n  } else if (shape == 1) {\n    outer_df = sdEllipsoidApproximated(v_Data.xy, vec2(wh, 1.0));\n    inner_df = sdEllipsoidApproximated(v_Data.xy, r);\n  } else if (shape == 2) {\n    bool useRadius = v_StylePacked3.y > epsilon;\n    outer_df = sdRoundedBox(v_Data.xy, vec2(wh, 1.0), useRadius ? (v_StylePacked3.y + u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n    inner_df = sdRoundedBox(v_Data.xy, r, useRadius ? (v_StylePacked3.y - u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n\n  vec4 diffuseColor;\n  vec4 strokeColor;\n  if (u_IsPicking > 0.5) {\n    diffuseColor = vec4(u_PickingColor, 1.0);\n    strokeColor = vec4(u_PickingColor, 1.0);\n  } else {\n    diffuseColor = u_Color;\n    strokeColor = (u_StrokeColor == vec4(0) || omitStroke) ? vec4(0.0) : u_StrokeColor;\n  }\n\n  outputColor = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);\n  outputColor.a = outputColor.a * u_Opacity * opacity_t;\n\n  if (outputColor.a < epsilon)\n    discard;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n  }\n}",this.material.defines=i(i({},this.material.defines),Jr(sn))},o.prototype.createGeometry=function(t){var n=this;r.prototype.createGeometry.call(this,t);var i=[];t.forEach((function(e,t){var r=e,o=r.parsedStyle.radius,a=n.shouldOmitStroke(r.parsedStyle),s=n.getSize(e.parsedStyle,r.nodeName);i.push.apply(i,c(c([],u(s),!1),[fn.indexOf(r.nodeName),o&&o[0]||0,a?1:0,r.parsedStyle.isBillboard?1:0],!1))})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.POSITION,byteStride:16,frequency:e.VertexBufferFrequency.PerVertex,attributes:[{format:e.Format.F32_RG,bufferByteOffset:0,location:e.VertexAttributeLocation.POSITION},{format:e.Format.F32_RG,bufferByteOffset:8,location:e.VertexAttributeLocation.UV}],data:new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1])}),this.geometry.setVertexBuffer({bufferIndex:an.PACKED_STYLE,byteStride:24,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RG,bufferByteOffset:0,location:sn.SIZE,divisor:1},{format:e.Format.F32_RGBA,bufferByteOffset:8,location:sn.PACKED_STYLE3,divisor:1}],data:new Float32Array(i)})},o.prototype.updateAttribute=function(e,t,n,i){var o=this;if(r.prototype.updateAttribute.call(this,e,t,n,i),this.updateBatchedAttribute(e,t,n,i),"r"===n||"rx"===n||"ry"===n||"width"===n||"height"===n||"lineWidth"===n||"stroke"===n||"lineDash"===n||"strokeOpacity"===n||"radius"===n||"isBillboard"===n){var a=[];e.forEach((function(e){var t=e,r=o.shouldOmitStroke(t.parsedStyle),n=u(o.getSize(e.parsedStyle,e.nodeName),2);a.push.apply(a,c(c([],u([n[0],n[1]]),!1),[fn.indexOf(e.nodeName),e.parsedStyle.radius&&e.parsedStyle.radius[0]||0,r?1:0,t.parsedStyle.isBillboard?1:0],!1))})),this.geometry.updateVertexBuffer(an.PACKED_STYLE,sn.SIZE,t,new Uint8Array(new Float32Array(a).buffer))}},o.prototype.getSize=function(e,r){var n=[0,0];if(r===t.Shape.CIRCLE){var i=e.r;n=[i,i]}else if(r===t.Shape.ELLIPSE){n=[e.rx,e.ry]}else if(r===t.Shape.RECT){n=[e.width/2,e.height/2]}return n},o.prototype.shouldOmitStroke=function(e){var t=e.lineDash,r=e.stroke,n=e.strokeOpacity,i=r&&!r.isNone,o=t&&t.length&&t.every((function(e){return 0!==e}));return!i||i&&(o||1>n)},o.prototype.needDrawStrokeSeparately=function(e){var t=e.stroke,r=e.lineDash,n=e.lineWidth,i=e.strokeOpacity,o=t&&!t.isNone,a=r&&r.length&&r.every((function(e){return 0!==e}));return o&&n>0&&(a||1>i)},o}(ln),dn=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1];!function(e){e[e.POINT=5]="POINT",e[e.CAP=6]="CAP",e[e.DASH=7]="DASH"}(un||(un={})),function(e){e[e.POSITION=8]="POSITION",e[e.UV=10]="UV",e[e.POINTA=9]="POINTA",e[e.POINTB=11]="POINTB",e[e.CAP=12]="CAP",e[e.DASH=13]="DASH"}(cn||(cn={}));var pn={butt:1,round:2,square:3},hn=function(r){function o(){return null!==r&&r.apply(this,arguments)||this}return n(o,r),o.isLine=function(e){if(e.nodeName===t.Shape.PATH){var r=e.parsedStyle.path.absolutePath;if(2===r.length&&"M"===r[0][0]&&"L"===r[1][0])return!0}else if(e.nodeName===t.Shape.POLYLINE){for(var n=e.parsedStyle.points.points,i=(n[1][0]-n[1][1])/(n[0][0]-n[0][1]),o=1;n.length-1>o;o++)if((n[o+1][0]-n[o+1][1])/(n[o][0]-n[o][1])!==i)return!1;return!0}return!1},o.prototype.shouldMerge=function(e,t){return!!r.prototype.shouldMerge.call(this,e,t)},o.prototype.createMaterial=function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = POINTA) in vec3 a_PointA;\nlayout(location = POINTB) in vec3 a_PointB;\nlayout(location = CAP) in float a_Cap;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\n\nout vec4 v_Dash;\nout vec2 v_Distance;\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n  float clampedStrokeWidth = max(strokeWidth, 1.0);\n\n  float isBillboard = a_Dash.w;\n  bool isPerspective = isPerspectiveMatrix(u_ProjectionMatrix);\n\n  if (isBillboard > 0.5 && isPerspective) {\n    // clip space\n    vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    // screen space\n    vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);\n    vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);\n    vec2 xBasis = normalize(screen1 - screen0);\n    vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n    vec2 pt0 = screen0 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt1 = screen1 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt = mix(pt0, pt1, a_Position.z);\n    vec4 clip = mix(clip0, clip1, a_Position.z);\n    gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    vec2 xBasis = a_PointB.xy - a_PointA.xy;\n    vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n    vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * clampedStrokeWidth * a_Position.y;\n    point = point - u_Anchor.xy * abs(xBasis);\n\n    // round & square\n    if (a_Cap > 1.0) {\n      point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(clampedStrokeWidth / 2.0);\n    }\n    gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  float antialiasblur = 1.0 / strokeWidth;\n  v_Distance = vec2(a_Position.y * 2.0, antialiasblur);\n  v_Dash = vec4(a_Position.x, a_Dash.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\nin vec2 v_Distance;\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n        outputColor = u_Color;\n    #endif\n\n    float blur;\n    if (v_Distance.y < 1.0) {\n      blur = smoothstep(0.0, v_Distance.y, 1.0 - abs(v_Distance.x));\n    } else {\n      blur = 1.0 / v_Distance.y;\n    }\n    float u_dash_offset = v_Dash.y;\n    float u_dash_array = v_Dash.z;\n    float u_dash_ratio = v_Dash.w;\n\n    outputColor.a = outputColor.a\n      * blur\n      * u_Opacity * u_StrokeOpacity\n      * ceil(mod(v_Dash.x + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));\n  }\n}",this.material.defines=i(i({},this.material.defines),Jr(cn))},o.prototype.createGeometry=function(n){var i=this;r.prototype.createGeometry.call(this,n);var o=[],a=[],s=[],l=[],u=0;n.forEach((function(e){var r,n;if(e.nodeName===t.Shape.LINE)r=e.parsedStyle,n=e.getTotalLength();else if(e.nodeName===t.Shape.POLYLINE){var c=e.parsedStyle,f=c.points.points;r={x1:f[0][0],y1:f[0][1],x2:f[f.length-1][0],y2:f[f.length-1][1],z1:0,z2:0,defX:c.defX,defY:c.defY,lineCap:c.lineCap,lineDash:c.lineDash,lineDashOffset:c.lineDashOffset,isBillboard:!0,markerStart:c.markerStart,markerEnd:c.markerEnd,markerStartOffset:c.markerStartOffset,markerEndOffset:c.markerEndOffset},n=e.getTotalLength()}else if(e.nodeName===t.Shape.PATH){var _=e.parsedStyle,d=_.path.absolutePath;r={x1:d[0][1],y1:d[0][2],x2:d[1][1],y2:d[1][2],z1:0,z2:0,defX:_.defX,defY:_.defY,lineCap:_.lineCap,lineDash:_.lineDash,lineDashOffset:_.lineDashOffset,isBillboard:!1,markerStart:_.markerStart,markerEnd:_.markerEnd,markerStartOffset:_.markerStartOffset,markerEndOffset:_.markerEndOffset},n=e.getTotalLength()}var p=r.x1,h=r.y1,E=r.x2,R=r.y2,T=r.z1,m=r.z2,A=r.defX,S=r.defY,y=r.lineCap,v=r.isBillboard,g=i.calcOffset(r),C=g.startOffsetX,F=g.startOffsetY,I=g.endOffsetX,M=g.endOffsetY,O=i.calcDash(r,n),P=O.dashOffset,N=O.dashSegmentPercent,x=O.dashRatioInEachSegment;a.push(pn[y]),s.push(P,N,x,v?1:0),o.push(p-A+C,h-S+F,T,E-A+I,R-S+M,m),l.push(0+u,2+u,1+u,0+u,3+u,2+u),u+=4})),this.geometry.setIndexBuffer(new Uint32Array(l)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.POSITION,byteStride:20,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGB,bufferByteOffset:0,location:cn.POSITION,divisor:0},{format:e.Format.F32_RG,bufferByteOffset:12,location:cn.UV,divisor:0}],data:new Float32Array(dn)}),this.geometry.setVertexBuffer({bufferIndex:un.POINT,byteStride:24,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGB,bufferByteOffset:0,location:cn.POINTA,divisor:1},{format:e.Format.F32_RGB,bufferByteOffset:12,location:cn.POINTB,divisor:1}],data:new Float32Array(o)}),this.geometry.setVertexBuffer({bufferIndex:un.CAP,byteStride:4,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_R,bufferByteOffset:0,location:cn.CAP,divisor:1}],data:new Float32Array(a)}),this.geometry.setVertexBuffer({bufferIndex:un.DASH,byteStride:16,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGBA,bufferByteOffset:0,location:cn.DASH,divisor:1}],data:new Float32Array(s)})},o.prototype.updateAttribute=function(e,n,i,o){var a=this;if(r.prototype.updateAttribute.call(this,e,n,i,o),this.updateBatchedAttribute(e,n,i,o),"x1"===i||"y1"===i||"x2"===i||"y2"===i||"z1"===i||"z2"===i||"markerStartOffset"===i||"markerEndOffset"===i||"markerStart"===i||"markerEnd"===i||"points"===i||"path"===i){var s=[];e.forEach((function(e){var r;if(e.nodeName===t.Shape.LINE)r=e.parsedStyle;else if(e.nodeName===t.Shape.POLYLINE&&e.renderable.proxyNodeName===t.Shape.LINE){var n=e.parsedStyle,i=n.points.points;r={x1:i[0][0],y1:i[0][1],x2:i[i.length-1][0],y2:i[i.length-1][1],z1:0,z2:0,defX:n.defX,defY:n.defY,lineCap:n.lineCap,isBillboard:!0,markerStart:n.markerStart,markerEnd:n.markerEnd,markerStartOffset:n.markerStartOffset,markerEndOffset:n.markerEndOffset}}else if(e.nodeName===t.Shape.PATH&&e.renderable.proxyNodeName===t.Shape.LINE){var o=e.parsedStyle,l=o.path.absolutePath;r={x1:l[0][1],y1:l[0][2],x2:l[1][1],y2:l[1][2],z1:0,z2:0,defX:o.defX,defY:o.defY,lineCap:o.lineCap,isBillboard:!0,markerStart:o.markerStart,markerEnd:o.markerEnd,markerStartOffset:o.markerStartOffset,markerEndOffset:o.markerEndOffset}}var u=r.x1,c=r.y1,f=r.x2,_=r.y2,d=r.z1,p=r.z2,h=r.defX,E=r.defY,R=a.calcOffset(r);s.push(u-h+R.startOffsetX,c-E+R.startOffsetY,d,f-h+R.endOffsetX,_-E+R.endOffsetY,p)})),this.geometry.updateVertexBuffer(un.POINT,cn.POINTA,n,new Uint8Array(new Float32Array(s).buffer))}else if("lineDashOffset"===i||"lineDash"===i||"isBillboard"===i){var l=[];e.forEach((function(e){var t=e.getTotalLength(),r=a.calcDash(e.parsedStyle,t);l.push(r.dashOffset,r.dashSegmentPercent,r.dashRatioInEachSegment,e.parsedStyle.isBillboard?1:0)})),this.geometry.updateVertexBuffer(un.DASH,cn.DASH,n,new Uint8Array(new Float32Array(l).buffer))}else if("lineCap"===i){var u=[];e.forEach((function(e){u.push(pn[e.parsedStyle.lineCap])})),this.geometry.updateVertexBuffer(un.CAP,cn.CAP,n,new Uint8Array(new Float32Array(u).buffer))}},o.prototype.calcOffset=function(e){var r=e.x1,n=e.y1,i=e.x2,o=e.y2,a=e.markerStart,s=e.markerEnd,l=e.markerStartOffset,u=e.markerEndOffset,c=0,f=0,_=0,d=0,p=0;return a&&t.isDisplayObject(a)&&l&&(c=Math.cos(p=Math.atan2(o-n,i-r))*(l||0),f=Math.sin(p)*(l||0)),s&&t.isDisplayObject(s)&&u&&(_=Math.cos(p=Math.atan2(n-o,r-i))*(u||0),d=Math.sin(p)*(u||0)),{startOffsetX:c,startOffsetY:f,endOffsetX:_,endOffsetY:d}},o.prototype.calcDash=function(e,t){var r=e.lineDash,n=0,i=1,o=0;if(r&&r.length){n=(e.lineDashOffset||0)/t;var a=r.reduce((function(e,t){return e+t}),0);0===a?(i=1,o=0):(i=a/t,o=r[1]/a)}return{dashOffset:n,dashSegmentPercent:i,dashRatioInEachSegment:o}},o}(ln),En={exports:{}};function Rn(e,t,r){r=r||2;var n,i,o,a,s,l,u,c=t&&t.length,f=c?t[0]*r:e.length,_=Tn(e,0,f,r,!0),d=[];if(!_||_.next===_.prev)return d;if(c&&(_=function(e,t,r,n){var i,o,a,s=[];for(i=0,o=t.length;o>i;i++)(a=Tn(e,t[i]*n,o-1>i?t[i+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(On(a));for(s.sort(Cn),i=0;s.length>i;i++)r=mn(r=Fn(s[i],r),r.next);return r}(e,t,_,r)),e.length>80*r){n=o=e[0],i=a=e[1];for(var p=r;f>p;p+=r)n>(s=e[p])&&(n=s),i>(l=e[p+1])&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-n,a-i))?1/u:0}return An(_,d,r,n,i,u),d}function Tn(e,t,r,n,i){var o,a;if(i===Wn(e,t,r,n)>0)for(o=t;r>o;o+=n)a=kn(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=kn(o,e[o],e[o+1],a);return a&&Bn(a,a.next)&&(wn(a),a=a.next),a}function mn(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!Bn(n,n.next)&&0!==xn(n.prev,n,n.next))n=n.next;else{if(wn(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function An(e,t,r,n,i,o,a){if(e){!a&&o&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=Mn(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,a,s,l,u=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,n=r,s=0,t=0;u>t&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0===s||0!==l&&n&&r.z>n.z?(i=n,n=n.nextZ,l--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(a>1)}(i)}(e,n,i,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?yn(e,n,i,o):Sn(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),wn(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?An(e=vn(mn(e),t,r),t,r,n,i,o,2):2===a&&gn(e,t,r,n,i,o):An(mn(e),t,r,n,i,o,1);break}}}function Sn(e){var t=e.prev,r=e,n=e.next;if(xn(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Pn(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&xn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function yn(e,t,r,n){var i=e.prev,o=e,a=e.next;if(xn(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=Mn(o.x>i.x?a.x>i.x?i.x:a.x:a.x>o.x?o.x:a.x,o.y>i.y?a.y>i.y?i.y:a.y:a.y>o.y?o.y:a.y,t,r,n),c=Mn(s,l,t,r,n),f=e.prevZ,_=e.nextZ;f&&f.z>=u&&_&&c>=_.z;){if(f!==e.prev&&f!==e.next&&Pn(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&xn(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,_!==e.prev&&_!==e.next&&Pn(i.x,i.y,o.x,o.y,a.x,a.y,_.x,_.y)&&xn(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;f&&f.z>=u;){if(f!==e.prev&&f!==e.next&&Pn(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&xn(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;_&&c>=_.z;){if(_!==e.prev&&_!==e.next&&Pn(i.x,i.y,o.x,o.y,a.x,a.y,_.x,_.y)&&xn(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function vn(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!Bn(i,o)&&Dn(i,n,n.next,o)&&Un(i,o)&&Un(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),wn(n),wn(n.next),n=e=o),n=n.next}while(n!==e);return mn(n)}function gn(e,t,r,n,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Nn(a,s)){var l=Gn(a,s);return a=mn(a,a.next),l=mn(l,l.next),An(a,t,r,n,i,o),void An(l,t,r,n,i,o)}s=s.next}a=a.next}while(a!==e)}function Cn(e,t){return e.x-t.x}function Fn(e,t){var r=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(n.y>=o&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(i>=s&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.next.x>n.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;var l,u=r,c=r.x,f=r.y,_=1/0;n=r;do{n.x>i||c>n.x||i===n.x||!Pn(f>o?i:a,o,c,f,f>o?a:i,o,n.x,n.y)||(l=Math.abs(o-n.y)/(i-n.x),Un(n,e)&&(_>l||l===_&&(n.x>r.x||n.x===r.x&&In(r,n)))&&(r=n,_=l)),n=n.next}while(n!==u);return r}(e,t);if(!r)return t;var n=Gn(r,e),i=mn(r,r.next);return mn(n,n.next),t===r?i:t}function In(e,t){return 0>xn(e.prev,e,t.prev)&&0>xn(t.next,e,e.next)}function Mn(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function On(e){var t=e,r=e;do{(r.x>t.x||t.x===r.x&&r.y>t.y)&&(r=t),t=t.next}while(t!==e);return r}function Pn(e,t,r,n,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function Nn(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Dn(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Un(e,t)&&Un(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x>i&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(xn(e.prev,e,t.prev)||xn(e,t.prev,t))||Bn(e,t)&&xn(e.prev,e,e.next)>0&&xn(t.prev,t,t.next)>0)}function xn(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Bn(e,t){return e.x===t.x&&e.y===t.y}function Dn(e,t,r,n){var i=bn(xn(e,t,r)),o=bn(xn(e,t,n)),a=bn(xn(r,n,e)),s=bn(xn(r,n,t));return i!==o&&a!==s||(!(0!==i||!Ln(e,r,t))||(!(0!==o||!Ln(e,n,t))||(!(0!==a||!Ln(r,e,n))||!(0!==s||!Ln(r,t,n)))))}function Ln(e,t,r){return!(t.x>Math.max(e.x,r.x)||Math.min(e.x,r.x)>t.x||t.y>Math.max(e.y,r.y)||Math.min(e.y,r.y)>t.y)}function bn(e){return e>0?1:0>e?-1:0}function Un(e,t){return 0>xn(e.prev,e,e.next)?xn(e,t,e.next)>=0&&xn(e,e.prev,t)>=0:0>xn(e,t,e.prev)||0>xn(e,e.next,t)}function Gn(e,t){var r=new Vn(e.i,e.x,e.y),n=new Vn(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function kn(e,t,r,n){var i=new Vn(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function wn(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Vn(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wn(e,t,r,n){for(var i=0,o=t,a=r-n;r>o;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}En.exports=Rn,En.exports.default=Rn,Rn.deviation=function(e,t,r,n){var i=t&&t.length,o=Math.abs(Wn(e,0,i?t[0]*r:e.length,r));if(i)for(var a=0,s=t.length;s>a;a++){o-=Math.abs(Wn(e,t[a]*r,s-1>a?t[a+1]*r:e.length,r))}var l=0;for(a=0;n.length>a;a+=3){var u=n[a]*r,c=n[a+1]*r,f=n[a+2]*r;l+=Math.abs((e[u]-e[f])*(e[c+1]-e[u+1])-(e[u]-e[c])*(e[f+1]-e[u+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Rn.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;e.length>i;i++){for(var o=0;e[i].length>o;o++)for(var a=0;t>a;a++)r.vertices.push(e[i][o][a]);i>0&&r.holes.push(n+=e[i-1].length)}return r};var Xn=En.exports;function Hn(e,t,r,n){var i=e-r,o=t-n;return Math.sqrt(i*i+o*o)}function Yn(e,t,r,n,i){return{x:(1-i)*e+i*r,y:(1-i)*t+i*n}}function Kn(e,t,r,n,i){var o=1-i;return o*o*o*e+3*t*i*o*o+3*r*i*i*o+n*i*i*i}function zn(e,t,r,n,i,o,a,s,l){if(0===l)return function(e,t){for(var r=0,n=e.length,i=0;n>i;i++)r+=Hn(e[i],t[i],e[(i+1)%n],t[(i+1)%n]);return r/2}([e,r,i,a],[t,n,o,s]);var f=function(e,t,r,n,i,o,a,s,l){var u=Kn(e,r,i,a,l),c=Kn(t,n,o,s,l),f=Yn(e,t,r,n,l),_=Yn(r,n,i,o,l),d=Yn(i,o,a,s,l),p=Yn(f.x,f.y,_.x,_.y,l),h=Yn(_.x,_.y,d.x,d.y,l);return[[e,t,f.x,f.y,p.x,p.y,u,c],[u,c,h.x,h.y,d.x,d.y,a,s]]}(e,t,r,n,i,o,a,s,.5),_=c(c([],u(f[0]),!1),[l-1],!1),d=c(c([],u(f[1]),!1),[l-1],!1);return zn.apply(void 0,c([],u(_),!1))+zn.apply(void 0,c([],u(d),!1))}function jn(e,t,r,n){var i=1-n;return i*i*e+2*n*i*t+n*n*r}function Zn(e,t,r,n,i,o,a){if(0===a)return(Hn(e,t,r,n)+Hn(r,n,i,o)+Hn(e,t,i,o))/2;var s=function(e,t,r,n,i,o,a){var s=jn(e,r,i,a),l=jn(t,n,o,a),u=Yn(e,t,r,n,a),c=Yn(r,n,i,o,a);return[[e,t,u.x,u.y,s,l],[s,l,c.x,c.y,i,o]]}(e,t,r,n,i,o,.5),l=s[0],f=s[1];return l.push(a-1),f.push(a-1),Zn.apply(void 0,c([],u(l),!1))+Zn.apply(void 0,c([],u(f),!1))}var qn=10,Jn=8,Qn=100;function $n(e,t,r,n,i,o){for(var a=i[i.length-2],s=i[i.length-1],l=null!=o?o:re(Zn(a,s,e,t,r,n,3)/qn,Jn,Qn),u=0,c=0,f=1;l>=f;++f){var _=f/l;i.push((u=a+(e-a)*_)+(e+(r-e)*_-u)*_,(c=s+(t-s)*_)+(t+(n-t)*_-c)*_)}}function ei(e,t,r,n,i,o,a,s){var l=a[a.length-2],u=a[a.length-1];a.length-=2;var c=null!=s?s:re(zn(l,u,e,t,r,n,i,o,3)/qn,Jn,Qn),f=0,_=0,d=0,p=0,h=0;a.push(l,u);for(var E=1,R=0;c>=E;++E)a.push((d=(_=(f=1-(R=E/c))*f)*f)*l+3*_*R*e+3*f*(p=R*R)*r+(h=p*R)*i,d*u+3*_*R*t+3*f*p*n+h*o)}var ti,ri,ni=1e20,ii=function(){function e(e){var r=e.fontSize,n=void 0===r?24:r,i=e.buffer,o=void 0===i?3:i,a=e.radius,s=void 0===a?8:a,l=e.cutoff,u=void 0===l?.25:l,c=e.fontFamily,f=void 0===c?"sans-serif":c,_=e.fontWeight,d=void 0===_?"normal":_,p=e.fontStyle,h=void 0===p?"normal":p,E=e.canvas;this.buffer=o,this.cutoff=u,this.radius=s;var R=this.size=n+4*o,T=t.runtime.offscreenCanvasCreator.getOrCreateCanvas(E);T.width=R,T.height=R;var m=t.runtime.offscreenCanvasCreator.getOrCreateContext(E,{willReadFrequently:!0});this.ctx=m,m.font="".concat(h," ").concat(d," ").concat(n,"px ").concat(f),m.textBaseline="alphabetic",m.textAlign="left",m.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}return e.prototype.draw=function(e){var t=this.ctx.measureText(e),r=t.width,n=t.actualBoundingBoxDescent,i=t.actualBoundingBoxLeft,o=t.actualBoundingBoxRight,a=Math.ceil(t.actualBoundingBoxAscent),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),l=Math.min(this.size-this.buffer,a+Math.ceil(n)),u=s+2*this.buffer,c=l+2*this.buffer,f=Math.max(u*c,0),_=new Uint8ClampedArray(f),d={data:_,width:u,height:c,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:r};if(0===s||0===l)return d;var p=this,h=p.ctx,E=p.buffer,R=p.gridInner,T=p.gridOuter;h.clearRect(E,E,s,l),h.fillText(e,E,E+a);var m=h.getImageData(E,E,s,l);T.fill(ni,0,f),R.fill(0,0,f);for(var A=0;l>A;A++)for(var S=0;s>S;S++){var y=m.data[4*(A*s+S)+3]/255;if(0!==y){var v=(A+E)*u+S+E;if(1===y)T[v]=0,R[v]=ni;else T[v]=(C=.5-y)>0?C*C:0,R[v]=0>C?C*C:0}}oi(T,0,0,u,c,u,this.f,this.v,this.z),oi(R,E,E,s,l,u,this.f,this.v,this.z);for(var g=0;f>g;g++){var C;_[g]=Math.round(255-255*((C=Math.sqrt(T[g])-Math.sqrt(R[g]))/this.radius+this.cutoff))}return d},e}();function oi(e,t,r,n,i,o,a,s,l){for(var u=t;t+n>u;u++)ai(e,r*o+u,o,i,a,s,l);for(var c=r;r+i>c;c++)ai(e,c*o+t,1,n,a,s,l)}function ai(e,t,r,n,i,o,a){o[0]=0,a[0]=-ni,a[1]=ni,i[0]=e[t];for(var s=1,l=0,u=0;n>s;s++){i[s]=e[t+s*r];var c=s*s;do{u=(i[s]-i[f=o[l]]+c-f*f)/(s-f)/2}while(a[l]>=u&&--l>-1);o[++l]=s,a[l]=u,a[l+1]=ni}for(s=0,l=0;n>s;s++){for(;s>a[l+1];)l++;var f,_=s-(f=o[l]);e[t+s*r]=i[f]+_*_}}!function(e){e[e.PACKED=5]="PACKED",e[e.VERTEX_NUM=6]="VERTEX_NUM",e[e.TRAVEL=7]="TRAVEL",e[e.DASH=8]="DASH"}(ti||(ti={})),function(e){e[e.PREV=8]="PREV",e[e.POINT1=9]="POINT1",e[e.POINT2=10]="POINT2",e[e.NEXT=11]="NEXT",e[e.VERTEX_JOINT=12]="VERTEX_JOINT",e[e.VERTEX_NUM=13]="VERTEX_NUM",e[e.TRAVEL=14]="TRAVEL",e[e.DASH=15]="DASH"}(ri||(ri={}));var si,li=function(t){function r(e,r,n,i){var o=t.call(this,e,r,n,i)||this;return o.renderHelper=e,o.texturePool=r,o.lightPool=n,o.mergeAnchorIntoModelMatrix=!0,o.segmentNum=-1,o.segmentNum=o.calcSegmentNum(i),o}return n(r,t),r.prototype.calcSegmentNum=function(e){return fi(e,!1,12).instancedCount},r.prototype.shouldMerge=function(e,r){if(!t.prototype.shouldMerge.call(this,e,r))return!1;var n=this.calcSegmentNum(e);return this.segmentNum===n},r.prototype.createMaterial=function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\n#ifdef INSTANCED\n  layout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n#else\n  layout(std140) uniform ub_ObjectParams {\n  mat4 u_ModelMatrix;\n  vec4 u_FillColor;\n  vec4 u_StrokeColor;\n  float u_StrokeWidth;\n  float u_Opacity;\n  float u_FillOpacity;\n  float u_StrokeOpacity;\n  float u_Expand;\n  float u_MiterLimit;\n  float u_ScaleMode;\n  float u_Alignment;\n  vec3 u_PickingColor;\n  float u_Dash;\n  float u_Gap;\n  float u_DashOffset;\n  float u_Visible;\n  float u_ZIndex;\n  float u_IncreasedLineWidthForHitTesting;\n};\n#endif\n\nlayout(location = PREV) in vec2 a_Prev;\nlayout(location = POINT1) in vec2 a_Point1;\nlayout(location = POINT2) in vec2 a_Point2;\nlayout(location = NEXT) in vec2 a_Next;\nlayout(location = VERTEX_JOINT) in float a_VertexJoint;\nlayout(location = VERTEX_NUM) in float a_VertexNum;\nlayout(location = TRAVEL) in float a_Travel;\n\n#ifdef INSTANCED\n  layout(location = DASH) in vec4 a_Dash;\n  out vec4 v_Dash;\n#endif\n\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\nconst float FILL_EXPAND = 24.0;\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\n#ifdef INSTANCED\n  const float u_Expand = 1.0;\n  const float u_MiterLimit = 5.0;\n  const float u_ScaleMode = 1.0;\n  const float u_Alignment = 0.5;\n#endif\n\nout vec4 v_Distance;\nout vec4 v_Arc;\nout float v_Type;\nout float v_Travel;\nout float v_ScalingFactor;\n\nvec2 doBisect(\n  vec2 norm, float len, vec2 norm2, float len2, float dy, float inner\n) {\n  vec2 bisect = (norm + norm2) / 2.0;\n  bisect /= dot(norm, bisect);\n  vec2 shift = dy * bisect;\n  if (inner > 0.5) {\n    if (len < len2) {\n      if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n        return dy * norm;\n      }\n    } else {\n      if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n        return dy * norm;\n      }\n    }\n  }\n  return dy * bisect;\n}\n\nvoid main() {\n  #ifdef INSTANCED\n    vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n    v_Dash = a_Dash;\n  #endif\n\n  vec2 pointA = (u_ModelMatrix * vec4(a_Point1, 0., 1.0)).xy;\n  vec2 pointB = (u_ModelMatrix * vec4(a_Point2, 0., 1.0)).xy;\n\n  vec2 xBasis = pointB - pointA;\n  float len = length(xBasis);\n  vec2 forward = xBasis / len;\n  vec2 norm = vec2(forward.y, -forward.x);\n\n  float type = a_VertexJoint;\n\n  float lineWidth;\n  if (u_IsPicking > 0.5) {\n    lineWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    lineWidth = u_StrokeWidth;\n  }\n\n  if (u_ScaleMode > 2.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 1.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 0.5) {\n    vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;\n    lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);\n  }\n  float capType = floor(type / 32.0);\n  type -= capType * 32.0;\n  v_Arc = vec4(0.0);\n  lineWidth *= 0.5;\n  float lineAlignment = 2.0 * u_Alignment - 1.0;\n\n  vec2 pos;\n\n  if (capType == CAP_ROUND) {\n    if (a_VertexNum < 3.5) {\n      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    type = JOINT_CAP_ROUND;\n    capType = 0.0;\n  }\n\n  if (type >= BEVEL) {\n    float dy = lineWidth + u_Expand;\n    float inner = 0.0;\n    if (a_VertexNum >= 1.5) {\n      dy = -dy;\n      inner = 1.0;\n    }\n\n    vec2 base, next, xBasis2, bisect;\n    float flag = 0.0;\n    float sign2 = 1.0;\n    if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {\n      next = (u_ModelMatrix * vec4(a_Prev, 0.0, 1.0)).xy;\n      base = pointA;\n      flag = type - floor(type / 2.0) * 2.0;\n      sign2 = -1.0;\n    } else {\n      next = (u_ModelMatrix * vec4(a_Next, 0.0, 1.0)).xy;\n      base = pointB;\n      if (type >= MITER && type < MITER + 3.5) {\n        flag = step(MITER + 1.5, type);\n        // check miter limit here?\n      }\n    }\n    xBasis2 = next - base;\n    float len2 = length(xBasis2);\n    vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n    float D = norm.x * norm2.y - norm.y * norm2.x;\n    if (D < 0.0) {\n      inner = 1.0 - inner;\n    }\n    norm2 *= sign2;\n\n    if (abs(lineAlignment) > 0.01) {\n      float shift = lineWidth * lineAlignment;\n      pointA += norm * shift;\n      pointB += norm * shift;\n      if (abs(D) < 0.01) {\n        base += norm * shift;\n      } else {\n        base += doBisect(norm, len, norm2, len2, shift, 0.0);\n      }\n    }\n\n    float collinear = step(0.0, dot(norm, norm2));\n    v_Type = 0.0;\n    float dy2 = -1000.0;\n    float dy3 = -1000.0;\n    if (abs(D) < 0.01 && collinear < 0.5) {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        type = JOINT_CAP_ROUND;\n      }\n      // TODO: BUTT here too\n    }\n\n    if (a_VertexNum < 3.5) {\n      if (abs(D) < 0.01) {\n        pos = dy * norm;\n      } else {\n        if (flag < 0.5 && inner < 0.5) {\n          pos = dy * norm;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, inner);\n        }\n      }\n      if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n        float extra = step(CAP_SQUARE, capType) * lineWidth;\n        vec2 back = -forward;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          pos += back * (u_Expand + extra);\n          dy2 = u_Expand;\n        } else {\n          dy2 = dot(pos + base - pointA, back) - extra;\n        }\n      }\n      if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n        float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          dy3 = dot(pos + base - pointB, forward) - extra;\n        } else {\n          pos += forward * (u_Expand + extra);\n          dy3 = u_Expand;\n          if (capType >= CAP_BUTT) {\n            dy2 -= u_Expand + extra;\n          }\n        }\n      }\n    } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n      if (inner > 0.5) {\n        dy = -dy;\n        inner = 0.0;\n      }\n      vec2 d2 = abs(dy) * forward;\n      if (a_VertexNum < 4.5) {\n        dy = -dy;\n        pos = dy * norm;\n      } else if (a_VertexNum < 5.5) {\n        pos = dy * norm;\n      } else if (a_VertexNum < 6.5) {\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      } else {\n        dy = -dy;\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      }\n      dy2 = 0.0;\n      v_Arc.y = dy;\n      v_Arc.z = 0.0;\n      v_Arc.w = lineWidth;\n      v_Type = 3.0;\n    } else if (abs(D) < 0.01) {\n      pos = dy * norm;\n    } else {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        if (inner > 0.5) {\n          dy = -dy;\n          inner = 0.0;\n        }\n        if (a_VertexNum < 4.5) {\n          pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n        } else if (a_VertexNum < 5.5) {\n          pos = dy * norm;\n        } else if (a_VertexNum > 7.5) {\n          pos = dy * norm2;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          float d2 = abs(dy);\n          if (length(pos) > abs(dy) * 1.5) {\n            if (a_VertexNum < 6.5) {\n              pos.x = dy * norm.x - d2 * norm.y;\n              pos.y = dy * norm.y + d2 * norm.x;\n            } else {\n              pos.x = dy * norm2.x + d2 * norm2.y;\n              pos.y = dy * norm2.y - d2 * norm2.x;\n            }\n          }\n        }\n        vec2 norm3 = normalize(norm + norm2);\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        v_Arc.x = sign * dot(pos, norm3);\n        v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;\n        v_Arc.z = dot(norm, norm3) * lineWidth;\n        v_Arc.w = lineWidth;\n        dy = -sign * dot(pos, norm);\n        dy2 = -sign * dot(pos, norm2);\n        dy3 = v_Arc.z - v_Arc.x;\n        v_Type = 3.0;\n      } else {\n        float hit = 0.0;\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (dot(norm, norm2) > 0.0) {\n            type = MITER;\n          }\n        }\n        if (type >= MITER && type < MITER + 3.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          if (length(pos) > abs(dy) * u_MiterLimit) {\n            type = BEVEL;\n          } else {\n            if (a_VertexNum < 4.5) {\n              dy = -dy;\n              pos = doBisect(norm, len, norm2, len2, dy, 1.0);\n            } else if (a_VertexNum < 5.5) {\n              pos = dy * norm;\n            } else if (a_VertexNum > 6.5) {\n              pos = dy * norm2;\n            }\n            v_Type = 1.0;\n            dy = -sign * dot(pos, norm);\n            dy2 = -sign * dot(pos, norm2);\n            hit = 1.0;\n          }\n        }\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float d2 = abs(dy);\n          vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);\n          vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);\n          if (a_VertexNum < 4.5) {\n            pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n          } else if (a_VertexNum < 5.5) {\n            pos = dy * norm;\n          } else if (a_VertexNum > 7.5) {\n            pos = dy * norm2;\n          } else {\n            if (a_VertexNum < 6.5) {\n              pos = pos3;\n            } else {\n              pos = pos4;\n            }\n          }\n          vec2 norm3 = normalize(norm + norm2);\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          dy = -sign * dot(pos, norm);\n          dy2 = -sign * dot(pos, norm2);\n          dy3 = (-sign * dot(pos, norm3)) + lineWidth;\n          v_Type = 4.0;\n          hit = 1.0;\n        }\n        if (hit < 0.5) {\n          gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n          return;\n        }\n      }\n    }\n    pos += base;\n    v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;\n    v_Arc = v_Arc * u_DevicePixelRatio;\n    v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));\n  }\n\n  v_ScalingFactor = sqrt(u_ModelMatrix[0][0] * u_ModelMatrix[0][0] + u_ModelMatrix[0][1] * u_ModelMatrix[0][1] + u_ModelMatrix[0][2] * u_ModelMatrix[0][2]);\n\n  gl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\n#ifdef INSTANCED\n  in vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n  in vec4 v_Dash;\n#else\n  layout(std140) uniform ub_ObjectParams {\n  mat4 u_ModelMatrix;\n  vec4 u_FillColor;\n  vec4 u_StrokeColor;\n  float u_StrokeWidth;\n  float u_Opacity;\n  float u_FillOpacity;\n  float u_StrokeOpacity;\n  float u_Expand;\n  float u_MiterLimit;\n  float u_ScaleMode;\n  float u_Alignment;\n  vec3 u_PickingColor;\n  float u_Dash;\n  float u_Gap;\n  float u_DashOffset;\n  float u_Visible;\n  float u_ZIndex;\n  float u_IncreasedLineWidthForHitTesting;\n};\n#endif\n\nin vec4 v_Distance;\nin vec4 v_Arc;\nin float v_Type;\nin float v_Travel;\nin float v_ScalingFactor;\n\nout vec4 outputColor;\n\nvoid main(){\n  #ifdef INSTANCED\n    vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #else\n    if (u_Visible < 0.5) {\n      discard;\n    }\n  #endif\n\n  float alpha = 1.0;\n  float lineWidth = v_Distance.w;\n  if (v_Type < 0.5) {\n    float left = max(v_Distance.x - 0.5, -v_Distance.w);\n    float right = min(v_Distance.x + 0.5, v_Distance.w);\n    float near = v_Distance.y - 0.5;\n    float far = min(v_Distance.y + 0.5, 0.0);\n    float top = v_Distance.z - 0.5;\n    float bottom = min(v_Distance.z + 0.5, 0.0);\n    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);\n  } else if (v_Type < 1.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n  } else if (v_Type < 2.5) {\n    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  } else if (v_Type < 3.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);\n    float d = length(v_Arc.xy);\n    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);\n    float circle_vert = min(v_Arc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n  } else {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  }\n\n  #ifdef INSTANCED\n    float u_Dash = v_Dash.x;\n    float u_Gap = v_Dash.y;\n    float u_DashOffset = v_Dash.z;\n  #endif\n  if (u_Dash + u_Gap > 1.0) {\n    float travel = mod(v_Travel + u_Gap * v_ScalingFactor * 0.5 + u_DashOffset, u_Dash * v_ScalingFactor + u_Gap * v_ScalingFactor) - (u_Gap * v_ScalingFactor * 0.5);\n    float left = max(travel - 0.5, -0.5);\n    float right = min(travel + 0.5, u_Gap * v_ScalingFactor + 0.5);\n    alpha *= max(0.0, right - left);\n  }\n\n  if (u_IsPicking > 0.5) {\n    #ifdef INSTANCED\n      vec3 pickingColor = u_PickingColor;\n    #else\n      vec3 pickingColor = u_PickingColor / 255.0;\n    #endif\n    if (pickingColor.x == 0.0 && pickingColor.y == 0.0 && pickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(pickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    outputColor.a *= alpha * u_Opacity * u_StrokeOpacity;\n  }\n}",this.material.defines=i(i(i({},this.material.defines),Jr(ri)),{INSTANCED:!0})},r.prototype.createGeometry=function(r){var n=[],i=[],o=[],a=[],s=0,l=0;r.forEach((function(e){var t=fi(e,!1,12),r=t.pointsBuffer,f=t.travelBuffer,_=t.instancedCount,d=e.parsedStyle,p=d.lineDash;a.push(p&&p[0]||0,p&&p[1]||0,d.lineDashOffset||0,d.isBillboard?1:0),s+=_;for(var h=0;r.length-9>h;h+=3)i.push(r[h],r[h+1],r[h+2],r[h+3],r[h+4],r[h+5],r[h+6],r[h+7],r[h+8],r[h+9],r[h+10],r[h+11]);o.push.apply(o,c([],u(f),!1)),n.push(0+l,2+l,1+l,0+l,3+l,2+l,4+l,6+l,5+l,4+l,7+l,6+l,4+l,7+l,8+l),l+=9})),i.length&&(this.geometry.setVertexBuffer({bufferIndex:ti.PACKED,byteStride:48,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RG,bufferByteOffset:0,location:ri.PREV,divisor:1},{format:e.Format.F32_RG,bufferByteOffset:12,location:ri.POINT1,divisor:1},{format:e.Format.F32_R,bufferByteOffset:20,location:ri.VERTEX_JOINT,divisor:1},{format:e.Format.F32_RG,bufferByteOffset:24,location:ri.POINT2,divisor:1},{format:e.Format.F32_RG,bufferByteOffset:36,location:ri.NEXT,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:ti.VERTEX_NUM,byteStride:4,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_R,bufferByteOffset:0,byteStride:4,location:ri.VERTEX_NUM,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),this.geometry.setVertexBuffer({bufferIndex:ti.TRAVEL,byteStride:4,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_R,bufferByteOffset:0,byteStride:4,location:ri.TRAVEL,divisor:1}],data:new Float32Array(o)}),this.divisor=s/r.length,this.geometry.setVertexBuffer({bufferIndex:ti.DASH,byteStride:16,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGBA,bufferByteOffset:0,location:ri.DASH,divisor:this.divisor}],data:new Float32Array(a)}),t.prototype.createGeometry.call(this,r),this.geometry.vertexCount=15,this.geometry.instancedCount=s,this.geometry.setIndexBuffer(new Uint32Array(n)))},r.prototype.updateAttribute=function(e,r,n,i){if(t.prototype.updateAttribute.call(this,e,r,n,i),this.updateBatchedAttribute(e,r,n,i),"r"===n||"rx"===n||"ry"===n||"width"===n||"height"===n||"radius"===n||"x1"===n||"y1"===n||"x2"===n||"y2"===n||"points"===n||"path"===n||"lineJoin"===n||"lineCap"===n||"markerStartOffset"===n||"markerEndOffset"===n||"markerStart"===n||"markerEnd"===n){var o=[],a=[],s=0;e.forEach((function(e){var t=fi(e,!1,12),r=t.pointsBuffer,n=t.travelBuffer;s=t.instancedCount;for(var i=0;r.length-9>i;i+=3)o.push(r[i],r[i+1],r[i+2],r[i+3],r[i+4],r[i+5],r[i+6],r[i+7],r[i+8],r[i+9],r[i+10],r[i+11]);a.push.apply(a,c([],u(n),!1))})),this.geometry.updateVertexBuffer(ti.PACKED,ri.PREV,r*s,new Uint8Array(new Float32Array(o).buffer)),this.geometry.updateVertexBuffer(ti.TRAVEL,ri.TRAVEL,r,new Uint8Array(new Float32Array(a).buffer))}else if("lineDashOffset"===n||"lineDash"===n||"isBillboard"===n){var l=[];e.forEach((function(e){var t=e.parsedStyle,r=t.lineDash;l.push(r&&r[0]||0,r&&r[1]||0,t.lineDashOffset||0,t.isBillboard?1:0)})),this.geometry.updateVertexBuffer(ti.DASH,ti.DASH,r,new Uint8Array(new Float32Array(l).buffer))}},r}(ln);e.JOINT_TYPE=void 0,(si=e.JOINT_TYPE||(e.JOINT_TYPE={}))[si.NONE=0]="NONE",si[si.FILL=1]="FILL",si[si.JOINT_BEVEL=4]="JOINT_BEVEL",si[si.JOINT_MITER=8]="JOINT_MITER",si[si.JOINT_ROUND=12]="JOINT_ROUND",si[si.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",si[si.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",si[si.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",si[si.FILL_EXPAND=24]="FILL_EXPAND",si[si.CAP_BUTT=32]="CAP_BUTT",si[si.CAP_SQUARE=64]="CAP_SQUARE",si[si.CAP_ROUND=96]="CAP_ROUND",si[si.CAP_BUTT2=128]="CAP_BUTT2";var ui=2,ci=3;function fi(r,n,i){var o;void 0===n&&(n=!1);var a=r.parsedStyle,s=a.lineCap,l=a.lineJoin,f=r.parsedStyle,_=f.defX,d=f.defY,p=r.parsedStyle,h=p.markerStart,E=p.markerEnd,T=p.markerStartOffset,m=p.markerEndOffset,A=[],S=[];if(r.nodeName===t.Shape.POLYLINE||r.nodeName===t.Shape.POLYGON){var y=r.parsedStyle.points.points,v=y.length,g=0,F=0,I=0,M=0,O=0;if(h&&t.isDisplayObject(h)&&T&&(g=Math.cos(O=Math.atan2(y[1][1]-y[0][1],y[1][0]-y[0][0]))*(T||0),F=Math.sin(O)*(T||0)),E&&t.isDisplayObject(E)&&m&&(I=Math.cos(O=Math.atan2(y[v-2][1]-y[v-1][1],y[v-2][0]-y[v-1][0]))*(m||0),M=Math.sin(O)*(m||0)),A[0]=y.reduce((function(e,t,r){var n=0,i=0;return 0===r?(n=g,i=F):r===v-1&&(n=I,i=M),e.push(t[0]-_+n,t[1]-d+i),e}),[]),r.nodeName===t.Shape.POLYGON){if(n)return S=Xn(A[0],[],2),{pointsBuffer:A[0],travelBuffer:[],triangles:S,instancedCount:Math.round(A[0].length/ui)};A[0].push(A[0][0],A[0][1]),(o=A[0]).push.apply(o,c([],u(_i(A[0][0],A[0][1],A[0][2],A[0][3])),!1))}}else if(r.nodeName===t.Shape.PATH||r.nodeName===t.Shape.CIRCLE||r.nodeName===t.Shape.ELLIPSE||r.nodeName===t.Shape.RECT){var P=void 0;if(r.nodeName!==t.Shape.PATH){if(P=t.parsePath(t.convertToPath(r,function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(R()))),_=P.rect.x,d=P.rect.y,r.nodeName===t.Shape.RECT){var N=r.parsedStyle;0>N.width&&(_+=P.rect.width),0>N.height&&(d+=P.rect.height)}}else P=r.parsedStyle.path;var x=P.absolutePath,B=P.segments,D=0,L=0,b=0,U=0;O=0;if(h&&t.isDisplayObject(h)&&T){var G=u(h.parentNode.getStartTangent(),2);D=Math.cos(O=Math.atan2((k=G[0])[1]-(w=G[1])[1],k[0]-w[0]))*(T||0),L=Math.sin(O)*(T||0)}if(E&&t.isDisplayObject(E)&&m){var k,w,V=u(E.parentNode.getEndTangent(),2);b=Math.cos(O=Math.atan2((k=V[0])[1]-(w=V[1])[1],k[0]-w[0]))*(m||0),U=Math.sin(O)*(m||0)}var W=-1,X=-1;if(x.forEach((function(e,n){var o,a=u(e),s=a[0],l=a.slice(1),f=x[n+1],p=0===n&&(0!==D||0!==L),h=(n===x.length-1||f&&("M"===f[0]||"Z"===f[0]))&&0!==b&&0!==U;if("M"===s)X++,A[X]=[],W=A[X].length,p?A[X].push(l[0]-_+D,l[1]-d+L,l[0]-_,l[1]-d):A[X].push(l[0]-_,l[1]-d);else if("L"===s)h?A[X].push(l[0]-_+b,l[1]-d+U):A[X].push(l[0]-_,l[1]-d);else if("Q"===s)$n(l[0]-_,l[1]-d,l[2]-_,l[3]-d,A[X],i),h&&A[X].push(l[2]-_+b,l[3]-d+U);else if("A"===s){for(var E=u(B[n].prePoint,2),R=C(E[0],E[1],l[0],l[1],l[2],l[3],l[4],l[5],l[6],void 0),T=0;R.length>T;T+=6)ei(R[T]-_,R[T+1]-d,R[T+2]-_,R[T+3]-d,R[T+4]-_,R[T+5]-d,A[X],i);h&&A[X].push(l[5]-_+b,l[6]-d+U)}else if("C"===s)ei(l[0]-_,l[1]-d,l[2]-_,l[3]-d,l[4]-_,l[5]-d,A[X],i),h&&A[X].push(l[4]-_+b,l[5]-d+U);else if("Z"===s&&(r.nodeName===t.Shape.PATH||r.nodeName===t.Shape.RECT)){var m=1e-4;(Math.abs(A[X][A[X].length-2]-A[X][W])>m||Math.abs(A[X][A[X].length-1]-A[X][W+1])>m)&&A[X].push(A[X][W],A[X][W+1]),(o=A[X]).push.apply(o,c([],u(_i(A[X][W],A[X][W+1],A[X][W+2],A[X][W+3])),!1))}})),n){var H=A.reduce((function(e,t){return e.push.apply(e,c([],u(t),!1)),e}),[]);return{pointsBuffer:H,travelBuffer:[],triangles:S=Xn(H,[],2),instancedCount:Math.round(H.length/ui)}}}var Y=function(t){var r;switch(t){case"bevel":r=e.JOINT_TYPE.JOINT_BEVEL;break;case"round":r=e.JOINT_TYPE.JOINT_ROUND;break;default:r=e.JOINT_TYPE.JOINT_MITER}return r}(l),K=function(t){var r;switch(t){case"square":r=e.JOINT_TYPE.CAP_SQUARE;break;case"round":r=e.JOINT_TYPE.CAP_ROUND;break;default:r=e.JOINT_TYPE.CAP_BUTT}return r}(s),z=K;K===e.JOINT_TYPE.CAP_ROUND&&(z=e.JOINT_TYPE.JOINT_CAP_ROUND),K===e.JOINT_TYPE.CAP_BUTT&&(z=e.JOINT_TYPE.JOINT_CAP_BUTT),K===e.JOINT_TYPE.CAP_SQUARE&&(z=e.JOINT_TYPE.JOINT_CAP_SQUARE);var j=(Math.round(0/ui)+2)*ci;return A.map((function(t){for(var r=0,n=[],i=[],o=0;t.length>o;o+=ui)o>1&&(r+=Math.sqrt(Math.pow(t[o]-t[o-2],2)+Math.pow(t[o+1]-t[o+1-2],2))),i.push(r),n[j++]=t[o],n[j++]=t[o+1],n[j]=Y,0==o&&K!==e.JOINT_TYPE.CAP_ROUND&&(n[j]+=K),t.length>o+2*ui?t.length>o+ui||(n[j]=0):n[j]+=z-Y,j++;return n[j++]=t[t.length-4],n[j++]=t[t.length-3],n[j++]=0,n[0]=t[0],n[1]=t[1],n[2]=0,n[3]=t[2],n[4]=t[3],n[5]=K===e.JOINT_TYPE.CAP_ROUND?K:0,{pointsBuffer:n,travelBuffer:i,triangles:S,instancedCount:Math.round(t.length/ui)}})).reduce((function(e,t){var r,n;return(r=e.pointsBuffer).push.apply(r,c([],u(t.pointsBuffer),!1)),(n=e.travelBuffer).push.apply(n,c([],u(t.travelBuffer),!1)),e.instancedCount+=t.instancedCount,e}),{pointsBuffer:[],travelBuffer:[],triangles:S,instancedCount:0})}function _i(e,t,r,n){void 0===r&&(r=e),void 0===n&&(n=t);var i=[r-e,n-t];return[e+.01*i[0],t+.01*i[1]]}var di=function(t){function r(e,r,n,i){var o=t.call(this,e,r,n,i)||this;return o.renderHelper=e,o.texturePool=r,o.lightPool=n,o.trianglesHash=[[],[]],o.trianglesHash=o.calcSegmentNum(i),o}return n(r,t),r.prototype.calcSegmentNum=function(e){var t=fi(e,!0,12);return[t.triangles,t.pointsBuffer]},r.prototype.compareTrianglesHash=function(e){var t=u(this.trianglesHash,2),r=t[0],n=t[1],i=u(e,2),o=i[0],a=i[1];return r.length===o.length&&n.length===a.length&&(!r.some((function(e,t){return e!==o[t]}))&&!n.some((function(e,t){return e!==a[t]})))},r.prototype.shouldMerge=function(e,r){if(!t.prototype.shouldMerge.call(this,e,r))return!1;var n=this.calcSegmentNum(e);return this.compareTrianglesHash(n)},r.prototype.createGeometry=function(r){t.prototype.createGeometry.call(this,r);var n=[],i=[],o=[];r.forEach((function(e,t){var r=fi(e,!0,12),a=r.triangles,s=r.pointsBuffer,l=e.getGeometryBounds().halfExtents,f=s.map((function(e,t){return e/l[t%2]/2}));i.push.apply(i,c([],u(s),!1)),o.push.apply(o,c([],u(f),!1)),n.push.apply(n,c([],u(a.map((function(e){return e+t*s.length/2}))),!1))})),this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.POSITION,byteStride:8,frequency:e.VertexBufferFrequency.PerVertex,attributes:[{format:e.Format.F32_RG,bufferByteOffset:0,location:e.VertexAttributeLocation.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.UV,byteStride:8,frequency:e.VertexBufferFrequency.PerVertex,attributes:[{format:e.Format.F32_RG,bufferByteOffset:0,location:e.VertexAttributeLocation.UV}],data:new Float32Array(o)}),this.geometry.vertexCount=n.length/r.length,this.geometry.setIndexBuffer(new Uint32Array(n))},r.prototype.createMaterial=function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec2 a_Position;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n  gl_Position = project(vec4(a_Position, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n\n    outputColor.a = outputColor.a * u_Opacity * u_FillOpacity;\n  }\n}",this.material.defines=i(i({},this.material.defines),{INSTANCED:!0})},r.prototype.updateAttribute=function(e,r,n,i){t.prototype.updateAttribute.call(this,e,r,n,i),this.updateBatchedAttribute(e,r,n,i)},r}(ln),pi=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.shouldMerge=function(e,r){return!!t.prototype.shouldMerge.call(this,e,r)&&this.instance.parsedStyle.img===e.parsedStyle.img},r.prototype.createMaterial=function(e){var t=e[0].parsedStyle.img;this.material.defines=i({},this.material.defines),this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec4 a_Size;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nbool isPerspectiveMatrix(mat4 m) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec2 offset = (a_Uv - u_Anchor.xy) * a_Size.xy;\n\n  bool isPerspective = isPerspectiveMatrix(u_ProjectionMatrix);\n\n  bool isBillboard = a_Size.w > 0.5;\n  if (isBillboard) {\n    vec4 mvPosition = u_ViewMatrix * u_ModelMatrix * vec4(0.0, 0.0, u_ZIndex, 1.0);\nvec2 scale;\nscale.x = length(vec3(u_ModelMatrix[0][0], u_ModelMatrix[0][1], u_ModelMatrix[0][2]));\nscale.y = length(vec3(u_ModelMatrix[1][0], u_ModelMatrix[1][1], u_ModelMatrix[1][2]));\n\n// if (sizeAttenuation < 0.5) {\n// bool isPerspective = isPerspectiveMatrix( u_ProjectionMatrix );\n// if ( isPerspective ) scale *= - mvPosition.z;\n// }\n\nvec2 alignedPosition = offset * scale;\n\nfloat rotation = 0.0;\nvec2 rotatedPosition;\nrotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\nrotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\nmvPosition.xy += rotatedPosition;\n\ngl_Position = u_ProjectionMatrix * mvPosition;\n  } else {\n    gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n\n    // TODO: pointer-events: non-transparent-pixel\n    // if (u_Color.x == 0.0 && u_Color.y == 0.0 && u_Color.z == 0.0) {\n    //   discard;\n    // }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n  }\n}";var r=this.texturePool.getOrCreateTexture(this.context.device,t);this.material.setUniforms({u_Map:r})},r.prototype.createGeometry=function(r){t.prototype.createGeometry.call(this,r);var n=[];r.forEach((function(e,t){var r=e.parsedStyle;n.push(r.width,r.height,r.z,r.isBillboard?1:0)})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.POSITION,byteStride:16,frequency:e.VertexBufferFrequency.PerInstance,attributes:[{format:e.Format.F32_RGBA,bufferByteOffset:0,location:e.VertexAttributeLocation.POSITION}],data:new Float32Array(n)}),this.geometry.setVertexBuffer({bufferIndex:e.VertexAttributeBufferIndex.UV,byteStride:8,frequency:e.VertexBufferFrequency.PerVertex,attributes:[{format:e.Format.F32_RG,bufferByteOffset:0,location:e.VertexAttributeLocation.UV}],data:new Float32Array([0,0,1,0,1,1,0,1])})},r.prototype.updateAttribute=function(r,n,i,o){if(t.prototype.updateAttribute.call(this,r,n,i,o),this.updateBatchedAttribute(r,n,i,o),"width"===i||"height"===i||"z"===i||"isBillboard"===i){var a=[];r.forEach((function(e){var t=e.parsedStyle;a.push(t.width,t.height,t.z,t.isBillboard?1:0)})),this.geometry.updateVertexBuffer(e.VertexAttributeBufferIndex.POSITION,e.VertexAttributeLocation.POSITION,n,new Uint8Array(new Float32Array(a).buffer))}else if("img"===i){var s=this.texturePool.getOrCreateTexture(this.context.device,o);this.material.setUniforms({u_Map:s})}},r}(ln);function hi(e,t,r,n){var i=t.width,o=t.height;if(n){if(n.length!==i*o*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*o*r);return e.width=i,e.height=o,e.data=n,e}function Ei(e,t,r,n,i,o){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=e.data,s=t.data,l=0;i.height>l;l++)for(var u=((r.y+l)*e.width+r.x)*o,c=((n.y+l)*t.width+n.x)*o,f=0;i.width*o>f;f++)s[c+f]=a[u+f];return t}var Ri=function(){function e(e,t){hi(this,e,1,t)}return e.prototype.resize=function(e){!function(e,t,r){var n=t.width,i=t.height;if(n!==e.width||i!==e.height){var o=hi({},{width:n,height:i},r);Ei(e,o,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r),e.width=n,e.height=i,e.data=o.data}}(this,e,1)},e.prototype.clone=function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))},e.copy=function(e,t,r,n,i){Ei(e,t,r,n,i,1)},e}();var Ti=function(e){var t={},r=[];for(var n in e){var i=e[n],o=t[n]={};for(var a in i)(c=i[+a])&&0!==c.bitmap.width&&0!==c.bitmap.height&&(r.push(f={x:0,y:0,w:c.bitmap.width+2,h:c.bitmap.height+2}),o[a]={rect:f,metrics:c.metrics})}var s=function(e){var t,r,n,i,o=0,a=0;try{for(var s=l(e),u=s.next();!u.done;u=s.next())o+=(h=u.value).w*h.h,a=Math.max(a,h.w)}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}e.sort((function(e,t){return t.h-e.h}));var c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),a),h:1/0}],f=0,_=0;try{for(var d=l(e),p=d.next();!p.done;p=d.next())for(var h=p.value,E=c.length-1;E>=0;E--){var R=c[E];if(R.w>=h.w&&R.h>=h.h){if(h.x=R.x,h.y=R.y,_=Math.max(_,h.y+h.h),f=Math.max(f,h.x+h.w),h.w===R.w&&h.h===R.h){var T=c.pop();c.length>E&&(c[E]=T)}else h.h===R.h?(R.x+=h.w,R.w-=h.w):h.w===R.w?(R.y+=h.h,R.h-=h.h):(c.push({x:R.x+h.w,y:R.y,w:R.w-h.w,h:h.h}),R.y+=h.h,R.h-=h.h);break}}}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return{w:f,h:_,fill:o/(f*_)||0}}(r),u=new Ri({width:s.w||1,height:s.h||1});for(var n in e)for(var a in i=e[n]){var c,f;(c=i[+a])&&0!==c.bitmap.width&&0!==c.bitmap.height&&Ri.copy(c.bitmap,u,{x:0,y:0},{x:(f=t[n][a].rect).x+1,y:f.y+1},c.bitmap)}this.image=u,this.positions=t};var mi,Ai,Si,yi=function(){function t(){this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphMap={}}return t.prototype.getMap=function(){return this.glyphMap},t.prototype.getAtlas=function(){return this.glyphAtlas},t.prototype.getAtlasTexture=function(){return this.glyphAtlasTexture},t.prototype.layout=function(e,t,r,n,i,o,a){var s=this,l=[],u=o,c=a,f="right"===n||"end"===n?1:"left"===n||"start"===n?0:.5;return e.forEach((function(e){var n=l.length;Array.from(e).forEach((function(e){var r=s.glyphMap[t],n=e.charCodeAt(0),o=r&&r[n];o&&(l.push({glyph:n,x:u,y:c,scale:1,fontStack:t}),u+=o.metrics.advance+i)}));for(var o=u-i,a=n;l.length>a;a++)l[a].x=l[a].x-f*o;u=0,c+=r})),l},t.prototype.generateAtlas=function(t,r,n,o,a,s,l){var u=this;void 0===r&&(r=""),void 0===a&&(a="");var c=[];this.glyphMap[r]||(c=function(){for(var e=[],t=32;128>t;t++)e.push(String.fromCharCode(t));return e}());var f=Object.keys(this.glyphMap[r]||{});if(Array.from(new Set(s.split(""))).forEach((function(e){-1===f.indexOf(""+e.charCodeAt(0))&&c.push(e)})),c.length){var _=c.map((function(e){return u.generateSDF(t,r,n,o,a,e)})).reduce((function(e,t){return e[t.id]=t,e}),{});this.glyphMap[r]=i(i({},this.glyphMap[r]),_),this.glyphAtlas=new Ti(this.glyphMap);var d=this.glyphAtlas.image,p=d.width,h=d.height,E=d.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=l.createTexture(i(i({},ie(e.Format.ALPHA,p,h,1)),{pixelStore:{unpackFlipY:!1,unpackAlignment:1},immutable:!1})),this.glyphAtlasTexture.setImageData([E],0)}},t.prototype.generateSDF=function(e,t,r,n,i,o){void 0===t&&(t="");var a=o.charCodeAt(0),s=this.sdfGeneratorCache[t];s||(s=this.sdfGeneratorCache[t]=new ii({canvas:e,fontSize:24,fontFamily:r,fontWeight:n,fontStyle:i,buffer:3,radius:8,cutoff:.25})),this.textMetricsCache[t]||(this.textMetricsCache[t]={}),this.textMetricsCache[t][o]||(this.textMetricsCache[t][o]=s.ctx.measureText(o).width);var l=s.draw(o),u=l.glyphWidth,c=l.glyphHeight,f=l.glyphLeft,_=l.glyphTop,d=l.glyphAdvance;return{id:a,bitmap:new Ri({width:l.width,height:l.height},l.data),metrics:{width:u,height:c,left:f,top:_-24+3,advance:d}}},t}();!function(e){e[e.INSTANCED=5]="INSTANCED",e[e.TEX=6]="TEX"}(mi||(mi={})),function(e){e[e.TEX=12]="TEX",e[e.OFFSET=13]="OFFSET"}(Ai||(Ai={})),e.TextUniform=void 0,(Si=e.TextUniform||(e.TextUniform={})).SDF_MAP="u_SDFMap",Si.SDF_MAP_SIZE="u_SDFMapSize",Si.FONT_SIZE="u_FontSize",Si.GAMMA_SCALE="u_GammaScale",Si.STROKE_BLUR="u_StrokeBlur",Si.HAS_STROKE="u_HasStroke";var vi=function(r){function o(e,t,n,i){var o=r.call(this,e,t,n,i)||this;return o.renderHelper=e,o.texturePool=t,o.lightPool=n,o.glyphManager=new yi,o.packedBufferObjectMap=new WeakMap,o.tmpMat4=R(),o.fontHash=o.calcFontHash(i),o}return n(o,r),o.prototype.calcFontHash=function(e){return e.parsedStyle.metrics.font+["fontSize","fontFamily","fontWeight","textBaseline","letterSpacing"].reduce((function(t,r){return t+e.parsedStyle[r]}),"")},o.prototype.shouldMerge=function(e,t){return!!r.prototype.shouldMerge.call(this,e,t)&&(this.index===t&&this.fontHash===this.calcFontHash(e))},o.prototype.createGeometry=function(r){var n=this,i=this.instance.parsedStyle,o=i.textBaseline,a=i.letterSpacing,s=24/i.fontSize,l=[],f=[],_=[],d=0;r.forEach((function(e){var r=e.parsedStyle,i=r.metrics,p=i.font,h=i.lines,E=i.height,R=i.lineHeight,T=r.dx||0,m=r.dy||0,A=0;"middle"===o?A=-E/2:"bottom"===o?A=-E:"top"===o||"hanging"===o?A=0:"alphabetic"===o?(A=.25*R-E,t.runtime.enableCSSParsing||(A=-E)):"ideographic"===o&&(A=-E);var S=n.glyphManager.getAtlas(),y=n.buildTextBuffers({object:e,lines:h,fontStack:p,lineHeight:s*R,offsetX:s*T,offsetY:s*(A+m),letterSpacing:s*a,glyphAtlas:S,indicesOffset:d}),v=y.indexBuffer,g=y.charUVOffsetBuffer;d=y.indicesOffset;var C=_.length;_.push.apply(_,c([],u(y.charPackedBuffer),!1)),n.packedBufferObjectMap.set(e,[C,_.length]),f.push.apply(f,c([],u(g),!1)),l.push.apply(l,c([],u(v),!1))})),this.geometry.vertexCount=l.length,this.geometry.setIndexBuffer(new Uint32Array(l)),this.geometry.setVertexBuffer({bufferIndex:mi.INSTANCED,byteStride:128,frequency:e.VertexBufferFrequency.PerVertex,attributes:[{format:e.Format.F32_RGBA,bufferByteOffset:0,location:e.VertexAttributeLocation.MODEL_MATRIX0},{format:e.Format.F32_RGBA,bufferByteOffset:16,location:e.VertexAttributeLocation.MODEL_MATRIX1},{format:e.Format.F32_RGBA,bufferByteOffset:32,location:e.VertexAttributeLocation.MODEL_MATRIX2},{format:e.Format.F32_RGBA,bufferByteOffset:48,location:e.VertexAttributeLocation.MODEL_MATRIX3},{format:e.Format.F32_RGBA,bufferByteOffset:64,location:e.VertexAttributeLocation.PACKED_COLOR},{format:e.Format.F32_RGBA,bufferByteOffset:80,location:e.VertexAttributeLocation.PACKED_STYLE1},{format:e.Format.F32_RGBA,bufferByteOffset:96,location:e.VertexAttributeLocation.PACKED_STYLE2},{format:e.Format.F32_RGBA,bufferByteOffset:112,location:e.VertexAttributeLocation.PICKING_COLOR}],data:new Float32Array(_)}),this.geometry.setVertexBuffer({bufferIndex:mi.TEX,byteStride:16,frequency:e.VertexBufferFrequency.PerVertex,attributes:[{format:e.Format.F32_RG,bufferByteOffset:0,location:Ai.TEX},{format:e.Format.F32_RG,bufferByteOffset:8,location:Ai.OFFSET}],data:new Float32Array(f)})},o.prototype.createMaterial=function(t){var r;this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = TEX) in vec2 a_Tex;\nlayout(location = OFFSET) in vec2 a_Offset;\n\nout vec2 v_Uv;\nout float v_GammaScale;\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  v_Uv = a_Tex / u_SDFMapSize;\n  float fontScale = u_FontSize / 24.;\n\n  bool isBillboard = a_StylePacked2.y > 0.5;\n  float sizeAttenuation = a_StylePacked2.z;\n  vec2 bufferOffset = vec2(0.7, 2.0);\n  vec2 offset = a_Offset * fontScale + bufferOffset;\n\n  if (isBillboard) {\n    vec4 mvPosition = u_ViewMatrix * u_ModelMatrix * vec4(0.0, 0.0, u_ZIndex, 1.0);\nvec2 scale;\nscale.x = length(vec3(u_ModelMatrix[0][0], u_ModelMatrix[0][1], u_ModelMatrix[0][2]));\nscale.y = length(vec3(u_ModelMatrix[1][0], u_ModelMatrix[1][1], u_ModelMatrix[1][2]));\n\n// if (sizeAttenuation < 0.5) {\n// bool isPerspective = isPerspectiveMatrix( u_ProjectionMatrix );\n// if ( isPerspective ) scale *= - mvPosition.z;\n// }\n\nvec2 alignedPosition = offset * scale;\n\nfloat rotation = 0.0;\nvec2 rotatedPosition;\nrotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\nrotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\nmvPosition.xy += rotatedPosition;\n\ngl_Position = u_ProjectionMatrix * mvPosition;\n    v_GammaScale = 1.0;\n  } else {\n    gl_Position = project(vec4((a_Offset) * fontScale + bufferOffset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    v_GammaScale = gl_Position.w;\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n\nuniform sampler2D u_SDFMap;\n\n#define SDF_PX 8.0\n\nin float v_GammaScale;\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  float dist = texture(SAMPLER_2D(u_SDFMap), v_Uv).a;\n\n  float EDGE_GAMMA = 0.105 / u_DevicePixelRatio;\n  float fontScale = u_FontSize / 24.0;\n  highp float gamma = EDGE_GAMMA / (fontScale * u_GammaScale);\n  lowp vec4 color = u_Color;\n  lowp float buff = (256.0 - 64.0) / 256.0;\n  float opacity = u_FillOpacity;\n  if (u_HasStroke > 0.5 && u_StrokeWidth > 0.0) {\n    color = u_StrokeColor;\n    gamma = (u_StrokeBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_GammaScale);\n    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;\n    opacity = u_StrokeOpacity;\n  }\n\n  highp float gamma_scaled = gamma * v_GammaScale;\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  opacity *= alpha * u_Opacity;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n\n    if (opacity < 0.001) {\n      discard;\n    }\n\n    outputColor = color;\n    outputColor.a *= opacity;\n  }\n}",this.material.cullMode=e.CullMode.Back,this.material.defines=i(i({},this.material.defines),Jr(Ai));var n=this.instance.parsedStyle,o=n.fontSize,a=n.fontFamily,s=void 0===a?"":a,l=n.fontWeight,u=void 0===l?"":l,c=n.fontStyle,f=n.metrics.font,_=t.map((function(e){return e.parsedStyle.text})).join("");this.glyphManager.generateAtlas(this.texturePool.context.config.offscreenCanvas,f,s,""+u,c,_,this.context.device);var d=this.glyphManager.getAtlasTexture(),p=this.glyphManager.getAtlas();this.context.device.setResourceName(d,"TextSDF Texture");var h=p.image,E=h.width,R=h.height;this.material.setUniforms(((r={})[e.TextUniform.SDF_MAP]=d,r[e.TextUniform.SDF_MAP_SIZE]=[E,R],r[e.TextUniform.FONT_SIZE]=o,r[e.TextUniform.GAMMA_SCALE]=1,r[e.TextUniform.STROKE_BLUR]=.2,r[e.TextUniform.HAS_STROKE]=this.index,r))},o.prototype.changeRenderOrder=function(t,r){for(var n=this.geometry.vertices[mi.INSTANCED],i=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[mi.INSTANCED].byteStride/4,o=u(this.packedBufferObjectMap.get(t),2),a=o[0],s=o[1],l=n.slice(a,s),c=0;s-a>c;c+=i)l[c+i-1]=r*Xr;this.geometry.updateVertexBuffer(mi.INSTANCED,e.VertexAttributeLocation.MODEL_MATRIX0,a/i,new Uint8Array(l.buffer))},o.prototype.updateAttribute=function(r,n,i,o){var a=this;if("text"===i||"fontFamily"===i||"fontSize"===i||"fontWeight"===i||"fontStyle"===i||"fontVariant"===i||"textBaseline"===i||"letterSpacing"===i||"wordWrapWidth"===i||"lineHeight"===i||"wordWrap"===i||"textAlign"===i||"dx"===i||"dy"===i)this.material.programDirty=!0,this.material.geometryDirty=!0,this.material.textureDirty=!0;else if("modelMatrix"===i||"fill"===i||"fillOpacity"===i||"stroke"===i||"strokeOpacity"===i||"opacity"===i||"lineWidth"===i||"visibility"===i||"pointerEvents"===i||"isBillboard"===i){var s=this.geometry.vertices[mi.INSTANCED],l=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[mi.INSTANCED].byteStride/4;r.forEach((function(r){var n,o=r.parsedStyle,c=o.fill,f=o.stroke,_=o.opacity,d=o.fillOpacity,p=o.strokeOpacity,h=o.lineWidth,E=o.visibility,R=o.isBillboard,m=o.sizeAttenuation,A=[0,0,0,0];t.isCSSRGB(c)&&(A=[Number(c.r),Number(c.g),Number(c.b),255*Number(c.alpha)]);var S=[0,0,0,0];t.isCSSRGB(f)&&(S=[Number(f.r),Number(f.g),Number(f.b),255*Number(f.alpha)]);for(var y=r.isInteractive()&&(null===(n=r.renderable3D)||void 0===n?void 0:n.encodedPickingColor)||[0,0,0],v=T(a.tmpMat4,r.getWorldTransform()),g=u(a.packedBufferObjectMap.get(r),2),C=g[0],F=g[1],I=s.slice(C,F),M=0;F-C>M;M+=l)"modelMatrix"===i?(I[M+0]=v[0],I[M+1]=v[1],I[M+2]=v[2],I[M+3]=v[3],I[M+4]=v[4],I[M+5]=v[5],I[M+6]=v[6],I[M+7]=v[7],I[M+8]=v[8],I[M+9]=v[9],I[M+10]=v[10],I[M+11]=v[11],I[M+12]=v[12],I[M+13]=v[13],I[M+14]=v[14],I[M+15]=v[15]):"fill"===i?(I[M+16]=en(A[0],A[1]),I[M+17]=en(A[2],A[3])):"stroke"===i&&(I[M+18]=en(S[0],S[1]),I[M+19]=en(S[2],S[3])),I[M+20]=_,I[M+21]=d,I[M+22]=p,I[M+23]=h,I[M+24]="visible"===E?1:0,I[M+25]=R?1:0,I[M+26]=m?1:0,I[M+27]=0,I[M+28]=y[0],I[M+29]=y[1],I[M+30]=y[2];a.geometry.updateVertexBuffer(mi.INSTANCED,e.VertexAttributeLocation.MODEL_MATRIX0,C/l,new Uint8Array(I.buffer))}))}},o.prototype.buildTextBuffers=function(e){var r,n=e.object,i=e.lines,o=e.fontStack,a=e.lineHeight,s=e.letterSpacing,l=e.offsetX,f=e.offsetY,_=e.glyphAtlas,d=e.indicesOffset,p=n.parsedStyle,h=p.textAlign,E=p.fill,R=p.stroke,m=p.opacity,A=p.fillOpacity,S=p.strokeOpacity,y=p.lineWidth,v=p.visibility,g=p.isBillboard,C=p.sizeAttenuation,F=[0,0,0,0];t.isCSSRGB(E)&&(F=[Number(E.r),Number(E.g),Number(E.b),255*Number(E.alpha)]);var I=[0,0,0,0];t.isCSSRGB(R)&&(I=[Number(R.r),Number(R.g),Number(R.b),255*Number(R.alpha)]);var M=n.isInteractive()&&(null===(r=n.renderable3D)||void 0===r?void 0:r.encodedPickingColor)||[0,0,0],O=T(this.tmpMat4,n.getWorldTransform()),P=[],N=[],x=[],B=d,D=function(e,t){for(var r=[],n=0;e.length>n;n++){var i=e[n],o=t[i.fontStack],a=o&&o[i.glyph];if(a){var s=a.rect;if(s){var l=a.metrics.advance*i.scale/2,u=[i.x+l,i.y],c=(a.metrics.left-4)*i.scale-l+u[0],f=(-a.metrics.top-4)*i.scale+u[1],_=c+s.w*i.scale,d=f+s.h*i.scale;r.push({tl:{x:c,y:f},tr:{x:_,y:f},bl:{x:c,y:d},br:{x:_,y:d},tex:s,glyphOffset:[0,0]})}}}return r}(this.glyphManager.layout(i,o,a,h,s,l,f),_.positions);return D.forEach((function(e){var t=[];t.push.apply(t,c([],u(O),!1));var r=c(c(c(c([],u(t),!1),[en(F[0],F[1]),en(F[2],F[3]),en(I[0],I[1]),en(I[2],I[3]),m,A,S,y,"visible"===v?1:0,g?1:0,C?1:0,0],!1),u(M),!1),[n.sortable.renderOrder*Xr],!1);P.push.apply(P,c(c(c(c([],u(r),!1),u(r),!1),u(r),!1),u(r),!1)),N.push(e.tex.x,e.tex.y,e.tl.x,e.tl.y),N.push(e.tex.x+e.tex.w,e.tex.y,e.tr.x,e.tr.y),N.push(e.tex.x+e.tex.w,e.tex.y+e.tex.h,e.br.x,e.br.y),N.push(e.tex.x,e.tex.y+e.tex.h,e.bl.x,e.bl.y),x.push(0+B,2+B,1+B),x.push(2+B,0+B,3+B),B+=4})),{indexBuffer:x,charUVOffsetBuffer:N,charPackedBuffer:P,indicesOffset:B}},o}(ln),gi=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.lightReceived=!0,t}return n(r,e),r.prototype.shouldMerge=function(r,n){return!!e.prototype.shouldMerge.call(this,r,n)&&(this.instance.nodeName!==t.Shape.MESH||this.instance.parsedStyle.material===r.parsedStyle.material&&this.instance.parsedStyle.geometry===r.parsedStyle.geometry)},r.prototype.updateAttribute=function(t,r,n,i){e.prototype.updateAttribute.call(this,t,r,n,i),this.updateBatchedAttribute(t,r,n,i)},r.prototype.createMaterial=function(e){this.material=this.instance.parsedStyle.material,this.observeMaterialChanged()},r.prototype.createGeometry=function(t){this.geometry=this.instance.parsedStyle.geometry,e.prototype.createGeometry.call(this,t),this.geometry.build(t),this.observeGeometryChanged()},r}(ln),Ci=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meshes=[_n,li],t}return n(t,e),t.prototype.shouldSubmitRenderInst=function(e,t){if(0===t&&e.parsedStyle.fill.isNone)return!1;return 1!==t||this.needDrawStrokeSeparately(e)},t.prototype.needDrawStrokeSeparately=function(e){var t=e.parsedStyle,r=t.fill,n=t.stroke,i=t.lineDash,o=t.lineWidth,a=t.strokeOpacity,s=r&&!r.isNone,l=n&&!n.isNone,u=i&&i.length&&i.every((function(e){return 0!==e}));return!s||l&&o>0&&(1>a||u)},t}(Hr),Fi=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.meshes=[di,hn,li],t}return n(r,e),r.prototype.shouldSubmitRenderInst=function(e,r){var n=e.parsedStyle,i=n.fill,o=n.stroke,a=n.opacity,s=n.strokeOpacity,l=n.lineWidth,u=o&&!o.isNone,c=hn.isLine(e);return e.renderable.proxyNodeName=c?t.Shape.LINE:null,(0!==r||e.nodeName!==t.Shape.POLYLINE&&!i.isNone)&&(1===r?c:2!==r||!(c||0===s||0===a||0===l||!u))},r}(Hr);!function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meshes=[],t}n(t,e),t.prototype.shouldSubmitRenderInst=function(e,t){return!0}}(Hr);var Ii,Mi,Oi,Pi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meshes=[pi],t}return n(t,e),t.prototype.shouldSubmitRenderInst=function(e,t){return!0},t}(Hr),Ni=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.meshes=[vi,vi],e}return n(r,t),r.prototype.shouldSubmitRenderInst=function(e,t){var r=e.parsedStyle,n=r.stroke;return!((!n||n.isNone||!r.lineWidth)&&0===t)},r.prototype.beforeUploadUBO=function(t,r,n){var i;r.material.setUniforms(((i={})[e.TextUniform.HAS_STROKE]=1-r.index,i))},r}(Hr),xi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meshes=[hn],t}return n(t,e),t.prototype.shouldSubmitRenderInst=function(e,t){return!0},t}(Hr),Bi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meshes=[gi],t}return n(t,e),t}(Hr),Di=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meshes=[_n,di,li],t}return n(t,e),t.prototype.shouldSubmitRenderInst=function(e,t){var r=e.parsedStyle.radius,n=r&&r.length&&r.some((function(e){return e!==r[0]}));if(0===t&&(e.parsedStyle.fill.isNone||n))return!1;return 1===t?n:2!==t||(n||this.needDrawStrokeSeparately(e))},t.prototype.needDrawStrokeSeparately=function(e){var t=e.parsedStyle,r=t.fill,n=t.stroke,i=t.lineDash,o=t.lineWidth,a=t.strokeOpacity,s=r&&!r.isNone,l=n&&!n.isNone,u=i&&i.length&&i.every((function(e){return 0!==e}));return!s||l&&o>0&&(1>a||u)},t}(Hr),Li=1,bi=function(){function e(e,t,r,n){this.renderHelper=e,this.rendererFactory=t,this.texturePool=r,this.lightPool=n,this.meshes=[],this.pendingUpdatePatches={},this.stencilRefCache={}}return e.prototype.render=function(e,t){var r=this;void 0===t&&(t=!1),t||this.updatePendingPatches(),this.meshes.forEach((function(n){n.init(r.context);var i=n.objects;n.clipPathTarget&&(i=[n.clipPath]);var o=r.renderHelper.renderInstManager.newRenderInst();o.setAllowSkippingIfPipelineNotReady(!1),n.applyRenderInst(o,i),r.renderHelper.renderInstManager.submitRenderInst(o,e),t||n.objects.forEach((function(e){e.renderable.dirty=!1}))}))},e.prototype.attach=function(e){this.context=e},e.prototype.add=function(e){var t=this,r=e.renderable3D;if(r&&!r.meshes.length){var n=this.rendererFactory[e.nodeName];n&&n.meshes.forEach((function(i,o){if(r.meshes[o]=void 0,n.shouldSubmitRenderInst(e,o)){var a=t.meshes.find((function(t){return i===t.constructor&&t.index===o&&t.maxInstances>t.objects.length&&t.shouldMerge(e,o)}));a&&a.key===e.parsedStyle.batchKey||((a=new i(t.renderHelper,t.texturePool,t.lightPool,e)).renderer=n,a.index=o,t.meshes.push(a),e.parsedStyle.batchKey&&(a.key=e.parsedStyle.batchKey)),a&&(a.objects.push(e),r.meshes[o]=a,a.geometryDirty=!0)}}))}},e.prototype.remove=function(e){var t=this,r=e.renderable3D;r&&(r.meshes.forEach((function(r){if(r){var n=r.objects.indexOf(e);n>-1&&(r.objects.splice(n,1),r.geometryDirty=!0),0===r.objects.length&&t.meshes.splice(t.meshes.indexOf(r),1)}})),r.meshes=[])},e.prototype.updateAttribute=function(e,t,r,n){var i=this;void 0===n&&(n=!1);var o=e.renderable3D,a=this.rendererFactory[e.nodeName];a&&a.meshes.forEach((function(s,l){var u=a.shouldSubmitRenderInst(e,l),c=o.meshes.find((function(e){return e&&e.index===l&&e.constructor===s}));if(u!==!!c&&(c&&(c.objects.splice(c.objects.indexOf(e),1),c.geometryDirty=!0,0===c.objects.length&&i.meshes.splice(i.meshes.indexOf(c),1),o.meshes[o.meshes.indexOf(c)]=void 0),u&&((c=i.meshes.find((function(t){return s===t.constructor&&t.index===l&&t.maxInstances>t.objects.length&&t.shouldMerge(e,l)})))?c.geometryDirty=!0:((c=new s(i.renderHelper,i.texturePool,i.lightPool,e)).renderer=a,c.index=l,c.init(i.context),i.meshes.push(c)),c&&(c.objects.push(e),o.meshes[l]=c))),u&&c)if(c.inited&&!c.geometryDirty)if(c.shouldMerge(e,l)){var f=c.objects.indexOf(e);if(n)e.parsedStyle[t]=r,c.updateAttribute([e],f,t,r);else{var _=c.id+t;i.pendingUpdatePatches[_]||(i.pendingUpdatePatches[_]={instance:c,objectIndices:[],name:t,value:r}),-1===i.pendingUpdatePatches[_].objectIndices.indexOf(f)&&i.pendingUpdatePatches[_].objectIndices.push(f)}}else i.remove(e),i.add(e);else i.remove(e),i.add(e)}))},e.prototype.changeRenderOrder=function(e,t){var r=e.renderable3D;r&&r.meshes.length&&r.meshes.forEach((function(r){r&&r.inited&&!r.geometryDirty&&(r.renderer.shouldSubmitRenderInst(e,r.index)&&r.inited&&r.changeRenderOrder(e,t))}))},e.prototype.getStencilRef=function(e){return this.stencilRefCache[e.entity]||(this.stencilRefCache[e.entity]=Li++),this.stencilRefCache[e.entity]},e.prototype.updatePendingPatches=function(){var e=this;Object.keys(this.pendingUpdatePatches).forEach((function(t){var r=e.pendingUpdatePatches[t],n=r.instance,i=r.objectIndices,o=r.name,a=r.value;i.sort((function(e,t){return e-t}));var s=[];i.forEach((function(e){var t=s[s.length-1];t&&e===t[t.length-1]+1?t.push(e):s.push([e])})),s.forEach((function(e){n.updateAttribute(n.objects.slice(e[0],e[0]+e.length),e[0],o,a)}))})),this.pendingUpdatePatches={}},e}(),Ui=function(){function r(e){this.context=e,this.textureCache={}}return r.prototype.getOrCreateTexture=function(r,n,o,a){var s,l=this,u="string"==typeof n?n:n.src||"";if(u&&this.textureCache[u])(s=this.textureCache[u]).emit(e.TextureEvent.LOADED);else if(s=r.createTexture(i({pixelFormat:e.Format.U8_RGBA_NORM,width:1,height:1,depth:1,numLevels:1,dimension:e.TextureDimension.n2D,usage:e.TextureUsage.Sampled,pixelStore:{unpackFlipY:!1},immutable:!1},o)),u&&(this.textureCache[u]=s),te(n)){var c,f=this.context.config.createImage;f?c=f(n):t.isBrowser&&(c=new window.Image),c&&(c.onload=function(){var r=function(t){l.textureCache[u].setImageData(t),l.textureCache[u].emit(e.TextureEvent.LOADED),l.context.renderingService.dirtify(),a&&a(l.textureCache[u])};t.runtime.globalThis.createImageBitmap?t.runtime.globalThis.createImageBitmap(c).then((function(e){return r(e)})).catch((function(){r(c)})):r(c)},c.onerror=function(){},c.crossOrigin="Anonymous",c.src=n)}else s.setImageData(n),s.emit(e.TextureEvent.LOADED),this.context.renderingService.dirtify();return s},r.prototype.getOrCreateCanvas=function(){return t.runtime.offscreenCanvasCreator.getOrCreateCanvas(this.context.config.offscreenCanvas)},r.prototype.getOrCreateGradient=function(e){var r=e.gradients,n=e.instance.getGeometryBounds().halfExtents,o=2*n[0]||1,a=2*n[1]||1,s=this.context.config.offscreenCanvas,l=t.runtime.offscreenCanvasCreator.getOrCreateCanvas(s),u=t.runtime.offscreenCanvasCreator.getOrCreateContext(s);l.width=o,l.height=a;var c=this.context.imagePool;r.forEach((function(e){var t=c.getOrCreateGradient(i(i({type:e.type},e.value),{width:o,height:a}),u);u.fillStyle=t,u.fillRect(0,0,o,a)}))},r.prototype.getOrCreatePattern=function(e,r,n){var i,o=e.image,a=e.repetition,s=e.transform,l=r.getGeometryBounds().halfExtents,u=2*l[0]||1,c=2*l[1]||1,f=this.context.config.offscreenCanvas,_=t.runtime.offscreenCanvasCreator.getOrCreateCanvas(f),d=t.runtime.offscreenCanvasCreator.getOrCreateContext(f);_.width=u,_.height=c;var p=(i=te(o)?this.context.imagePool.getImageSync(o,n):o)&&d.createPattern(i,a);if(s){var h=t.parsedTransformToMat4(t.parseTransform(s),new t.DisplayObject({}));p.setTransform({a:h[0],b:h[1],c:h[4],d:h[5],e:h[12],f:h[13]})}d.fillStyle=p,d.fillRect(0,0,u,c)},r.prototype.destroy=function(){for(var e in this.textureCache)this.textureCache[e].destroy();this.textureCache={}},r}(),Gi="#define GLSLIFY 1\nlayout(location = 0) in vec2 a_Position;\n\nout vec2 v_TexCoord;\n\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}",ki=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vert=Gi,t.frag="#define GLSLIFY 1\nuniform sampler2D u_Texture;\nin vec2 v_TexCoord;\n\nout vec4 outputColor;\n\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}",t.features={},t}return n(t,e),t}(Gt),wi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.features={},t.both="\nlayout(std140) uniform ub_Params {\n    vec4 u_Misc[1];\n};\n#define u_InvResolution (u_Misc[0].xy)\n",t.vert=Gi,t.frag="#define GLSLIFY 1\nuniform sampler2D u_Texture;\nin vec2 v_TexCoord;\n\nout vec4 outputColor;\n\nfloat MonochromeNTSC(vec3 t_Color) {\n  // NTSC primaries.\n  return dot(t_Color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nvec4 FXAA(PD_SAMPLER_2D(t_Texture), in vec2 t_PixelCenter, in vec2 t_InvResolution) {\n  // FXAA v2, based on implementations:\n  // http://www.geeks3d.com/20110405/fxaa-fast-approximate-anti-aliasing-demo-glsl-opengl-test-radeon-geforce/\n  // https://github.com/mitsuhiko/webgl-meincraft\n\n  float lumaMM = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy).rgb);\n\n  #if 1\n    vec2 t_PixelTopLeft = t_PixelCenter.xy - t_InvResolution.xy * 0.5;\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy)             .rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 0.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(0.0, 1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 1.0)).rgb);\n  #else\n    // We're at the pixel center -- pixel edges are 0.5 units away.\n    // NOTE(jstpierre): mitsuhiko's port seems to get this wrong?\n    vec2 t_PixelSize = t_InvResolution.xy * 0.5;\n\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0, -1.0)).rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0, -1.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0,  1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0,  1.0)).rgb);\n  #endif\n\n  vec2 dir; \n  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n  dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n  const float FXAA_REDUCE_MIN = 1.0/128.0;\n  const float FXAA_REDUCE_MUL = 1.0/8.0;\n  const float FXAA_SPAN_MAX = 8.0;\n\n  float dirReduce = max(\n      (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n      FXAA_REDUCE_MIN);\n\n  float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n  dir = min(vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_InvResolution.xy;\n\n  float lumaMin = min(lumaMM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n  float lumaMax = max(lumaMM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n  vec4 rgbA = (1.0/2.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (1.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (2.0/3.0 - 0.5)));\n  vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (0.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (3.0/3.0 - 0.5)));\n  float lumaB = MonochromeNTSC(rgbB.rgb);\n\n  vec4 rgbOutput = ((lumaB < lumaMin) || (lumaB > lumaMax)) ? rgbA : rgbB;\n  return rgbOutput;\n}\n\nvoid main() {\n  outputColor = FXAA(PP_SAMPLER_2D(u_Texture), v_TexCoord.xy, u_InvResolution.xy);\n}",t}return n(t,e),t}(Gt),Vi=Pe(1,(function(){return new br}));var Wi=function(r){function o(){var t=null!==r&&r.apply(this,arguments)||this;return t.name="device-renderer",t.parameters={toneMapping:e.ToneMapping.NONE,toneMappingExposure:1},t}return n(o,r),o.prototype.init=function(e){var r;e.geometryUpdaterFactory[t.Shape.MESH]=new p;var n=new Fr(this.parameters),i=new _,o=new Ui(this.context),a=new h,s=new Ci,l=new Fi,u=((r={})[t.Shape.CIRCLE]=s,r[t.Shape.ELLIPSE]=s,r[t.Shape.POLYLINE]=l,r[t.Shape.PATH]=l,r[t.Shape.POLYGON]=l,r[t.Shape.RECT]=new Di,r[t.Shape.IMAGE]=new Pi,r[t.Shape.LINE]=new xi,r[t.Shape.TEXT]=new Ni,r[t.Shape.MESH]=new Bi,r[t.Shape.GROUP]=void 0,r[t.Shape.HTML]=void 0,r),c=new bi(n,u,o,i),f=new Vr(n,i,o,c);this.addRenderingPlugin(f),this.addRenderingPlugin(new Wr(n,f,a,c))},o.prototype.destroy=function(e){delete e.geometryUpdaterFactory[t.Shape.MESH]},o.prototype.getRenderGraphPlugin=function(){return this.plugins[0]},o.prototype.getDevice=function(){return this.getRenderGraphPlugin().getDevice()},o.prototype.loadTexture=function(e,t,r){return this.getRenderGraphPlugin().loadTexture(e,t,r)},o.prototype.toDataURL=function(e){return this.getRenderGraphPlugin().toDataURL(e)},o.prototype.setParameters=function(e){this.parameters=i(i({},this.parameters),e)},o}(t.AbstractRendererPlugin);e.Batch=Hr,e.BufferGeometry=jr,e.CopyProgram=ki,e.DeviceProgram=Gt,e.DynamicUniformBuffer=kt,e.FILL_TEXTURE_MAPPING=on,e.Fog=wr,e.HashMap=Ht,e.ImageMesh=pi,e.Instanced=ln,e.InstancedFillMesh=di,e.InstancedLineMesh=hn,e.InstancedPathMesh=li,e.IsDepthReversed=Se,e.Light=Gr,e.Material=Zr,e.Mesh=d,e.MeshMesh=gi,e.OpaqueBlack=Te,e.OpaqueWhite=Ae,e.Plugin=Wi,e.RenderCache=er,e.RenderGraphPlugin=Vr,e.RenderHelper=Fr,e.RenderInst=Sr,e.RenderInstList=vr,e.RenderInstManager=Cr,e.Renderable3D=f,e.SDFMesh=_n,e.ShaderMaterial=qr,e.SingleSampledTexture=ir,e.TemporalTexture=Ur,e.TextMesh=vi,e.TextureMapping=br,e.TexturePool=Ui,e.TinySDF=ii,e.TransparentBlack=Re,e.TransparentWhite=me,e.UNIFORM_SETTERS=Nt,e.align=function(e,t){var r=t-1;return e+r&~r},e.alignNonPowerOfTwo=Fe,e.arrayCopy=Ke,e.arrayEqual=Ye,e.assert=fe,e.assertExists=_e,e.bezierCurveTo=ei,e.bindingLayoutDescriptorCopy=ct,e.bindingLayoutDescriptorEqual=function(e,t){return e.numSamplers===t.numSamplers&&(e.numUniformBuffers===t.numUniformBuffers&&(void 0===e.samplerEntries==(void 0===t.samplerEntries)&&!(void 0!==e.samplerEntries&&!Ye(e.samplerEntries,t.samplerEntries,je))))},e.bindingLayoutSamplerDescriptorCopy=ut,e.bindingsDescriptorCopy=lt,e.bindingsDescriptorEquals=qe,e.bisectRight=Ie,e.bufferBindingCopy=st,e.colorCopy=pe,e.colorEqual=de,e.colorNewCopy=he,e.colorNewFromRGBA=Ee,e.compareDefines=Qr,e.compareDepthValues=function(t,r,n,i){if(void 0===i&&(i=Se),(n=ye(n,i))===e.CompareMode.Less)return r>t;if(n===e.CompareMode.LessEqual)return r>=t;if(n===e.CompareMode.Greater)return t>r;if(n===e.CompareMode.GreaterEqual)return t>=r;throw Error("whoops")},e.copyAttachmentState=Be,e.copyAttachmentStateFromSimple=Ue,e.copyMegaState=be,e.defaultBindingLayoutSamplerDescriptor=He,e.defaultMegaState=ke,e.definedProps=$r,e.enumToObject=Jr,e.fallbackUndefined=ve,e.fillArray=Ce,e.fillColor=function(e,t,r,n){return void 0===n&&(n=r.a),e[t+0]=r.r,e[t+1]=r.g,e[t+2]=r.b,e[t+3]=n,4},e.fillMatrix4x4=function(e,t,r){return e[t+0]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],16},e.fillVec3v=function(e,t,r,n){return void 0===n&&(n=0),e[t+0]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=n,4},e.fillVec4=mr,e.fillVec4v=function(e,t,r){return e[t+0]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],4},e.fullscreenMegaState=Ve,e.getAttributeLocations=function(e,t){var r=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(e,n,i){var o=Number(n);return r.push({location:isNaN(o)?t[n]:o,name:i}),""})),r},e.getDefines=function(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(e,r,n){var i=Number(n);return t[r]=isNaN(i)?n:i,""})),t},e.getFormatByteSize=function(e){return ce(le(e))*se(e)},e.getFormatCompByteSize=function(e){return ce(le(e))},e.getFormatCompFlags=se,e.getFormatCompFlagsComponentCount=oe,e.getFormatComponentCount=function(e){return se(e)},e.getFormatFlags=ue,e.getFormatSamplerKind=function(t){var r=ue(t);if(r&e.FormatFlags.Depth)return e.SamplerFormatKind.Depth;if(r&e.FormatFlags.Normalized)return e.SamplerFormatKind.Float;var n=le(t);if(n===e.FormatTypeFlags.F16||n===e.FormatTypeFlags.F32)return e.SamplerFormatKind.Float;if(n===e.FormatTypeFlags.U8||n===e.FormatTypeFlags.U16||n===e.FormatTypeFlags.U32)return e.SamplerFormatKind.Uint;if(n===e.FormatTypeFlags.S8||n===e.FormatTypeFlags.S16||n===e.FormatTypeFlags.S32)return e.SamplerFormatKind.Sint;throw Error("whoops")},e.getFormatTypeFlags=le,e.getFormatTypeFlagsByteSize=ce,e.getSortKeyDepth=function(e){return!!(e>>>31&1)?e>>>8&65535:e>>>8&65532|3&e},e.getSortKeyLayer=function(e){return e>>>24&255},e.getSystemEndianness=function(){return Rt},e.getUniformSetter=function(e,t,r){var n=Nt[r.type];if(!n)throw Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,e,t)},e.getUniforms=Dt,e.hashCodeNumberFinish=Vt,e.hashCodeNumberUpdate=wt,e.inputLayoutBufferDescriptorCopy=dt,e.inputLayoutBufferDescriptorEquals=nt,e.inputLayoutDescriptorCopy=pt,e.inputLayoutDescriptorEquals=it,e.isPowerOfTwo=function(e){return e&&0==(e&e-1)},e.leftPad=Ne,e.makeAttachmentClearDescriptor=Mr,e.makeBackbufferDescSimple=Dr,e.makeDataBuffer=zr,e.makeDepthKey=ur,e.makeFormat=ae,e.makeMegaState=we,e.makeSortKey=function(t,r){return void 0===r&&(r=0),t&e.RendererLayer.TRANSLUCENT?pr(t):_r(t,r)},e.makeSortKeyOpaque=_r,e.makeSortKeyTranslucent=pr,e.makeTextureDescriptor2D=ie,e.nArray=Pe,e.nullHashFunc=Wt,e.nullify=ge,e.opaqueBlackFullClearRenderPassDescriptor=Nr,e.opaqueWhiteFullClearRenderPassDescriptor=xr,e.parseUniformName=function(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(Tt);if(!t||2>t.length)throw Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:!!t[2]}},e.prependLineNo=function(e,t){return void 0===t&&(t=1),e.split("\n").map((function(e,r){return"".concat(Ne(""+(t+r),4," "),"  ").concat(e)})).join("\n")},e.preprocessProgramObj_GLSL=Ut,e.preprocessProgram_GLSL=bt,e.preprocessShader_GLSL=Lt,e.projectionMatrixConvertClipSpaceNearZ=function(t,r,n){r!==n&&(r===e.ClipSpaceNearZ.NegativeOne?function(e){y(e,Er,e)}(t):r===e.ClipSpaceNearZ.Zero&&function(e){y(e,Tr,e)}(t))},e.pushFXAAPass=function(t,r,n,i){t.pushPass((function(o){o.setDebugName("FXAA"),o.attachRenderTargetID(e.RGAttachmentSlot.Color0,i);var a=t.resolveRenderTarget(i);o.attachResolveTexture(a);var s=r.renderInstManager.newRenderInst();s.setUniformBuffer(r.uniformBuffer),s.setAllowSkippingIfPipelineNotReady(!1),s.setMegaStateFlags(Ve),s.setBindingLayouts([{numUniformBuffers:1,numSamplers:1}]),s.drawPrimitives(3);var l=s.allocateUniformBuffer(0,4);mr(s.mapUniformBufferF32(0),l,1/n.backbufferWidth,1/n.backbufferHeight);var u=new wi,c=r.renderCache.createProgram(u);s.setProgram(c),Ii||((Ii=new jr(r.getDevice())).setVertexBuffer({bufferIndex:0,byteStride:8,frequency:e.VertexBufferFrequency.PerVertex,attributes:[{format:e.Format.F32_RG,bufferByteOffset:0,location:0}],data:new Float32Array([-1,-3,-1,1,3,-1])}),Ii.vertexCount=3,Oi=r.getCache().createInputLayout(Ii.inputLayoutDescriptor),Mi=r.getDevice().createInputState(Oi,Ii.vertexBuffers.map((function(e){return{buffer:e,byteOffset:0}})),null,c)),o.exec((function(e,t){Vi[0].texture=t.getResolveTextureForID(a),s.setSamplerBindingsFromTextureMappings(Vi),s.setInputLayoutAndState(Oi,Mi),s.drawOnPass(r.renderCache,e)}))}))},e.quadCurveTo=$n,e.range=function(e,t){for(var r=[],n=e;e+t>n;n++)r.push(n);return r},e.renderInstCompareNone=null,e.renderInstCompareSortKey=yr,e.renderPipelineDescriptorCopy=ft,e.renderPipelineDescriptorEquals=tt,e.reverseDepthForClearValue=function(e,t){return void 0===t&&(t=Se),t?1-e:e},e.reverseDepthForCompareMode=ye,e.reverseDepthForDepthOffset=function(e,t){return void 0===t&&(t=Se),t?-e:e},e.reverseDepthForOrthographicProjectionMatrix=function(e,t){void 0===t&&(t=Se),t&&(e[10]=-e[10],e[14]=1-e[14])},e.reverseDepthForPerspectiveProjectionMatrix=function(e,t){void 0===t&&(t=Se),t&&(e[10]=-e[10],e[14]=-e[14])},e.samplerBindingCopy=at,e.samplerBindingNew=function(){return{sampler:null,texture:null,lateBinding:null}},e.samplerDescriptorEquals=ot,e.segmentInstanceGeometry=dn,e.setAttachmentStateSimple=We,e.setBackbufferDescSimple=Br,e.setBitFlagEnabled=Oe,e.setFormatComponentCount=function(e,t){return 4294902015&e|t<<8},e.setFormatFlags=function(e,t){return 4294967040&e|t},e.setMegaStateFlags=Le,e.setSortKeyBias=function(e,t){return!!(e>>>31&1)?(4294967040&e|255&t)>>>0:e},e.setSortKeyDepth=function(e,t,r){void 0===r&&(r=sr);var n=!!(e>>>31&1),i=ur(t,n,r);return n?hr(e,i):dr(e,i)},e.setSortKeyDepthKey=function(e,t){return!!(e>>>31&1)?hr(e,t):dr(e,t)},e.setSortKeyLayer=cr,e.setSortKeyOpaqueDepth=dr,e.setSortKeyProgramKey=fr,e.setSortKeyTranslucentDepth=hr,e.spliceBisectRight=Me,e.standardFullClearRenderPassDescriptor=Pr,e.updateBuffer=fi,e.vertexAttributeDescriptorCopy=_t,e.vertexAttributeDescriptorEquals=rt}));
//# sourceMappingURL=index.umd.min.js.map
