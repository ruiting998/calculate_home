!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/g-lite")):"function"==typeof define&&define.amd?define(["exports","@antv/g-lite"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).G=t.G||{},t.G.MobileCanvas2D={}),t.window.G)}(this,(function(t,e){"use strict";var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var i=function(){return i=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i.apply(this,arguments)};function a(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}))}function o(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&i[3]>s[1])){o.label=s[1];break}if(6===s[0]&&i[1]>o.label){o.label=i[1],i=s;break}if(i&&i[2]>o.label){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function c(t,e,n){if(n||2===arguments.length)for(var r,i=0,a=e.length;a>i;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}var l="undefined"!=typeof Float32Array?Float32Array:Array;function h(){var t=new l(16);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function d(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=e[9],p=e[10],f=e[11],v=e[12],g=e[13],y=e[14],m=e[15],M=n[0],x=n[1],b=n[2],P=n[3];return t[0]=M*r+x*s+b*u+P*v,t[1]=M*i+x*c+b*d+P*g,t[2]=M*a+x*l+b*p+P*y,t[3]=M*o+x*h+b*f+P*m,t[4]=(M=n[4])*r+(x=n[5])*s+(b=n[6])*u+(P=n[7])*v,t[5]=M*i+x*c+b*d+P*g,t[6]=M*a+x*l+b*p+P*y,t[7]=M*o+x*h+b*f+P*m,t[8]=(M=n[8])*r+(x=n[9])*s+(b=n[10])*u+(P=n[11])*v,t[9]=M*i+x*c+b*d+P*g,t[10]=M*a+x*l+b*p+P*y,t[11]=M*o+x*h+b*f+P*m,t[12]=(M=n[12])*r+(x=n[13])*s+(b=n[14])*u+(P=n[15])*v,t[13]=M*i+x*c+b*d+P*g,t[14]=M*a+x*l+b*p+P*y,t[15]=M*o+x*h+b*f+P*m,t}function p(t,e,n){var r,i,a,o,s,c,l,h,u,d,p,f,v=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*v+e[4]*g+e[8]*y+e[12],t[13]=e[1]*v+e[5]*g+e[9]*y+e[13],t[14]=e[2]*v+e[6]*g+e[10]*y+e[14],t[15]=e[3]*v+e[7]*g+e[11]*y+e[15]):(i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=e[9],p=e[10],f=e[11],t[0]=r=e[0],t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=c,t[6]=l,t[7]=h,t[8]=u,t[9]=d,t[10]=p,t[11]=f,t[12]=r*v+s*g+u*y+e[12],t[13]=i*v+c*g+d*y+e[13],t[14]=a*v+l*g+p*y+e[14],t[15]=o*v+h*g+f*y+e[15]),t}function f(){var t=new l(3);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function v(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function g(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/(o=o||1),t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function y(t,e,n){return{x:t*Math.cos(n)-e*Math.sin(n),y:t*Math.sin(n)+e*Math.cos(n)}}function m(t,e,n,r,i,a,o,s,c,l){var h,u,d,p,f,v=t,g=e,M=n,x=r,b=s,P=c,S=120*Math.PI/180,E=Math.PI/180*(+i||0),T=[];if(l)u=l[0],d=l[1],p=l[2],f=l[3];else{g=(h=y(v,g,-E)).y;var C=((v=h.x)-(b=(h=y(b,P,-E)).x))/2,w=(g-(P=h.y))/2,A=C*C/(M*M)+w*w/(x*x);A>1&&(M*=A=Math.sqrt(A),x*=A);var O=M*M,k=x*x,R=(a===o?-1:1)*Math.sqrt(Math.abs((O*k-O*w*w-k*C*C)/(O*w*w+k*C*C)));p=R*M*w/x+(v+b)/2,u=Math.asin(((g-(f=R*-x*C/M+(g+P)/2))/x*1e9>>0)/1e9),d=Math.asin(((P-f)/x*1e9>>0)/1e9),0>(u=p>v?Math.PI-u:u)&&(u=2*Math.PI+u),0>(d=p>b?Math.PI-d:d)&&(d=2*Math.PI+d),o&&u>d&&(u-=2*Math.PI),!o&&d>u&&(d-=2*Math.PI)}var L=d-u;if(Math.abs(L)>S){var D=d,I=b,B=P;T=m(b=p+M*Math.cos(d=u+S*(o&&d>u?1:-1)),P=f+x*Math.sin(d),M,x,i,0,o,I,B,[d,D,p,f])}L=d-u;var N=Math.cos(u),F=Math.sin(u),G=Math.cos(d),j=Math.sin(d),Y=Math.tan(L/4),W=4/3*M*Y,X=4/3*x*Y,H=[v,g],_=[v+W*F,g-X*N],U=[b+W*j,P-X*G],q=[b,P];if(_[0]=2*H[0]-_[0],_[1]=2*H[1]-_[1],l)return _.concat(U,q,T);for(var Q=[],z=0,$=(T=_.concat(U,q,T)).length;$>z;z+=1)Q[z]=z%2?y(T[z-1],T[z],E).y:y(T[z],T[z+1],E).x;return Q}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),f(),function(){var t,e=(t=new l(2),l!=Float32Array&&(t[0]=0,t[1]=0),t)}();var M=function(t){return null==t},x={}.toString,b=function(t,e){return x.call(t)==="[object "+e+"]"},P=function(t){return b(t,"String")},S=function(t,e,n){return e>t?e:t>n?n:t};function E(t,e){var n=e.r;t.arc(n,n,n,0,2*Math.PI,!1)}function T(t,e){var n=e.rx,r=e.ry;if(t.ellipse)t.ellipse(n,r,n,r,0,0,2*Math.PI,!1);else{var i=n>r?n:r,a=n>r?1:n/r,o=n>r?r/n:1;t.save(),t.scale(a,o),t.arc(0,0,i,0,2*Math.PI)}}function C(t,n){var r=n.x1,i=n.y1,a=n.x2,o=n.y2,s=n.defX,c=void 0===s?0:s,l=n.defY,h=void 0===l?0:l,u=n.markerStart,d=n.markerEnd,p=n.markerStartOffset,f=n.markerEndOffset,v=0,g=0,y=0,m=0,M=0;u&&e.isDisplayObject(u)&&p&&(v=Math.cos(M=Math.atan2(o-i,a-r))*(p||0),g=Math.sin(M)*(p||0)),d&&e.isDisplayObject(d)&&f&&(y=Math.cos(M=Math.atan2(i-o,r-a))*(f||0),m=Math.sin(M)*(f||0)),t.moveTo(r-c+v,i-h+g),t.lineTo(a-c+y,o-h+m)}function w(t,n){var r=n.defX,i=void 0===r?0:r,a=n.defY,o=void 0===a?0:a,c=n.markerStart,l=n.markerEnd,h=n.markerStartOffset,u=n.markerEndOffset,d=n.path,p=d.absolutePath,f=d.segments,v=0,g=0,y=0,m=0,M=0;if(c&&e.isDisplayObject(c)&&h){var x=s(c.parentNode.getStartTangent(),2);v=Math.cos(M=Math.atan2((b=x[0])[1]-(P=x[1])[1],b[0]-P[0]))*(h||0),g=Math.sin(M)*(h||0)}if(l&&e.isDisplayObject(l)&&u){var b,P,S=s(l.parentNode.getEndTangent(),2);y=Math.cos(M=Math.atan2((b=S[0])[1]-(P=S[1])[1],b[0]-P[0]))*(u||0),m=Math.sin(M)*(u||0)}for(var E=0;p.length>E;E++){var T=p[E],C=p[E+1],w=0===E&&(0!==v||0!==g),A=(E===p.length-1||C&&("M"===C[0]||"Z"===C[0]))&&0!==y&&0!==m;switch(T[0]){case"M":w?(t.moveTo(T[1]-i+v,T[2]-o+g),t.lineTo(T[1]-i,T[2]-o)):t.moveTo(T[1]-i,T[2]-o);break;case"L":A?t.lineTo(T[1]-i+y,T[2]-o+m):t.lineTo(T[1]-i,T[2]-o);break;case"Q":t.quadraticCurveTo(T[1]-i,T[2]-o,T[3]-i,T[4]-o),A&&t.lineTo(T[3]-i+y,T[4]-o+m);break;case"C":t.bezierCurveTo(T[1]-i,T[2]-o,T[3]-i,T[4]-o,T[5]-i,T[6]-o),A&&t.lineTo(T[5]-i+y,T[6]-o+m);break;case"A":var O=f[E].arcParams,k=O.cx,R=O.cy,L=O.rx,D=O.ry,I=O.startAngle,B=O.endAngle,N=O.xRotation,F=O.sweepFlag;if(t.ellipse)t.ellipse(k-i,R-o,L,D,N,I,B,!!(1-F));else{var G=L>D?L:D,j=L>D?1:L/D,Y=L>D?D/L:1;t.translate(k-i,R-o),t.rotate(N),t.scale(j,Y),t.arc(0,0,G,I,B,!!(1-F)),t.scale(1/j,1/Y),t.rotate(-N),t.translate(-(k-i),-(R-o))}A&&t.lineTo(T[6]-i+y,T[7]-o+m);break;case"Z":t.closePath()}}}function A(t,n){var r=n.defX,i=void 0===r?0:r,a=n.defY,o=void 0===a?0:a,s=n.markerStart,c=n.markerEnd,l=n.markerStartOffset,h=n.markerEndOffset,u=n.points.points,d=u.length,p=u[0][0]-i,f=u[0][1]-o,v=u[d-1][0]-i,g=u[d-1][1]-o,y=0,m=0,M=0,x=0,b=0;s&&e.isDisplayObject(s)&&l&&(y=Math.cos(b=Math.atan2(u[1][1]-u[0][1],u[1][0]-u[0][0]))*(l||0),m=Math.sin(b)*(l||0)),c&&e.isDisplayObject(c)&&h&&(M=Math.cos(b=Math.atan2(u[d-1][1]-u[0][1],u[d-1][0]-u[0][0]))*(h||0),x=Math.sin(b)*(h||0)),t.moveTo(p+(y||M),f+(m||x));for(var P=1;d-1>P;P++){var S=u[P];t.lineTo(S[0]-i,S[1]-o)}t.lineTo(v,g)}function O(t,n){var r=n.defX,i=void 0===r?0:r,a=n.defY,o=void 0===a?0:a,s=n.markerStart,c=n.markerEnd,l=n.markerStartOffset,h=n.markerEndOffset,u=n.points.points,d=u.length,p=u[0][0]-i,f=u[0][1]-o,v=u[d-1][0]-i,g=u[d-1][1]-o,y=0,m=0,M=0,x=0,b=0;s&&e.isDisplayObject(s)&&l&&(y=Math.cos(b=Math.atan2(u[1][1]-u[0][1],u[1][0]-u[0][0]))*(l||0),m=Math.sin(b)*(l||0)),c&&e.isDisplayObject(c)&&h&&(M=Math.cos(b=Math.atan2(u[d-2][1]-u[d-1][1],u[d-2][0]-u[d-1][0]))*(h||0),x=Math.sin(b)*(h||0)),t.moveTo(p+y,f+m);for(var P=1;d-1>P;P++){var S=u[P];t.lineTo(S[0]-i,S[1]-o)}t.lineTo(v+M,g+x)}function k(t,e){var n=e.radius,r=e.width,i=e.height,a=r,o=i;if(n&&n.some((function(t){return 0!==t}))){var c=r>0?1:-1,l=i>0?1:-1,h=c+l===0,u=s(n.map((function(t){return S(t,0,Math.min(Math.abs(a)/2,Math.abs(o)/2))})),4),d=u[0],p=u[1],f=u[2],v=u[3];t.moveTo(c*d,0),t.lineTo(a-c*p,0),0!==p&&t.arc(a-c*p,l*p,p,-l*Math.PI/2,c>0?0:Math.PI,h),t.lineTo(a,o-l*f),0!==f&&t.arc(a-c*f,o-l*f,f,c>0?0:Math.PI,l>0?Math.PI/2:1.5*Math.PI,h),t.lineTo(c*v,o),0!==v&&t.arc(c*v,o-l*v,v,l>0?Math.PI/2:-Math.PI/2,c>0?Math.PI:0,h),t.lineTo(0,l*d),0!==d&&t.arc(c*d,l*d,d,c>0?Math.PI:0,l>0?1.5*Math.PI:Math.PI/2,h)}else t.rect(0,0,a,o)}var R=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="canvas-path-generator",e}return r(n,t),n.prototype.init=function(){var t,n=((t={})[e.Shape.CIRCLE]=E,t[e.Shape.ELLIPSE]=T,t[e.Shape.RECT]=k,t[e.Shape.LINE]=C,t[e.Shape.POLYLINE]=O,t[e.Shape.POLYGON]=A,t[e.Shape.PATH]=w,t[e.Shape.TEXT]=void 0,t[e.Shape.GROUP]=void 0,t[e.Shape.IMAGE]=void 0,t[e.Shape.HTML]=void 0,t[e.Shape.MESH]=void 0,t);this.context.pathGeneratorFactory=n},n.prototype.destroy=function(){delete this.context.pathGeneratorFactory},n}(e.AbstractRendererPlugin);function L(t,e,n,r){var i=t-n,a=e-r;return Math.sqrt(i*i+a*a)}var D=1e-4;function I(t,e,n,r,i,a){var o=-1,l=1/0,h=[n,r],u=20;a&&a>200&&(u=a/10);for(var d=1/u,p=d/10,f=0;u>=f;f++){var v=f*d,g=[i.apply(void 0,c([],s(t.concat([v])),!1)),i.apply(void 0,c([],s(e.concat([v])),!1))];l>(x=L(h[0],h[1],g[0],g[1]))&&(o=v,l=x)}if(0===o)return{x:t[0],y:e[0]};if(1===o){var y=t.length;return{x:t[y-1],y:e[y-1]}}l=1/0;for(f=0;32>f&&D<=p;f++){var m=o-p,M=o+p,x=(g=[i.apply(void 0,c([],s(t.concat([m])),!1)),i.apply(void 0,c([],s(e.concat([m])),!1))],L(h[0],h[1],g[0],g[1]));if(m>=0&&l>x)o=m,l=x;else{var b=[i.apply(void 0,c([],s(t.concat([M])),!1)),i.apply(void 0,c([],s(e.concat([M])),!1))],P=L(h[0],h[1],b[0],b[1]);1>=M&&l>P?(o=M,l=P):p*=.5}}return{x:i.apply(void 0,c([],s(t.concat([o])),!1)),y:i.apply(void 0,c([],s(e.concat([o])),!1))}}function B(t,e,n,r,i,a){var o=[n-t,r-e];if(function(t,e){return t[0]===e[0]&&t[1]===e[1]}(o,[0,0]))return Math.sqrt((i-t)*(i-t)+(a-e)*(a-e));var s=[-o[1],o[0]];return function(t,e){var n=e[0],r=e[1],i=n*n+r*r;i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i}(s,s),Math.abs(function(t,e){return t[0]*e[0]+t[1]*e[1]}([i-t,a-e],s))}function N(t,e,n,r,i){var a=1-i;return a*a*a*t+3*e*i*a*a+3*n*i*i*a+r*i*i*i}function F(t,e,n,r,i,a,o,s,c,l,h){var u=function(t,e,n,r,i,a,o,s,c,l,h){return I([t,n,i,o],[e,r,a,s],c,l,N,h)}(t,e,n,r,i,a,o,s,c,l,h);return L(u.x,u.y,c,l)}function G(t,e,n,r){var i=1-r;return i*i*t+2*r*i*e+r*r*n}function j(t,e,n,r,i,a,o,s){var c=function(t,e,n,r,i,a,o,s){return I([t,n,i],[e,r,a],o,s,G)}(t,e,n,r,i,a,o,s);return L(c.x,c.y,o,s)}var Y=f(),W=f(),X=f(),H=h(),_=function(){function t(){var t=this;this.isHit=function(n,r,i,a){var o,s,c,l,h,u,d,p,f,y,m,M,x,b,P,S,E,T,C,w,A,O,k,R,L,D,I,B,N,F,G,j=t.context.pointInPathPickerFactory[n.nodeName];if(j){var Y=(o=H,(G=(C=(c=(s=i)[0])*(p=s[5])-(l=s[1])*(d=s[4]))*(F=(x=s[10])*(T=s[15])-(b=s[11])*(E=s[14]))-(w=c*(f=s[6])-(h=s[2])*d)*(N=(M=s[9])*T-b*(S=s[13]))+(A=c*(y=s[7])-(u=s[3])*d)*(B=M*E-x*S)+(O=l*f-h*p)*(I=(m=s[8])*T-b*(P=s[12]))-(k=l*y-u*p)*(D=m*E-x*P)+(R=h*y-u*f)*(L=m*S-M*P))?(o[0]=(p*F-f*N+y*B)*(G=1/G),o[1]=(h*N-l*F-u*B)*G,o[2]=(S*R-E*k+T*O)*G,o[3]=(x*k-M*R-b*O)*G,o[4]=(f*I-d*F-y*D)*G,o[5]=(c*F-h*I+u*D)*G,o[6]=(E*A-P*R-T*w)*G,o[7]=(m*R-x*A+b*w)*G,o[8]=(d*N-p*I+y*L)*G,o[9]=(l*I-c*N-u*L)*G,o[10]=(P*k-S*A+T*C)*G,o[11]=(M*A-m*k-b*C)*G,o[12]=(p*D-d*B-f*L)*G,o[13]=(c*B-l*D+h*L)*G,o[14]=(S*w-P*O-E*C)*G,o[15]=(m*O-M*w+x*C)*G,o):null),_=g(W,v(X,r[0],r[1],0),Y),U=n.getGeometryBounds().halfExtents,q=n.parsedStyle.anchor;if(_[0]+=(q&&q[0]||0)*U[0]*2,_[1]+=(q&&q[1]||0)*U[1]*2,j(n,new e.Point(_[0],_[1]),a,t.isPointInPath,t.context,t.runtime))return!0}return!1},this.isPointInPath=function(e,n){var r=t.runtime.offscreenCanvasCreator.getOrCreateContext(t.context.config.offscreenCanvas),i=t.context.pathGeneratorFactory[e.nodeName];return i&&(r.beginPath(),i(r,e.parsedStyle),r.closePath()),r.isPointInPath(n.x,n.y)}}return t.prototype.apply=function(e,n){var r,i=this,s=e.renderingService,c=e.renderingContext;this.context=e,this.runtime=n;var l=null===(r=c.root)||void 0===r?void 0:r.ownerDocument;s.hooks.pick.tapPromise(t.tag,(function(t){return a(i,void 0,void 0,(function(){return o(this,(function(e){return[2,this.pick(l,t)]}))}))})),s.hooks.pickSync.tap(t.tag,(function(t){return i.pick(l,t)}))},t.prototype.pick=function(t,n){var r,i,a,o=n.topmost,s=(r=n.position).x,c=v(Y,s,r.y,0),l=t.elementsFromBBox(c[0],c[1],c[0],c[1]),h=[];try{for(var u=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(l),d=u.next();!d.done;d=u.next()){var p=d.value,f=p.getWorldTransform();if(this.isHit(p,c,f,!1)){var g=e.findClosestClipPathTarget(p);if(g){var y=g.parsedStyle.clipPath;if(this.isHit(y,c,y.getWorldTransform(),!0)){if(o)return n.picked=[p],n;h.push(p)}}else{if(o)return n.picked=[p],n;h.push(p)}}}}catch(t){i={error:t}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}return n.picked=h,n},t.tag="CanvasPicker",t}();function U(t,n,r){var i=t.parsedStyle,a=i.r,o=i.fill,c=i.stroke,l=i.pointerEvents,h=((i.lineWidth||0)+(i.increasedLineWidthForHitTesting||0))/2,u=L(a,a,n.x,n.y),d=s(e.isFillOrStrokeAffected(l,o,c),2),p=d[0],f=d[1];return p&&f||r?a+h>=u:p?a>=u:!!f&&(u>=a-h&&a+h>=u)}function q(t,e,n,r){return t/(n*n)+e/(r*r)}function Q(t,n,r){var i=t.parsedStyle,a=i.rx,o=i.ry,c=i.lineWidth,l=i.increasedLineWidthForHitTesting,h=n.x,u=n.y,d=s(e.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),2),p=d[0],f=d[1],v=((c||0)+(l||0))/2,g=(h-a)*(h-a),y=(u-o)*(u-o);return p&&f||r?1>=q(g,y,a+v,o+v):p?1>=q(g,y,a,o):!!f&&(q(g,y,a-v,o-v)>=1&&1>=q(g,y,a+v,o+v))}function z(t,e,n,r,i,a){return!(t>i||i>t+n||e>a||a>e+r)}function $(t,e,n,r,i,a,o,s){var c=(Math.atan2(s-e,o-t)+2*Math.PI)%(2*Math.PI),l={x:t+n*Math.cos(c),y:e+n*Math.sin(c)};return L(l.x,l.y,o,s)<=a/2}function V(t,e,n,r,i,a,o){var s=i/2;return!(Math.min(t,n)-s>a||a>Math.max(t,n)+s||Math.min(e,r)-s>o||o>Math.max(e,r)+s)&&B(t,e,n,r,a,o)<=i/2}function J(t,e,n,r,i){var a=t.length;if(2>a)return!1;for(var o=0;a-1>o;o++){if(V(t[o][0],t[o][1],t[o+1][0],t[o+1][1],e,n,r))return!0}if(i){var s=t[0],c=t[a-1];if(V(s[0],s[1],c[0],c[1],e,n,r))return!0}return!1}var K=1e-6;function Z(t){return K>Math.abs(t)?0:0>t?-1:1}function tt(t,e,n){return!((n[0]-t[0])*(e[1]-t[1])!=(e[0]-t[0])*(n[1]-t[1])||Math.min(t[0],e[0])>n[0]||n[0]>Math.max(t[0],e[0])||Math.min(t[1],e[1])>n[1]||n[1]>Math.max(t[1],e[1]))}function et(t,e,n){var r=!1,i=t.length;if(2>=i)return!1;for(var a=0;i>a;a++){var o=t[a],s=t[(a+1)%i];if(tt(o,s,[e,n]))return!0;Z(o[1]-n)>0!=Z(s[1]-n)>0&&0>Z(e-(n-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])&&(r=!r)}return r}function nt(t,e,n){for(var r=!1,i=0;t.length>i;i++){if(r=et(t[i],e,n))break}return r}function rt(t,n,r){var i=t.parsedStyle,a=i.x1,o=i.y1,c=i.x2,l=i.y2,h=i.lineWidth,u=i.increasedLineWidthForHitTesting,d=i.defX,p=void 0===d?0:d,f=i.defY,v=void 0===f?0:f;return!(!s(e.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),2)[1]&&!r||!h)&&V(a,o,c,l,(h||0)+(u||0),n.x+p,n.y+v)}function it(t,n,r,i,a,o){var c=t.parsedStyle,l=c.lineWidth,h=c.increasedLineWidthForHitTesting,u=c.defX,d=void 0===u?0:u,p=c.defY,f=void 0===p?0:p,v=c.path,g=v.segments,y=v.hasArc,M=v.polylines,x=v.polygons,b=s(e.isFillOrStrokeAffected(c.pointerEvents,(null==x?void 0:x.length)&&c.fill,c.stroke),2),P=b[0],S=b[1],E=e.getOrCalculatePathTotalLength(t),T=!1;return P||r?T=y?i(t,n):nt(x,n.x+d,n.y+f)||nt(M,n.x+d,n.y+f):((S||r)&&(T=function(t,e,n,r,i){for(var a=!1,o=e/2,s=0;t.length>s;s++){var c=t[s],l=c.currentPoint,h=c.params,u=c.prePoint,d=c.box;if(!d||z(d.x-o,d.y-o,d.width+e,d.height+e,n,r))switch(c.command){case"L":case"Z":if(a=V(u[0],u[1],l[0],l[1],e,n,r))return!0;break;case"Q":if(a=e/2>=j(u[0],u[1],h[1],h[2],h[3],h[4],n,r))return!0;break;case"C":if(a=e/2>=F(u[0],u[1],h[1],h[2],h[3],h[4],h[5],h[6],n,r,i))return!0;break;case"A":c.cubicParams||(c.cubicParams=m(u[0],u[1],h[1],h[2],h[3],h[4],h[5],h[6],h[7],void 0));for(var p=c.cubicParams,f=u,v=0;p.length>v;v+=6){var g=F(f[0],f[1],p[v],p[v+1],p[v+2],p[v+3],p[v+4],p[v+5],n,r,i);if(f=[p[v+4],p[v+5]],a=e/2>=g)return!0}}}return a}(g,(l||0)+(h||0),n.x+d,n.y+f,E)),T)}function at(t,n,r){var i=t.parsedStyle,a=i.lineWidth,o=i.increasedLineWidthForHitTesting,c=i.points,l=i.defX,h=void 0===l?0:l,u=i.defY,d=void 0===u?0:u,p=s(e.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),2),f=p[0],v=!1;return(p[1]||r)&&(v=J(c.points,(a||0)+(o||0),n.x+h,n.y+d,!0)),v||!f&&!r||(v=et(c.points,n.x+h,n.y+d)),v}function ot(t,n,r){var i=t.parsedStyle,a=i.lineWidth,o=i.increasedLineWidthForHitTesting,c=i.points,l=i.defX,h=void 0===l?0:l,u=i.defY,d=void 0===u?0:u;return!(!s(e.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),2)[1]&&!r||!a)&&J(c.points,(a||0)+(o||0),n.x+h,n.y+d,!1)}function st(t,n,r,i,a){var o=t.parsedStyle,c=o.radius,l=o.lineWidth,h=o.increasedLineWidthForHitTesting,u=o.width,d=o.height,p=s(e.isFillOrStrokeAffected(o.pointerEvents,o.fill,o.stroke),2),f=p[0],v=p[1],g=(l||0)+(h||0);if(c&&c.some((function(t){return 0!==t}))){var y=!1;return(v||r)&&(y=function(t,e,n,r,i,a,o,c){var l=s(i,4),h=l[0],u=l[1],d=l[2],p=l[3];return V(t+h,e,t+n-u,e,a,o,c)||V(t+n,e+u,t+n,e+r-d,a,o,c)||V(t+n-d,e+r,t+p,e+r,a,o,c)||V(t,e+r-p,t,e+h,a,o,c)||$(t+n-u,e+u,u,0,0,a,o,c)||$(t+n-d,e+r-d,d,0,0,a,o,c)||$(t+p,e+r-p,p,0,0,a,o,c)||$(t+h,e+h,h,0,0,a,o,c)}(0,0,u,d,c.map((function(t){return S(t,0,Math.min(Math.abs(u)/2,Math.abs(d)/2))})),g,n.x,n.y)),y||!f&&!r||(y=i(t,n)),y}var m=g/2;return f&&v||r?z(0-m,0-m,u+m,d+m,n.x,n.y):f?z(0,0,u,d,n.x,n.y):!!v&&function(t,e,n,r,i,a,o){var s=i/2;return z(t-s,e-s,n,i,a,o)||z(t+n-s,e-s,i,r,a,o)||z(t+s,e+r-s,n,i,a,o)||z(t-s,e+s,i,r,a,o)}(0,0,u,d,g,n.x,n.y)}function ct(t,n,r,i,a,o){var s=t.parsedStyle,c=s.width,l=s.height;if("non-transparent-pixel"===s.pointerEvents){var h=a.config.offscreenCanvas,u=o.offscreenCanvasCreator.getOrCreateCanvas(h),d=o.offscreenCanvasCreator.getOrCreateContext(h,{willReadFrequently:!0});return u.width=c,u.height=l,a.defaultStyleRendererFactory[e.Shape.IMAGE].render(d,t.parsedStyle,t,void 0,void 0,void 0),d.getImageData(n.x,n.y,1,1).data.every((function(t){return 0!==t}))}return!0}var lt=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="canvas-picker",e}return r(n,t),n.prototype.init=function(){var t,n=((t={})[e.Shape.CIRCLE]=U,t[e.Shape.ELLIPSE]=Q,t[e.Shape.RECT]=st,t[e.Shape.LINE]=rt,t[e.Shape.POLYLINE]=ot,t[e.Shape.POLYGON]=at,t[e.Shape.PATH]=it,t[e.Shape.TEXT]=function(){return!0},t[e.Shape.GROUP]=null,t[e.Shape.IMAGE]=ct,t[e.Shape.HTML]=null,t[e.Shape.MESH]=null,t);this.context.pointInPathPickerFactory=n,this.addRenderingPlugin(new _)},n.prototype.destroy=function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()},n}(e.AbstractRendererPlugin),ht=Object.freeze({__proto__:null,Plugin:lt}),ut=function(){function t(t){this.canvasRendererPluginOptions=t,this.removedRBushNodeAABBs=[],this.renderQueue=[],this.restoreStack=[],this.clearFullScreen=!1,this.vpMatrix=h(),this.dprMatrix=h(),this.tmpMat4=h(),this.vec3a=f(),this.vec3b=f(),this.vec3c=f(),this.vec3d=f()}return t.prototype.apply=function(n,r){var i=this;this.context=n;var a=n.config,o=n.camera,l=n.renderingService,h=n.renderingContext,u=n.pathGeneratorFactory;this.rBush=n.rBushRoot,this.pathGeneratorFactory=u;var p=n.contextService,f=h.root.ownerDocument.defaultView,v=function(t){var e=t.target.rBushNode;e.aabb&&i.removedRBushNodeAABBs.push(e.aabb)},y=function(t){var e=t.target.rBushNode;e.aabb&&i.removedRBushNodeAABBs.push(e.aabb)};l.hooks.init.tap(t.tag,(function(){f.addEventListener(e.ElementEvent.UNMOUNTED,v),f.addEventListener(e.ElementEvent.CULLED,y);var t=p.getDPR(),n=a.width,r=a.height,o=p.getContext();i.clearRect(o,0,0,n*t,r*t,a.background)})),l.hooks.destroy.tap(t.tag,(function(){f.removeEventListener(e.ElementEvent.UNMOUNTED,v),f.removeEventListener(e.ElementEvent.CULLED,y)})),l.hooks.beginFrame.tap(t.tag,(function(){var t,e,n=p.getContext(),r=p.getDPR(),o=a.width,s=a.height,c=(t=i.canvasRendererPluginOptions).dirtyObjectNumThreshold,h=t.dirtyObjectRatioThreshold,u=(e=l.getStats()).total,d=e.rendered,f=d/u;i.clearFullScreen=l.disableDirtyRectangleRendering()||d>c&&f>h,n&&(n.resetTransform?n.resetTransform():n.setTransform(1,0,0,1,0,0),i.clearFullScreen&&i.clearRect(n,0,0,o*r,s*r,a.background))}));var m=function(t,e){t.isVisible()&&!t.isCulled()&&(i.renderDisplayObject(t,e,i.context,i.restoreStack,r),i.saveDirtyAABB(t)),(t.sortable.sorted||t.childNodes).forEach((function(t){m(t,e)}))};l.hooks.endFrame.tap(t.tag,(function(){var t,n,l=p.getContext(),u=p.getDPR();if((t=i.dprMatrix)[0]=(n=[u,u,1])[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,d(i.vpMatrix,i.dprMatrix,o.getOrthoMatrix()),i.clearFullScreen)m(h.root,l);else{var v=i.safeMergeAABB.apply(i,c([i.mergeDirtyAABBs(i.renderQueue)],s(i.removedRBushNodeAABBs.map((function(t){var n=t.minX,r=t.minY,i=t.maxX,a=t.maxY,o=new e.AABB;return o.setMinMax([n,r,0],[i,a,0]),o}))),!1));if(i.removedRBushNodeAABBs=[],e.AABB.isEmpty(v))return void(i.renderQueue=[]);var y=i.convertAABB2Rect(v),M=y.x,x=y.y,b=y.width,P=y.height,S=g(i.vec3a,[M,x,0],i.vpMatrix),E=g(i.vec3b,[M+b,x,0],i.vpMatrix),T=g(i.vec3c,[M,x+P,0],i.vpMatrix),C=g(i.vec3d,[M+b,x+P,0],i.vpMatrix),w=Math.min(S[0],E[0],C[0],T[0]),A=Math.min(S[1],E[1],C[1],T[1]),O=Math.max(S[0],E[0],C[0],T[0]),k=Math.max(S[1],E[1],C[1],T[1]),R=Math.floor(w),L=Math.floor(A),D=Math.ceil(O-w),I=Math.ceil(k-A);l.save(),i.clearRect(l,R,L,D,I,a.background),l.beginPath(),l.rect(R,L,D,I),l.clip(),l.setTransform(i.vpMatrix[0],i.vpMatrix[1],i.vpMatrix[4],i.vpMatrix[5],i.vpMatrix[12],i.vpMatrix[13]),a.renderer.getConfig().enableDirtyRectangleRenderingDebug&&f.dispatchEvent(new e.CustomEvent(e.CanvasEvent.DIRTY_RECTANGLE,{dirtyRect:{x:R,y:L,width:D,height:I}})),i.searchDirtyObjects(v).sort((function(t,e){return t.sortable.renderOrder-e.sortable.renderOrder})).forEach((function(t){t&&t.isVisible()&&!t.isCulled()&&i.renderDisplayObject(t,l,i.context,i.restoreStack,r)})),l.restore(),i.renderQueue.forEach((function(t){i.saveDirtyAABB(t)})),i.renderQueue=[]}i.restoreStack.forEach((function(){l.restore()})),i.restoreStack=[]})),l.hooks.render.tap(t.tag,(function(t){i.clearFullScreen||i.renderQueue.push(t)}))},t.prototype.clearRect=function(t,e,n,r,i,a){t.clearRect(e,n,r,i),a&&(t.fillStyle=a,t.fillRect(e,n,r,i))},t.prototype.renderDisplayObject=function(t,n,r,i,a){var o=t.nodeName,s=i[i.length-1];!s||t.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_CONTAINS||(n.restore(),i.pop());var c=this.context.styleRendererFactory[o],l=this.pathGeneratorFactory[o],h=t.parsedStyle.clipPath;if(h){this.applyWorldTransform(n,h);var u=this.pathGeneratorFactory[h.nodeName];u&&(n.save(),i.push(t),n.beginPath(),u(n,h.parsedStyle),n.closePath(),n.clip())}c&&(this.applyWorldTransform(n,t),n.save(),this.applyAttributesToContext(n,t)),l&&(n.beginPath(),l(n,t.parsedStyle),t.nodeName!==e.Shape.LINE&&t.nodeName!==e.Shape.PATH&&t.nodeName!==e.Shape.POLYLINE&&n.closePath()),c&&(c.render(n,t.parsedStyle,t,r,this,a),n.restore()),t.renderable.dirty=!1},t.prototype.convertAABB2Rect=function(t){var e=t.getMin(),n=t.getMax(),r=Math.floor(e[0]),i=Math.floor(e[1]);return{x:r,y:i,width:Math.ceil(n[0])-r,height:Math.ceil(n[1])-i}},t.prototype.mergeDirtyAABBs=function(t){var n=new e.AABB;return t.forEach((function(t){var e=t.getRenderBounds();n.add(e);var r=t.renderable.dirtyRenderBounds;r&&n.add(r)})),n},t.prototype.searchDirtyObjects=function(t){var e,n,r=(e=s(t.getMin(),2))[0],i=e[1],a=(n=s(t.getMax(),2))[0];return this.rBush.search({minX:r,minY:i,maxX:a,maxY:n[1]}).map((function(t){return t.displayObject}))},t.prototype.saveDirtyAABB=function(t){var n=t.renderable;n.dirtyRenderBounds||(n.dirtyRenderBounds=new e.AABB);var r=t.getRenderBounds();r&&n.dirtyRenderBounds.update(r.center,r.halfExtents)},t.prototype.applyAttributesToContext=function(t,e){var n,r=(n=e.parsedStyle).stroke,i=n.fill,a=n.opacity,o=n.lineDash,s=n.lineDashOffset;o&&t.setLineDash(o),M(s)||(t.lineDashOffset=s),M(a)||(t.globalAlpha*=a),M(r)||Array.isArray(r)||r.isNone||(t.strokeStyle=e.attributes.stroke),M(i)||Array.isArray(i)||i.isNone||(t.fillStyle=e.attributes.fill)},t.prototype.applyWorldTransform=function(t,e,n){var r=0,i=0,a=(e.parsedStyle||{}).anchor,o=a&&a[0]||0,s=a&&a[1]||0;if(0!==o||0!==s){var c=e.geometry.contentBounds;r=-o*(c&&2*c.halfExtents[0]||0),i=-s*(c&&2*c.halfExtents[1]||0)}n?(u(this.tmpMat4,e.getLocalTransform()),this.vec3a[0]=r,this.vec3a[1]=i,this.vec3a[2]=0,p(this.tmpMat4,this.tmpMat4,this.vec3a),d(this.tmpMat4,n,this.tmpMat4),d(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(u(this.tmpMat4,e.getWorldTransform()),this.vec3a[0]=r,this.vec3a[1]=i,this.vec3a[2]=0,p(this.tmpMat4,this.tmpMat4,this.vec3a),d(this.tmpMat4,this.vpMatrix,this.tmpMat4)),t.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])},t.prototype.safeMergeAABB=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];var r=new e.AABB;return t.forEach((function(t){r.add(t)})),r},t.tag="CanvasRenderer",t}(),dt=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,n,r,i,a,o){var s=n.fill,c=n.fillRule,l=n.opacity,h=n.fillOpacity,u=n.stroke,d=n.strokeOpacity,p=n.lineWidth,f=n.lineCap,v=n.lineJoin,g=n.shadowType,y=n.shadowColor,m=n.shadowBlur,x=n.filter,b=n.miterLimit,P=!M(s)&&!s.isNone,S=!M(u)&&!u.isNone&&p>0,E=0===s.alpha,T=!(!x||!x.length),C=!M(y)&&m>0,w=r.nodeName,A="inner"===g,O=S&&C&&(w===e.Shape.PATH||w===e.Shape.LINE||w===e.Shape.POLYLINE||E||A);P&&(t.globalAlpha=l*h,O||pt(r,t,C),this.fill(t,r,s,c,i,a,o),O||this.clearShadowAndFilter(t,T,C)),S&&(t.globalAlpha=l*d,t.lineWidth=p,M(b)||(t.miterLimit=b),M(f)||(t.lineCap=f),M(v)||(t.lineJoin=v),O&&(A&&(t.globalCompositeOperation="source-atop"),pt(r,t,!0),A&&(this.stroke(t,r,u,i,a,o),t.globalCompositeOperation="source-over",this.clearShadowAndFilter(t,T,!0))),this.stroke(t,r,u,i,a,o))},t.prototype.clearShadowAndFilter=function(t,e,n){if(n&&(t.shadowColor="transparent",t.shadowBlur=0),e){var r=t.filter;!M(r)&&r.indexOf("drop-shadow")>-1&&(t.filter=r.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}},t.prototype.fill=function(t,n,r,i,a,o,s){var c=this;Array.isArray(r)?r.forEach((function(e){t.fillStyle=c.getColor(e,n,t),i?t.fill(i):t.fill()})):(e.isPattern(r)&&(t.fillStyle=this.getPattern(r,n,t,a,o,s)),i?t.fill(i):t.fill())},t.prototype.stroke=function(t,n,r,i,a,o){var s=this;Array.isArray(r)?r.forEach((function(e){t.strokeStyle=s.getColor(e,n,t),t.stroke()})):(e.isPattern(r)&&(t.strokeStyle=this.getPattern(r,n,t,i,a,o)),t.stroke())},t.prototype.getPattern=function(t,e,n,r,i,a){var o,s;if("rect"===t.image.nodeName){var c=t.image.parsedStyle,l=c.width,h=c.height;s=r.contextService.getDPR();var u=r.config.offscreenCanvas;(o=a.offscreenCanvasCreator.getOrCreateCanvas(u)).width=l*s,o.height=h*s;var d=a.offscreenCanvasCreator.getOrCreateContext(u),p=[];t.image.forEach((function(t){i.renderDisplayObject(t,d,r,p,a)})),p.forEach((function(){d.restore()}))}return this.imagePool.getOrCreatePatternSync(t,n,o,s,(function(){e.renderable.dirty=!0,r.renderingService.dirtify()}))},t.prototype.getColor=function(t,n,r){var a;if(t.type===e.GradientType.LinearGradient||t.type===e.GradientType.RadialGradient){var o=n.getGeometryBounds(),s=o&&2*o.halfExtents[0]||1,c=o&&2*o.halfExtents[1]||1;a=this.imagePool.getOrCreateGradient(i(i({type:t.type},t.value),{width:s,height:c}),r)}return a},t}();function pt(t,e,n){var r=t.parsedStyle,i=r.filter,a=r.shadowColor,o=r.shadowBlur,s=r.shadowOffsetX,c=r.shadowOffsetY;i&&i.length&&(e.filter=t.style.filter),n&&(e.shadowColor=""+a,e.shadowBlur=o||0,e.shadowOffsetX=s||0,e.shadowOffsetY=c||0)}var ft=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,n){var r,i=e.img,a=e.shadowColor,o=e.shadowBlur,s=e.width,c=e.height;if(P(i)?r=this.imagePool.getImageSync(i):(s||(s=i.width),c||(c=i.height),r=i),r){pt(n,t,!M(a)&&o>0);try{t.drawImage(r,0,0,s,c)}catch(t){}}},t}(),vt=function(){function t(){}return t.prototype.render=function(t,n,r){var i=n.lineWidth,a=n.textAlign,o=n.textBaseline,s=n.lineJoin,c=n.miterLimit,l=n.letterSpacing,h=n.stroke,u=n.fill,d=n.fillOpacity,p=n.strokeOpacity,f=n.opacity,v=n.metrics,g=n.dx,y=n.dy,m=n.shadowColor,x=n.shadowBlur,b=v.lines,P=v.height,S=v.lineHeight,E=v.lineMetrics;t.font=v.font,t.lineWidth=i,t.textAlign="middle"===a?"center":a;var T=o;e.runtime.enableCSSParsing||"alphabetic"!==T||(T="bottom"),t.lineJoin=s,M(c)||(t.miterLimit=c);var C=0;"middle"===o?C=-P/2-S/2:"bottom"===o||"alphabetic"===o||"ideographic"===o?C=-P:"top"!==o&&"hanging"!==o||(C=-S);var w=g||0;C+=y||0,1===b.length&&("bottom"===T?(T="middle",C-=.5*P):"top"===T&&(T="middle",C+=.5*P)),t.textBaseline=T,pt(r,t,!M(m)&&x>0);for(var A=0;b.length>A;A++){var O=i/2+w;C+=S,M(h)||h.isNone||!i||this.drawLetterSpacing(t,b[A],E[A],a,O,C,l,d,p,f,!0),M(u)||this.drawLetterSpacing(t,b[A],E[A],a,O,C,l,d,p,f)}},t.prototype.drawLetterSpacing=function(t,e,n,r,i,a,o,s,c,l,h){if(void 0===h&&(h=!1),0!==o){var u=t.textAlign;t.textAlign="left";var d=i;"center"===r||"middle"===r?d=i-n.width/2:"right"!==r&&"end"!==r||(d=i-n.width);for(var p=Array.from(e),f=t.measureText(e).width,v=0,g=0;p.length>g;++g){var y=p[g];h?this.strokeText(t,y,d,a,c):this.fillText(t,y,d,a,s,l),d+=f-(v=t.measureText(e.substring(g+1)).width)+o,f=v}t.textAlign=u}else h?this.strokeText(t,e,i,a,c):this.fillText(t,e,i,a,s,l)},t.prototype.fillText=function(t,e,n,r,i,a){var o,s=!M(i)&&1!==i;s&&(o=t.globalAlpha,t.globalAlpha=i*a),t.fillText(e,n,r),s&&(t.globalAlpha=o)},t.prototype.strokeText=function(t,e,n,r,i){var a,o=!M(i)&&1!==i;o&&(a=t.globalAlpha,t.globalAlpha=i),t.strokeText(e,n,r),o&&(t.globalAlpha=a)},t}(),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(dt),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(dt),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(dt),Mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(dt),xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(dt),bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(dt),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(dt),St=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="canvas-renderer",n}return r(n,t),n.prototype.init=function(){var t,n=i({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),r=this.context.imagePool,a=new dt(r),o=((t={})[e.Shape.CIRCLE]=a,t[e.Shape.ELLIPSE]=a,t[e.Shape.RECT]=a,t[e.Shape.IMAGE]=new ft(r),t[e.Shape.TEXT]=new vt,t[e.Shape.LINE]=a,t[e.Shape.POLYLINE]=a,t[e.Shape.POLYGON]=a,t[e.Shape.PATH]=a,t[e.Shape.GROUP]=void 0,t[e.Shape.HTML]=void 0,t[e.Shape.MESH]=void 0,t);this.context.defaultStyleRendererFactory=o,this.context.styleRendererFactory=o,this.addRenderingPlugin(new ut(n))},n.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory},n}(e.AbstractRendererPlugin),Et=Object.freeze({__proto__:null,CircleRenderer:yt,EllipseRenderer:mt,ImageRenderer:ft,LineRenderer:Mt,PathRenderer:Pt,Plugin:St,PolygonRenderer:bt,PolylineRenderer:xt,RectRenderer:gt,TextRenderer:vt}),Tt=function(){function t(t){this.dragndropPluginOptions=t}return t.prototype.apply=function(e){var n=this,r=e.renderingService,i=e.renderingContext.root.ownerDocument,s=i.defaultView,c=function(t){var e=t.target,r=e===i,c=r&&n.dragndropPluginOptions.isDocumentDraggable?i:e.closest&&e.closest("[draggable=true]");if(c){var l=!1,h=t.timeStamp,u=[t.clientX,t.clientY],d=null,p=[t.clientX,t.clientY],f=function(t){return a(n,void 0,void 0,(function(){var n,a,s,f,v,g;return o(this,(function(o){switch(o.label){case 0:if(!l){if(n=t.timeStamp-h,a=Math.sqrt(((y=[t.clientX,t.clientY])[0]-(m=u)[0])*(y[0]-m[0])+(y[1]-m[1])*(y[1]-m[1])),this.dragndropPluginOptions.dragstartTimeThreshold>=n||this.dragndropPluginOptions.dragstartDistanceThreshold>=a)return[2];t.type="dragstart",c.dispatchEvent(t),l=!0}return t.type="drag",t.dx=t.clientX-p[0],t.dy=t.clientY-p[1],c.dispatchEvent(t),p=[t.clientX,t.clientY],r?[3,2]:(s="pointer"===this.dragndropPluginOptions.overlap?[t.canvasX,t.canvasY]:e.getBounds().center,[4,i.elementsFromPoint(s[0],s[1])]);case 1:f=o.sent(),v=f[f.indexOf(e)+1],g=(null==v?void 0:v.closest("[droppable=true]"))||(this.dragndropPluginOptions.isDocumentDroppable?i:null),d!==g&&(d&&(t.type="dragleave",t.target=d,d.dispatchEvent(t)),g&&(t.type="dragenter",t.target=g,g.dispatchEvent(t)),(d=g)&&(t.type="dragover",t.target=d,d.dispatchEvent(t))),o.label=2;case 2:return[2]}var y,m}))}))};s.addEventListener("pointermove",f);var v=function(t){if(l){t.detail={preventClick:!0};var e=t.clone();d&&(e.type="drop",e.target=d,d.dispatchEvent(e)),e.type="dragend",c.dispatchEvent(e),l=!1}s.removeEventListener("pointermove",f)};e.addEventListener("pointerup",v,{once:!0}),e.addEventListener("pointerupoutside",v,{once:!0})}};r.hooks.init.tap(t.tag,(function(){s.addEventListener("pointerdown",c)})),r.hooks.destroy.tap(t.tag,(function(){s.removeEventListener("pointerdown",c)}))},t.tag="Dragndrop",t}(),Ct=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="dragndrop",n}return r(e,t),e.prototype.init=function(){this.addRenderingPlugin(new Tt(i({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e.prototype.setOptions=function(t){Object.assign(this.plugins[0].dragndropPluginOptions,t)},e}(e.AbstractRendererPlugin),wt=function(){function t(t){this.canvasConfig=t,this.imageCache={},this.gradientCache={},this.patternCache={}}return t.prototype.getImageSync=function(t,e){return this.imageCache[t]?e&&e():this.getOrCreateImage(t).then((function(){e&&e()})),this.imageCache[t]},t.prototype.getOrCreateImage=function(t){var n=this;if(this.imageCache[t])return Promise.resolve(this.imageCache[t]);var r=this.canvasConfig.createImage;return new Promise((function(i,a){var o;r?o=r(t):e.isBrowser&&(o=new window.Image),o&&(o.onload=function(){n.imageCache[t]=o,i(o)},o.onerror=function(t){a(t)},o.crossOrigin="Anonymous",o.src=t)}))},t.prototype.getOrCreatePatternSync=function(t,n,r,i,a){var o=this.generatePatternKey(t);if(o&&this.patternCache[o])return this.patternCache[o];var s,c=t.image,l=t.repetition,u=t.transform,d=!1;P(c)?s=this.getImageSync(c,a):r?(s=r,d=!0):s=c;var p,f=s&&n.createPattern(s,l);if(f){var v=void 0;u?v=e.parsedTransformToMat4(e.parseTransform(u),new e.DisplayObject({})):((p=h())[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,v=p),d&&function(t,e,n){var r=n[0],i=n[1],a=n[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(v,v,[1/i,1/i,1]),f.setTransform({a:v[0],b:v[1],c:v[4],d:v[5],e:v[12],f:v[13]})}return o&&f&&(this.patternCache[o]=f),f},t.prototype.getOrCreateGradient=function(t,n){var r=this.generateGradientKey(t),i=t.type,a=t.steps,o=t.width,s=t.height,c=t.cx,l=t.cy,h=t.size;if(this.gradientCache[r])return this.gradientCache[r];var u=null;if(i===e.GradientType.LinearGradient){var d=e.computeLinearGradient(o,s,t.angle);u=n.createLinearGradient(d.x1,d.y1,d.x2,d.y2)}else if(i===e.GradientType.RadialGradient){var p=e.computeRadialGradient(o,s,c,l,h),f=p.x,v=p.y;u=n.createRadialGradient(f,v,0,f,v,p.r)}return u&&(a.forEach((function(t){var n=t.offset;n.unit===e.UnitType.kPercentage&&(null==u||u.addColorStop(n.value/100,""+t.color))})),this.gradientCache[r]=u),this.gradientCache[r]},t.prototype.generateGradientKey=function(t){var e=t.width,n=t.height,r=t.steps,i=t.angle,a=t.cx,o=t.cy,s=t.size;return"gradient-".concat(t.type,"-").concat((null==i?void 0:""+i)||0,"-").concat((null==a?void 0:""+a)||0,"-").concat((null==o?void 0:""+o)||0,"-").concat((null==s?void 0:""+s)||0,"-").concat(e,"-").concat(n,"-").concat(r.map((function(t){var e=t.color;return"".concat(t.offset).concat(e)})).join("-"))},t.prototype.generatePatternKey=function(t){var e=t.image,n=t.repetition;return P(e)?"pattern-".concat(e,"-").concat(n):"rect"===e.nodeName?"pattern-".concat(e.entity,"-").concat(n):void 0},t}(),At=function(){function t(){}return t.prototype.apply=function(n){var r=n.renderingService,i=n.imagePool,a=n.renderingContext.root.ownerDocument.defaultView,o=function(t){var n=t.target;if(n.nodeName===e.Shape.IMAGE){var a=n.attributes.img;P(a)&&i.getImageSync(a,(function(){n.renderable.dirty=!0,r.dirtify()}))}},s=function(t){var n=t.target,a=t.newValue;n.nodeName===e.Shape.IMAGE&&"img"===t.attrName&&P(a)&&i.getOrCreateImage(a).then((function(){n.renderable.dirty=!0,r.dirtify()}))};r.hooks.init.tap(t.tag,(function(){a.addEventListener(e.ElementEvent.MOUNTED,o),a.addEventListener(e.ElementEvent.ATTR_MODIFIED,s)})),r.hooks.destroy.tap(t.tag,(function(){a.removeEventListener(e.ElementEvent.MOUNTED,o),a.removeEventListener(e.ElementEvent.ATTR_MODIFIED,s)}))},t.tag="LoadImage",t}(),Ot=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="image-loader",e}return r(e,t),e.prototype.init=function(){this.context.imagePool=new wt(this.context.config),this.addRenderingPlugin(new At)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(e.AbstractRendererPlugin),kt=function(){function t(){}return t.prototype.apply=function(e){var n=e.renderingService,r=e.config,i=e.contextService.getDomElement(),a=function(t){n.hooks.pointerDown.call(t)},o=function(t){n.hooks.pointerUp.call(t)},s=function(t){n.hooks.pointerMove.call(t)},c=function(t){n.hooks.pointerOver.call(t)},l=function(t){n.hooks.pointerOut.call(t)},h=function(t){n.hooks.click.call(t)},u=function(t){n.hooks.pointerCancel.call(t)};n.hooks.init.tap(t.tag,(function(){i.addEventListener("touchstart",a,!0),i.addEventListener("touchend",o,!0),i.addEventListener("touchmove",s,!0),i.addEventListener("touchcancel",u,!0),i.addEventListener("mouseout",l,!0),i.addEventListener("mouseover",c,!0),r.useNativeClickEvent&&i.addEventListener("click",h,!0)})),n.hooks.destroy.tap(t.tag,(function(){i.removeEventListener("touchstart",a,!0),i.removeEventListener("touchend",o,!0),i.removeEventListener("touchmove",s,!0),i.removeEventListener("touchcancel",u,!0),i.removeEventListener("mouseout",l,!0),i.removeEventListener("mouseover",c,!0),r.useNativeClickEvent&&i.removeEventListener("click",h,!0)}))},t.tag="MobileInteraction",t}(),Rt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="mobile-interaction",e}return r(e,t),e.prototype.init=function(){this.addRenderingPlugin(new kt)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(e.AbstractRendererPlugin);var Lt=function(){function t(t){this.canvasConfig=t.config}return t.prototype.init=function(){return a(this,void 0,void 0,(function(){var t,e,n;return o(this,(function(r){return e=(t=this.canvasConfig).devicePixelRatio,this.$canvas=t.canvas,this.context=this.$canvas.getContext("2d"),this.dpr=n=1>(n=e||1)?1:Math.ceil(n),this.resize(this.canvasConfig.width,this.canvasConfig.height),[2]}))}))},t.prototype.getContext=function(){return this.context},t.prototype.getDomElement=function(){return this.$canvas},t.prototype.getDPR=function(){return this.dpr},t.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},t.prototype.destroy=function(){this.context=null,this.$canvas=null},t.prototype.resize=function(t,e){var n,r=this.canvasConfig.devicePixelRatio,i=this.$canvas;i.style&&(i.style.width=t+"px",i.style.height=e+"px"),(n=i)&&"object"==typeof n&&(1===n.nodeType&&n.nodeName||n.isCanvasElement)&&(i.width=t*r,i.height=e*r,1!==r&&this.context.scale(r,r))},t.prototype.applyCursorStyle=function(t){},t.prototype.toDataURL=function(t){return a(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.context.canvas.toDataURL(t.type,t.encoderOptions)]}))}))},t}(),Dt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="mobile-canvas-context-register",e}return r(e,t),e.prototype.init=function(){this.context.ContextService=Lt},e.prototype.destroy=function(){delete this.context.ContextService},e}(e.AbstractRendererPlugin),It=function(t){function e(e){var n=t.call(this,e)||this;return n.registerPlugin(new Dt),n.registerPlugin(new Ot),n.registerPlugin(new R),n.registerPlugin(new St),n.registerPlugin(new Rt),n.registerPlugin(new lt),n.registerPlugin(new Ct({isDocumentDraggable:!!M(null==e?void 0:e.isDocumentDraggable)||e.isDocumentDraggable,isDocumentDroppable:!!M(null==e?void 0:e.isDocumentDroppable)||e.isDocumentDroppable,dragstartDistanceThreshold:M(null==e?void 0:e.dragstartDistanceThreshold)?10:e.dragstartDistanceThreshold,dragstartTimeThreshold:M(null==e?void 0:e.dragstartTimeThreshold)?50:e.dragstartTimeThreshold})),n}return r(e,t),e}(e.AbstractRenderer);t.CanvasPicker=ht,t.CanvasRenderer=Et,t.Renderer=It}));
//# sourceMappingURL=index.umd.min.js.map
